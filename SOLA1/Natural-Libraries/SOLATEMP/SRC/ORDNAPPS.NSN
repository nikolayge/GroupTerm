* >Natural Source Header 000000
* :Mode S
* :CP
* <Natural Source Header
/** New Subprogram ORDNAPPS.
/**
/** :author nguentchev
DEFINE DATA
PARAMETER
  USING ORDAPARM
LOCAL
1 #AT   /* USING C1008AAT
  2 MEMBER-CN (A6)
  2 REDEFINE MEMBER-CN 
    3 MEMBER-CN-N (N6)
  2 CONTACT-ID (N8)
  2 AT-STATUS (A2)
  2 CAP-IND (A1)
  2 E-DEPOSIT-IND (A1)
  2 E-DEP-MAX-AMT (N7.2)
  2 ID-NUMBER (N6.0)
  2 SMOKER-FLAG (A1)
  2 INTRO-FLAG (A1)
  2 APPL-SOURCE (A7)
  2 ACTION-FLAG (A1)
  2 DISCLOSURE-IND (A1)
  2 SPECIAL-HAND (A1)     /*OI-4258/
  2 PLAN (A3)
  2 REDEFINE PLAN 
    3 PLAN-A1 (A1)
    3 PLAN-A2 (A1)
    3 PLAN-A3 (A1)
  2 REFERING-ID-NUMBER (N6.0/1:9)
  2 REDEFINE REFERING-ID-NUMBER 
    3 REF-ID-OCC (1:9)
      4 REFERING-ID-NUMBER-A (A6)
  2 REMARKS (A70/1:3)
  2 REDEFINE REMARKS 
    3 REM-OCC (1:3)
      4 REM-1ST-60 (A60)
      4 REM-LST-10 (A10)
  2 ALOT-CHG-AUTH (A1)
  2 CONTACT-CODE (A1)
  2 CAP-TYPE (A1)
  2 RATING-CODE (A1)
  2 PAYER (A1)
  2 MODE (A1)
  2 LUMP-SUM (N7.2)
  2 CAP-TERM (N2.0)
  2 CAP-LOAN-AMT (N5.2)
  2 YES-ON-MED (A1)
  2 EXCH-1035 (N7.2)
  2 WEIGHT (N3.0)
  2 HEIGHT-IN (N2.0)
  2 HEIGHT-FT (N2.0)
  2 ALLOT-STRT-AMT (N3.2)
  2 POLICY-TYPE (A1)
  2 FACE-AMT-DOLS (N3.0)
  2 FACE-AMT-UNITS (N4.0)
  2 USER-SOURCE (A3)
  2 DATE-RECEIVED (N8.0)
  2 MED-INFO (A1/1:17)
  2 RIDER-SPS (A25)
  2 RIDER-PLAN (A2/1:5)
  2 RIDER-ATT-POL (N8/1:5)
  2 POLICY-VERSION (A1)
  2 RATE-DATE (N8)

1 AP-Tracking view of A-APPL-TRACKING
  2 ID-NUMBER      (N6)
  2 CONTACT-ID     (N8)
  2 DATE-RECEIVED  (N8)
  2 USER-SOURCE    (A3)
  2 AT-STATUS      (A2)
  2 INTRO-FLAG     (A1)
  2 SMOKER-FLAG    (A1)
  2 INS-ONLY       (A1)
  2 MIL-SERVICE    (A3)
  2 MIL-STATUS     (A1)
  2 NAME           (A25)
  2 RANK           (A3)
  2 SSN            (N9)
  2 DATE-OF-BIRTH  (N8)
  2 SEX            (A1)
  2 MEMBER-CN      (A6) 2 REDEFINE MEMBER-CN
    3 MEMBER-CN-N  (N6)
  2 REFERING-ID-NUMBER (N6/1:9)
  2 NOTES          (A75/40) 2 REDEFINE NOTES
    3 NOTES-A (I1/3000)
  2 ST-NOTE-USER   (A3/1)
  2 ST-NOTE-STATUS (A2/1)
  2 ST-NOTE-DATE (N8/1) 2 redefine ST-NOTE-DATE
    3 ST-NOTE-DATE-A (A8)
  2 APPL-SOURCE    (A7)
  2 CAP-IND        (A1)
  2 CRM-APPL-ID    (A50)
  2 PLAN           (A3)

1 #AT-ROLES
  2 AT-GUID      (A50)
  2 CONTACT-GUID (A50)
  2 RELATION     (N2)

1 BLANK   (A1) CONST <' '>
1 AT-V VIEW OF A-APPL-TRACKING
  2 ID-NUMBER  (N6)
  2 AT-GUID    (A50)
1 J     (I4)
1 #MSG  (A) DYNAMIC
1 #term (N3)
1 #date (D)
1 #face (N7) 1 redefine #face
  2 #Units   (n4)
  2 #Dollars (n3)
1 #AT-ISN  (N8)
END-DEFINE
/* 
FOR J 1 TO IASOrder.C@Applications
  FIND AT-V WITH AT-GUID = IASOrder.CrmApplicationID (J)
    IF NO RECORDS FOUND
      PERFORM CREATE-APPLICATION
    END-NOREC
  END-FIND
END-FOR

RESET #MSG
FOR J 1 TO IASOrder.C@Applications
  PERFORM CREATE-APPLICATION-ROLES
END-FOR

DEFINE CREATE-APPLICATION
/*     ------------------
RESET #AT
  #AT-ROLES
CALLNAT 'C1014SAT' #AT.ID-NUMBER  /* Get AT Number
IF #AT.ID-NUMBER = 0
IASOrder.ErrorDescription_001 (J) := 'There is no AT record tracking number available'
  ESCAPE ROUTINE
end-if

#AT.WEIGHT      := IASOrder.Weight 
#AT.HEIGHT-FT   := IASOrder.HeightFeet
#AT.HEIGHT-IN   := IASOrder.HeightInches
#AT.SMOKER-FLAG := IASOrder.Nicotine
/*  Populate CRM GUID of insured to be used in Application roles
#at-roles.AT-GUID := IASOrder.CrmApplicationID (J)

*                      Not decided
*     <Premium>12.50</Premium>  Calculated in AT FIRST-PLACE-FEE ??
*     <HasOnlineApp>true</HasOnlineApp>  ??

#AT.AT-STATUS   := IASOrder.ATStatus (J)
#AT.PLAN        := IASOrder.PlanCode (J)  /* Get IAS plan code
DECIDE ON FIRST VALUE OF #AT.PLAN-A1
  VALUE 'U'
    #AT.PLAN-A1 := 'S'
  VALUE 'V'
    #AT.PLAN-A1 := 'R'
  VALUE 'W'
    #AT.PLAN-A1 := 'Q'
  NONE VALUE
    IGNORE
END-DECIDE
#term := IASOrder.Term (J)
#face := IASOrder.FaceAmount  (J)

#AT.RATING-CODE    := IASOrder.PremiumClass (J)
#AT.FACE-AMT-DOLS  := #Dollars
#AT.FACE-AMT-UNITS := #Units
#AT.CAP-IND        := IASOrder.CapIndicator (J);
#AT.APPL-SOURCE    := IASOrder.ApplSource (J);
move edited IASOrder.CreatedOn (J) to #date (em=MM'/'DD'/'YYYY)
move edited #date (EM=YYYYMMDD) to #AT.DATE-RECEIVED
#AT.AT-STATUS := IASOrder.ATStatus (J)
MOVE BY NAME #AT TO AP-Tracking

STORE-AT.
STORE AP-Tracking
#AT-ISN := *ISN ( STORE-AT. )

END-SUBROUTINE
/*


AP-Tracking.ST-NOTE-STATUS (1) := #CRM-Status
AP-Tracking.ST-NOTE-USER   (1) := Application-Tracking.USER-SOURCE
MOVE EDITED *DATX (EM=YYYYMMDD) TO ST-NOTE-DATE-A
FOR #J 1 TO 3000
  IF AP-Tracking.NOTES-A (#J) < 32 OR AP-Tracking.NOTES-A (#J) > 127
    ASSIGN NOTES-A (#J) = 32
  END-IF
END-FOR

IF AP-Tracking.MEMBER-CN NE BLANK
  FIND STATUS WITH ID-NUMBER = AP-Tracking.MEMBER-CN-N
    IF NO RECORDS FOUND
      RESET AP-Tracking.MEMBER-CN
    END-NOREC
  END-FIND
END-IF
IF AP-Tracking.REFERING-ID-NUMBER (1) NE 0
  FIND STATUS WITH ID-NUMBER = AP-Tracking.REFERING-ID-NUMBER (1)
    IF NO RECORDS FOUND
      RESET AP-Tracking.REFERING-ID-NUMBER (1)
      ESCAPE BOTTOM
    END-NOREC
    IF AP-Tracking.INTRO-FLAG = 'S' OR = 'K' OR = 'G'  /* NG2
      FOR #J 1 TO 30
        IF STATUS.LINKED-CN ( #J ) = 0
          STATUS.LINKED-CN ( #J ) := AP-Tracking.ID-NUMBER
          UPDATE (0208)
          ESCAPE BOTTOM
        END-IF
      END-FOR
    END-IF
  END-FIND
END-IF

ASSIGN #UPDATE (10) = TRUE

END
