* >Natural Source Header 000000
* :Mode S
* :CP ISO_8859-1:1987
* :LineIncrement 10
* <Natural Source Header
* PROGRAM-ID: ATHP05PZ    - MEMBERSHIPS EOJ STATISTICS PROCESSING
*
*  THIS PROGRAM RUNS IN BATCH MODE ONLY
*
*  MODIFICATIONS:
*    0790  CHANGE MANNING STATISTICS   PER MITCHELL    JAK
* SAG  11292005 RH1  SS - Modified the custom coded ON ERROR stmt &    *
*                    replaced it with copycode GABNDCX3                *
* DRW 08/21/2008 DW2 Gen Plus Statistics
* vxt 11/04/2010 vt1 change the length of name and rank fields .
* YAK 01/13/2014 YK1 Add GP2 plan 
************************************************************************
*
DEFINE DATA
GLOBAL USING ATHG05P0
LOCAL  USING GONERLXX                       /* SAG RH1 11292005 SS
LOCAL  USING ATHL05PB
LOCAL
1 #MANNING-ARMY-AUTH-GR /* date in G4111MMS/G411AMMS must be updated
 2 #MARA-01            (P5)  INIT <00000>      /* GA
 2 #MARA-02            (P5)  INIT <00010>      /* GEN
 2 #MARA-03            (P5)  INIT <00045>      /* LTG
 2 #MARA-04            (P5)  INIT <00097>      /* MG
 2 #MARA-05            (P5)  INIT <00150>      /* BG
 2 #MARA-06            (P5)  INIT <03411>      /* COL
 2 #MARA-07            (P5)  INIT <08462>      /* LTC
 2 #MARA-08            (P5)  INIT <12096>      /* MAJ
 2 #MARA-09            (P5)  INIT <18307>      /* CPT
 2 #MARA-10            (P5)  INIT <13983>      /* LT/1LT/2LT
 2 #MARA-11            (P5)  INIT <11820>      /* W1 thru W5
 2 #MARA-12            (P5)  INIT <02724>      /* E9
 2 #MARA-13            (P5)  INIT <10148>      /* E8
 2 #MARA-14            (P5)  INIT <35776>      /* E7
 2 #MARA-15            (P5)  INIT <53180>      /* E6
 2 #MARA-16            (P5)  INIT <69331>      /* E5
 2 #MARA-17            (P5)  INIT <05081>      /* E4
1 REDEFINE #MANNING-ARMY-AUTH-GR
 2 #MANNING-ARMY-AUTH  (P5/17)
*
1 #MANNING-AIRF-AUTH-GR    /* UPDATED  2/25/99
 2 #MAIA-01            (P5)  INIT <00000>      /* GA
 2 #MAIA-02            (P5)  INIT <00010>      /* GEN
 2 #MAIA-03            (P5)  INIT <00039>      /* LTG
 2 #MAIA-04            (P5)  INIT <00066>      /* MG
 2 #MAIA-05            (P5)  INIT <00139>      /* BG
 2 #MAIA-06            (P5)  INIT <03815>      /* COL
 2 #MAIA-07            (P5)  INIT <10418>      /* LTC
 2 #MAIA-08            (P5)  INIT <15612>      /* MAJ
 2 #MAIA-09            (P5)  INIT <27523>      /* CPT
 2 #MAIA-10            (P5)  INIT <14250>      /* LT/1LT/2LT
 2 #MAIA-11            (P5)  INIT <00000>      /* ALL WO
 2 #MAIA-12            (P5)  INIT <02947>      /* E9
 2 #MAIA-13            (P5)  INIT <05896>      /* E8
 2 #MAIA-14            (P5)  INIT <29606>      /* E7
 2 #MAIA-15            (P5)  INIT <38280>      /* E6
 2 #MAIA-16            (P5)  INIT <73461>      /* E5
 2 #MAIA-17            (P5)  INIT <00000>      /* E4  /* there is no e4
1 REDEFINE #MANNING-AIRF-AUTH-GR
 2 #MANNING-AIRF-AUTH  (P5/17)
*
1 #REPT-EXTRACT          (A119)                                   /* vt1 was 74
1 REDEFINE #REPT-EXTRACT
 2 #RE-SECTION         (A1)
 2 #RE-SUBSECTION      (A1)
 2 #RE-NAME-ID
  3 #RE-NAME-1         (A70)                                     /* vt1 was 25
  3 #RE-FILL-1         (A1)
  3 #RE-ID-NUMBER-2    (N6)
 2 REDEFINE #RE-NAME-ID
  3 #RE-ID-NUMBER-1    (N6)
  3 #RE-FILL-2         (A1)
  3 #RE-NAME-2         (A70)                                      /* vt1 was 25
 2 #RE-UNITS-GAIN-LOSS (N2)
 2 #RE-CURR-UNITS      (N2)
 2 #RE-ISS-AGE         (A2)
 2 #RE-ISS-DATE        (A8)
 2 #RE-TYPE            (A4)
 2 #RE-TERM-AGE        (N3)
 2 #RE-TERM-DATE       (A8)
 2 #RE-PLAN            (A3)
 2 #RE-RANK            (A3)
 2 #RE-STAT            (A1)
 2 #RE-SERV            (A3)
 2 #RE-MODE            (A1)
1 REDEFINE #REPT-EXTRACT
 2 #RE-FILL1           (A2)
 2 #RE-ACT-RET-SEP  (3)
  3 #RE-LOSS-BY-GRADE  (P5/6)
 2 #RE-FILL2           (A18)
*
1 #I1              (I2)
1 #I2              (I2)
1 #I3              (I2)
1 #I4              (I2)
1 #I5              (I2)
1 #IAGE            (I2)
1 #IRANK           (I2)
1 #ISERV           (I2)
1 #ISTAT           (I2)
1 #IPLAN           (I2)
1 #ISDTQ           (I2)
1 #ISDTQX          (I2)
1 #ITYPE           (I2)
1 #IGRADE          (I2)
1 #ITRANS          (I2)
1 #ILOSS           (I2)
1 #HOLD-ILOSS      (I2)
1 #CALC-AGE        (P5)
1 #ACC-NUM-UNITS   (P3)
1 #LOSSES          (L)    /* TRUE IF LOSSES
1 #LOSS-ON-LINE     (L)    /* TRUE IF CUR LINE HAS LOSS
1 #GAIN-ON-LINE     (L)    /* TRUE IF CUR LINE HAS GAIN
1 #INTRO-COMP-GRADE (L)    /* TRUE IF MBR IS INTRO LESS THAN 5 YRS
1 #CSV-OR-LAPS      (L)
1 #MATCH-ISS        (L)
*
1 #WORK-YYYYMMDD    (N8)
1 REDEFINE #WORK-YYYYMMDD
 2 #WORK-CENT       (A2)
 2 #WORK-YY         (A2)
 2 #WORK-MM         (A2)
 2 #WORK-DD         (A2)
*
1 #ACC-ME-TOT-MEMBERS   (P7)
1 #ACC-ME-TOT-MEMBERSHIPS (P7)
1 #AT-LEAST-1-SEGMENT   (L)
1 #POLICY-EXPIRED       (L)
1 #STATS-REC-FOUND      (L)
1 #TOT-MBRS             (P7)
1 #TOT-SHIPS            (P7)
*
1 #STATS-ISN          (P8)
1 #MBR-STATS-KEY      (N6)
1 REDEFINE #MBR-STATS-KEY
 2 #MBR-STATS-KEY-YYYY (N4)
 2 #MBR-STATS-KEY-MM   (N2)
*
1 #LAST-MON-MBR-STATS-KEY      (N6)
1 REDEFINE #LAST-MON-MBR-STATS-KEY
 2 #LAST-MON-MBR-STATS-KEY-YYYY (N4)
 2 #LAST-MON-MBR-STATS-KEY-MM   (N2)
*
1 #ABEND-CODE       (I4)
*
END-DEFINE
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*
ON ERROR
*   WRITE   / '*E R R O R - N R    ' *ERROR-NR      /* SAG RH1 11292005 SS - BEGIN
*     / '*E R R O R - L I N E' *ERROR-LINE
*   WRITE   / ' FILLER'
*   WRITE   / ' FILLER'
*   WRITE   / ' FILLER'
*   MOVE +4095 TO #ABEND-CODE
*   CALL 'ABEND' USING #ABEND-CODE  /* USER 4095
INCLUDE GABNDCX3
STOP                                                 /* SAG RH1 11292005 SS - END
END-ERROR
*
FORMAT PS=72
WRITE TITLE LEFT 'PROGRAM: ATHP05P0'              /* USE DRIVER NAME
             5X 'DATE:' *DAT4U 5X 'TIME:' *TIMX
*
IF PROCESS-SWITCH = 'F'                   /* FINALIZE MODE
  PERFORM UPDATE-MBR-STATS
*
  MOVE '9'             TO #RE-SECTION
  MOVE 'END OF REPORT' TO #RE-NAME-1
  WRITE WORK 5 #REPT-EXTRACT
*
  ESCAPE ROUTINE
END-IF
*
* * * * * * * * * * * * * * * * * *
DEFINE SUBROUTINE UPDATE-MBR-STATS
* * * * * * * * * * * * * * * * * *
*
MOVE #C-RUN-DT-YYYY TO #MBR-STATS-KEY-YYYY
MOVE #C-RUN-DT-MM   TO #MBR-STATS-KEY-MM
*
MOVE #MBR-STATS-KEY TO #LAST-MON-MBR-STATS-KEY
SUBTRACT 1 FROM #LAST-MON-MBR-STATS-KEY-MM
*
IF #LAST-MON-MBR-STATS-KEY-MM = 0
  MOVE 12 TO #LAST-MON-MBR-STATS-KEY-MM
  SUBTRACT 1 FROM #LAST-MON-MBR-STATS-KEY-YYYY
END-IF
*
MOVE TRUE TO #STATS-REC-FOUND
*
FIND (1) MBR-STATS-V WITH MONTH-KEY = #LAST-MON-MBR-STATS-KEY
  IF NO RECORDS FOUND
    MOVE FALSE TO #STATS-REC-FOUND
  END-NOREC
*
  MOVE *ISN TO #STATS-ISN
END-FIND
*
IF #STATS-REC-FOUND
  GET MBR-STATS-V #STATS-ISN
*                                    SUM NEW BUSINESS TOTALS
  FOR #I1 1 TO 2
    ADD #MBC-NU-POLS-TOTAL-NEW (#I1) TO #MBC-NU-POLS-TOTAL-TOTAL (#I1)
    ADD #MBC-NU-POLS-TOTAL-ADDL(#I1) TO #MBC-NU-POLS-TOTAL-TOTAL (#I1)
    ADD #MBC-NU-POLS-TOTAL-AGE-NEW (#I1)
                             TO #MBC-NU-POLS-TOTAL-AGE-TOTAL (#I1)
    ADD #MBC-NU-POLS-TOTAL-AGE-ADDL(#I1)
                             TO #MBC-NU-POLS-TOTAL-AGE-TOTAL (#I1)
    COMPUTE ROUNDED #MBC-NU-POLS-AVG-AGE-NEW (#I1) =
      #MBC-NU-POLS-TOTAL-AGE-NEW (#I1) / #MBC-NU-POLS-TOTAL-NEW (#I1)
    COMPUTE ROUNDED #MBC-NU-POLS-AVG-AGE-ADDL (#I1) =
      #MBC-NU-POLS-TOTAL-AGE-ADDL (#I1) / #MBC-NU-POLS-TOTAL-ADDL (#I1)
    COMPUTE ROUNDED #MBC-NU-POLS-AVG-AGE-TOTAL (#I1) =
      #MBC-NU-POLS-TOTAL-AGE-TOTAL(#I1) / #MBC-NU-POLS-TOTAL-TOTAL(#I1)
    ADD #MBC-NU-POLS-BY-AGE-NEW (#I1, *)
                                   TO #MBC-NU-POLS-BY-AGE-TOTAL(#I1, *)
    ADD #MBC-NU-POLS-BY-AGE-ADDL (#I1, *)
                                   TO #MBC-NU-POLS-BY-AGE-TOTAL(#I1, *)
    ADD #MBC-NU-POLS-BY-RANK-NEW (#I1, *)
                                   TO #MBC-NU-POLS-BY-RANK-TOTAL(#I1, *)
    ADD #MBC-NU-POLS-BY-RANK-ADDL(#I1, *)
                                   TO #MBC-NU-POLS-BY-RANK-TOTAL(#I1, *)
  END-FOR
*                                    SUM TERM/TRANS  TOTALS
  FOR #I1 1 TO 2
    FOR #I2 1 TO 4
      COMPUTE ROUNDED #MBC-LOST-POLS-AVG-AGE (#I1, #I2) =
        #MBC-LOST-POLS-TOTAL-AGE (#I1, #I2)
                                       / #MBC-LOST-POLS-TOTAL (#I1, #I2)
    END-FOR
  END-FOR
*                                    SUM MBRSHIP TOTALS
  ADD #EXPIRE-MBRS  TO LOSS-MBRS  (4)
  ADD #EXPIRE-LINES TO LOSS-SHIPS (4)
*
  ADD ME-MBR-BY-UNITS (*)   TO   #TOT-MBRS
  ADD GAIN-MBRS      (1:10) TO   #TOT-MBRS
  ADD GAIN-MBRS       (20)  TO   #TOT-MBRS
  SUBTRACT LOSS-MBRS  (*)   FROM #TOT-MBRS
*
  ADD ME-SHIPS-BY-UNITS (*)     TO   #TOT-SHIPS
* ADD ME-PAID-UP-UNITS          TO   #TOT-SHIPS
* ADD ME-ETI-UNITS              TO   #TOT-SHIPS
  ADD GAIN-SHIPS        (*)     TO   #TOT-SHIPS
  SUBTRACT LOSS-SHIPS   (*)     FROM #TOT-SHIPS
*
*           CHECK FOR MISMATCHES
  ADD #ME-MBR-BY-UNITS (*) TO #ACC-ME-TOT-MEMBERS
*
  ADD #ME-LINES-BY-UNITS (*) TO #ACC-ME-TOT-MEMBERSHIPS
* ADD #ME-ETI-LINES          TO #ACC-ME-TOT-MEMBERSHIPS
* ADD #ME-PAID-UP-LINES      TO #ACC-ME-TOT-MEMBERSHIPS
*
  IF   (#TOT-MBRS NE #ACC-ME-TOT-MEMBERS)
   OR (#TOT-SHIPS NE #ACC-ME-TOT-MEMBERSHIPS)
    WRITE /
        'MISMATCHED ACCUMS FROM ATHP05PZ - ARMY/AIRF GAINS MAY BE BAD'
    WRITE 'GAIN MEMBERS       = ' GAIN-MBRS  (*)
    WRITE 'LOSS MEMBERS       = ' LOSS-MBRS  (*)
    WRITE 'GAIN UNITS         = ' GAIN-SHIPS (*)
    WRITE 'LOSS UNITS         = ' LOSS-SHIPS (*)
  END-IF
*
*         RESET COUNTS IN CASE OF ERRORS  ** stopped 3/96
* MOVE #MBC-NU-POLS-BY-SDTQ-NEW  (1, 1:7) TO GAIN-MBRS  (1:7)
* MOVE #MBC-NU-FACE-BY-SDTQ-NEW  (1, 1:7) TO GAIN-FAC-AMT (1:7)
* MOVE #MBC-NU-POLS-BY-SDTQ-ADDL (1, 1:7) TO GAIN-MBRS  (11:17)
* MOVE #MBC-NU-FACE-BY-SDTQ-ADDL (1, 1:7) TO GAIN-FAC-AMT (11:17)
*
* MOVE #MBC-LOST-POLS-BY-TYPE (1, 1:3) TO LOSS-MBRS  (1:3)
* MOVE #MBC-LOST-POLS-BY-TYPE (2, 1:3) TO LOSS-SHIPS (1:3)
*
  UPDATE (0205)
END-IF
*
MOVE TRUE TO #STATS-REC-FOUND
*
FIND (1) MBR-STATS-V WITH MONTH-KEY = #MBR-STATS-KEY
*
  IF NO RECORDS FOUND
    MOVE FALSE TO #STATS-REC-FOUND
  END-NOREC
*
  MOVE *ISN TO #STATS-ISN
*
END-FIND
*
IF #STATS-REC-FOUND
  GET MBR-STATS-V #STATS-ISN
*
  WRITE / 'MSG ATHP05PB' /
  WRITE 'CURRENT MONTHS MEMBERSHIP STATISTICS RECORD ALREADY EXISTS'
*
END-IF
*
* RESET MBR-STATS-V.CURRENT-GAINS (*)
RESET MBR-STATS-V.GAIN-MBRS (*)
RESET MBR-STATS-V.GAIN-SHIPS (*)
RESET MBR-STATS-V.GAIN-FAC-AMT (*)
RESET MBR-STATS-V.TOT-GAIN-ARMY-NEW-MBRS
RESET MBR-STATS-V.TOT-GAIN-ARMY-ADDL-MBRS
RESET MBR-STATS-V.TOT-GAIN-ARMY-UNITS
RESET MBR-STATS-V.TOT-GAIN-AIRF-NEW-MBRS
RESET MBR-STATS-V.TOT-GAIN-AIRF-ADDL-MBRS
RESET MBR-STATS-V.TOT-GAIN-AIRF-UNITS
RESET MBR-STATS-V.APPL-REJ-NEW-MBRS
RESET MBR-STATS-V.APPL-REJ-ADDL-MBRS
RESET MBR-STATS-V.APPL-REJ-UNITS
RESET MBR-STATS-V.RESTRICTED-NEW-MBRS
RESET MBR-STATS-V.RESTRICTED-UNITS
RESET MBR-STATS-V.CURRENT-LOSSES (*)
RESET MBR-STATS-V.NET-DEATH-BENE
RESET MBR-STATS-V.LOSS-DEATH-ACTIVE-MBRS
RESET MBR-STATS-V.LOSS-DEATH-ACTIVE-UNITS
RESET MBR-STATS-V.LOSS-DEATH-RETIRED-MBRS
RESET MBR-STATS-V.LOSS-DEATH-RETIRED-UNITS
RESET MBR-STATS-V.LOSS-DEATH-TOTAL-AGE
RESET MBR-STATS-V.INT-MBR-ARMY      (*)
RESET MBR-STATS-V.INT-MBR-AIRF      (*)
RESET MBR-STATS-V.INT-MBR-ARMY-ROTC (*)
RESET MBR-STATS-V.INT-MBR-AIRF-ROTC (*)
RESET MBR-STATS-V.INT-MBR-ARMY-OCS  (*)
RESET MBR-STATS-V.INT-MBR-AIRF-OTS  (*)
*
MOVE #MANNING-ARMY-AUTH (*) TO MBR-STATS-V.ARMY-AUTH   (*)
MOVE #MBC-MANNING-ARMY  (*) TO MBR-STATS-V.ARMY-AAFMAA (*)
MOVE #MANNING-AIRF-AUTH (*) TO MBR-STATS-V.AIRF-AUTH   (*)
MOVE #MBC-MANNING-AIRF  (*) TO MBR-STATS-V.AIRF-AAFMAA (*)
MOVE #MBC-SERVICE-COUNT (1, 1) TO MBR-STATS-V.ARMY-MBRS  (1)
MOVE #MBC-SERVICE-COUNT (1, 2) TO MBR-STATS-V.AIRF-MBRS  (1)
MOVE #MBC-SERVICE-COUNT (1, 3) TO MBR-STATS-V.NV-CG-MBRS (1)
MOVE #MBC-SERVICE-COUNT (1, 4) TO MBR-STATS-V.MAR-MBRS   (1)
ADD  #MBC-SERVICE-COUNT (1, 5) TO MBR-STATS-V.NV-CG-MBRS (1)
MOVE #MBC-SERVICE-COUNT (2, 1) TO MBR-STATS-V.ARMY-MBRS  (2)
MOVE #MBC-SERVICE-COUNT (2, 2) TO MBR-STATS-V.AIRF-MBRS  (2)
MOVE #MBC-SERVICE-COUNT (2, 3) TO MBR-STATS-V.NV-CG-MBRS (2)
MOVE #MBC-SERVICE-COUNT (2, 4) TO MBR-STATS-V.MAR-MBRS   (2)
ADD  #MBC-SERVICE-COUNT (2, 5) TO MBR-STATS-V.NV-CG-MBRS (2)
MOVE #MBC-SERVICE-COUNT (3, 1) TO MBR-STATS-V.ARMY-MBRS  (3)
MOVE #MBC-SERVICE-COUNT (3, 2) TO MBR-STATS-V.AIRF-MBRS  (3)
MOVE #MBC-SERVICE-COUNT (3, 3) TO MBR-STATS-V.NV-CG-MBRS (3)
MOVE #MBC-SERVICE-COUNT (3, 4) TO MBR-STATS-V.MAR-MBRS   (3)
ADD  #MBC-SERVICE-COUNT (3, 5) TO MBR-STATS-V.NV-CG-MBRS (3)
MOVE #MBC-ACTIVE        TO MBR-STATS-V.TOTAL-MBR-COUNTS   (1)
MOVE #MBC-INACTIVE      TO MBR-STATS-V.TOTAL-MBR-COUNTS   (2)
MOVE #MBC-DEAD          TO MBR-STATS-V.TOTAL-MBR-COUNTS   (3)
MOVE #MBC-WIDOW         TO MBR-STATS-V.TOTAL-MBR-COUNTS   (4)
MOVE #MBC-INTR-CADETS-A-MALE      TO MBR-STATS-V.CADET-COUNTS (1)
MOVE #MBC-INTR-CADETS-A-FEMALE    TO MBR-STATS-V.CADET-COUNTS (2)
MOVE #MBC-INTR-CADETS-F-MALE      TO MBR-STATS-V.CADET-COUNTS (3)
MOVE #MBC-INTR-CADETS-F-FEMALE    TO MBR-STATS-V.CADET-COUNTS (4)
MOVE #MBC-INTR-CADETS-ACR-MALE    TO MBR-STATS-V.CADET-COUNTS (5)
MOVE #MBC-INTR-CADETS-ACR-FEMALE  TO MBR-STATS-V.CADET-COUNTS (6)
MOVE #MBC-INTR-CADETS-FCR-MALE    TO MBR-STATS-V.CADET-COUNTS (7)
MOVE #MBC-INTR-CADETS-FCR-FEMALE  TO MBR-STATS-V.CADET-COUNTS (8)
MOVE #MBC-INTR-CADETS-OTHER       TO MBR-STATS-V.CADET-COUNTS (9)
MOVE #MBC-MEMBER-INTR             TO MBR-STATS-V.IM-MBR-COUNTS
MOVE #MBC-LOSSES-MBRS (1, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (1)
MOVE #MBC-LOSSES-MBRS (1, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (1)
MOVE #MBC-LOSSES-MBRS (1, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (1)
MOVE #MBC-LOSSES-MBRS (2, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (2)
MOVE #MBC-LOSSES-MBRS (2, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (2)
MOVE #MBC-LOSSES-MBRS (2, 1)      TO MBR-STATS-V.LOSSES-MBRS-SEP (2)
MOVE #MBC-LOSSES-MBRS (3, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (3)
MOVE #MBC-LOSSES-MBRS (3, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (3)
MOVE #MBC-LOSSES-MBRS (3, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (3)
MOVE #MBC-LOSSES-MBRS (4, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (4)
MOVE #MBC-LOSSES-MBRS (4, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (4)
MOVE #MBC-LOSSES-MBRS (4, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (4)
MOVE #MBC-LOSSES-MBRS (5, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (5)
MOVE #MBC-LOSSES-MBRS (5, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (5)
MOVE #MBC-LOSSES-MBRS (5, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (5)
MOVE #MBC-LOSSES-MBRS (6, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (6)
MOVE #MBC-LOSSES-MBRS (6, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (6)
MOVE #MBC-LOSSES-MBRS (6, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (6)
MOVE #MBC-LOSSES-MBRS (7, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (7)
MOVE #MBC-LOSSES-MBRS (7, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (7)
MOVE #MBC-LOSSES-MBRS (7, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (7)
MOVE #MBC-LOSSES-MBRS (8, 1)      TO MBR-STATS-V.LOSSES-MBRS-ACT (8)
MOVE #MBC-LOSSES-MBRS (8, 2)      TO MBR-STATS-V.LOSSES-MBRS-RET (8)
MOVE #MBC-LOSSES-MBRS (8, 3)      TO MBR-STATS-V.LOSSES-MBRS-SEP (8)
MOVE #MBC-LOSSES-UNITS (1, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (1)
MOVE #MBC-LOSSES-UNITS (1, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (1)
MOVE #MBC-LOSSES-UNITS (1, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (1)
MOVE #MBC-LOSSES-UNITS (2, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (2)
MOVE #MBC-LOSSES-UNITS (2, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (2)
MOVE #MBC-LOSSES-UNITS (2, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (2)
MOVE #MBC-LOSSES-UNITS (3, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (3)
MOVE #MBC-LOSSES-UNITS (3, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (3)
MOVE #MBC-LOSSES-UNITS (3, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (3)
MOVE #MBC-LOSSES-UNITS (4, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (4)
MOVE #MBC-LOSSES-UNITS (4, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (4)
MOVE #MBC-LOSSES-UNITS (4, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (4)
MOVE #MBC-LOSSES-UNITS (5, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (5)
MOVE #MBC-LOSSES-UNITS (5, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (5)
MOVE #MBC-LOSSES-UNITS (5, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (5)
MOVE #MBC-LOSSES-UNITS (6, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (6)
MOVE #MBC-LOSSES-UNITS (6, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (6)
MOVE #MBC-LOSSES-UNITS (6, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (6)
MOVE #MBC-LOSSES-UNITS (7, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (7)
MOVE #MBC-LOSSES-UNITS (7, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (7)
MOVE #MBC-LOSSES-UNITS (7, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (7)
MOVE #MBC-LOSSES-UNITS (8, 1)     TO MBR-STATS-V.LOSSES-UNITS-ACT (8)
MOVE #MBC-LOSSES-UNITS (8, 2)     TO MBR-STATS-V.LOSSES-UNITS-RET (8)
MOVE #MBC-LOSSES-UNITS (8, 3)     TO MBR-STATS-V.LOSSES-UNITS-SEP (8)
MOVE #MBC-LOSSES-PARTIAL-UNITS(*) TO MBR-STATS-V.LOSSES-PARTIAL-UNITS(*)
*
FIND (1) NT-V WITH ID-NUMBER = 800001
  IF NO RECORDS FOUND
    WRITE 'INTRO MBR NX RECORD NOT FOUND'
  END-NOREC
*
  MOVE CURR-YEAR      (1) TO MBR-STATS-V.INT-MBR-ARMY      (4)
  MOVE CURR-YEAR      (2) TO MBR-STATS-V.INT-MBR-AIRF      (4)
  MOVE CURR-YEAR      (3) TO MBR-STATS-V.INT-MBR-ARMY-ROTC (4)
  MOVE CURR-YEAR      (4) TO MBR-STATS-V.INT-MBR-AIRF-ROTC (4)
  MOVE CURR-YEAR      (5) TO MBR-STATS-V.INT-MBR-ARMY-OCS  (4)
  MOVE CURR-YEAR      (6) TO MBR-STATS-V.INT-MBR-AIRF-OTS  (4)
  MOVE NEXT-YEAR      (1) TO MBR-STATS-V.INT-MBR-ARMY      (3)
  MOVE NEXT-YEAR      (2) TO MBR-STATS-V.INT-MBR-AIRF      (3)
  MOVE NEXT-YEAR      (3) TO MBR-STATS-V.INT-MBR-ARMY-ROTC (3)
  MOVE NEXT-YEAR      (4) TO MBR-STATS-V.INT-MBR-AIRF-ROTC (3)
  MOVE NEXT-YEAR      (5) TO MBR-STATS-V.INT-MBR-ARMY-OCS  (3)
  MOVE NEXT-YEAR      (6) TO MBR-STATS-V.INT-MBR-AIRF-OTS  (3)
  MOVE NEXT-NEXT-YEAR (1) TO MBR-STATS-V.INT-MBR-ARMY      (2)
  MOVE NEXT-NEXT-YEAR (2) TO MBR-STATS-V.INT-MBR-AIRF      (2)
  MOVE NEXT-NEXT-YEAR (3) TO MBR-STATS-V.INT-MBR-ARMY-ROTC (2)
  MOVE NEXT-NEXT-YEAR (4) TO MBR-STATS-V.INT-MBR-AIRF-ROTC (2)
  MOVE NEXT-NEXT-YEAR (5) TO MBR-STATS-V.INT-MBR-ARMY-OCS  (2)
  MOVE NEXT-NEXT-YEAR (6) TO MBR-STATS-V.INT-MBR-AIRF-OTS  (2)
  MOVE OTHER-YEAR     (1) TO MBR-STATS-V.INT-MBR-ARMY      (1)
  MOVE OTHER-YEAR     (2) TO MBR-STATS-V.INT-MBR-AIRF      (1)
  MOVE OTHER-YEAR     (3) TO MBR-STATS-V.INT-MBR-ARMY-ROTC (1)
  MOVE OTHER-YEAR     (4) TO MBR-STATS-V.INT-MBR-AIRF-ROTC (1)
  MOVE OTHER-YEAR     (5) TO MBR-STATS-V.INT-MBR-ARMY-OCS  (1)
  MOVE OTHER-YEAR     (6) TO MBR-STATS-V.INT-MBR-AIRF-OTS  (1)
END-FIND
*
MOVE #MBR-STATS-KEY         TO MBR-STATS-V.MONTH-KEY
MOVE #ME-MBR-BY-UNITS   (*) TO MBR-STATS-V.ME-MBR-BY-UNITS   (*)
MOVE #ME-LINES-BY-UNITS (*) TO MBR-STATS-V.ME-SHIPS-BY-UNITS (*)
MOVE #ME-LINES-BY-PLAN  (*) TO MBR-STATS-V.ME-LINES-BY-PLAN (*)
*
RESET ME-SHIPS-BY-PLAN (*)
FOR #I1 1 TO 7      /* OL/20/30/7P/rt/lt/so
  IF #I1 = 1 OR = 2 OR = 3   /* ol/20/30
    MOVE #I1 TO #I2
  ELSE
    COMPUTE #I2 = #I1 + 1    /* 7P/RT/LT/SO/FSO/GPL/GP2    /* DW2 YK1
*   MOVE 5 TO #I2            /* 7P/RT/LT/SO/FSO
  END-IF
*
  ADD #MBC-UNITS-LINES (1, #I1) TO ME-SHIPS-BY-PLAN (#I2)  /* PP
  ADD #MBC-UNITS-LINES (2, #I1) TO ME-SHIPS-BY-PLAN (#I2)  /* PDUP
  ADD #MBC-UNITS-LINES (3, #I1) TO ME-SHIPS-BY-PLAN (4)    /* ETI
END-FOR
*
MOVE #ME-PAID-UP-LINES      TO MBR-STATS-V.ME-PAID-UP-UNITS
MOVE #ME-PAID-UP-DB         TO MBR-STATS-V.ME-PAID-DB
MOVE #ME-ETI-LINES          TO MBR-STATS-V.ME-ETI-UNITS
MOVE #ME-ETI-DB             TO MBR-STATS-V.ME-ETI-DB
MOVE #ME-INS-IN-FORCE       TO MBR-STATS-V.ME-INS-IN-FORCE
WRITE 'total ins-in-force=' #ME-INS-IN-FORCE
MOVE #MBC-ARMY-MEMBERS      TO MBR-STATS-V.ME-TOT-ARMY-MBRS
MOVE #MBC-AIRF-MEMBERS      TO MBR-STATS-V.ME-TOT-AIRF-MBRS
MOVE #MBC-OTHERS-MEMBERS    TO MBR-STATS-V.ME-TOT-OTHERS-MBRS
MOVE 01                     TO MBR-STATS-V.LAST-NU-POL-ADDED-DAY
MOVE #ME-TOT-LINES          TO MBR-STATS-V.ME-TOT-PLANS
MOVE #TOT-PUP-LINES         TO MBR-STATS-V.ME-TOT-PUP-PLANS
MOVE #WL-DB-CHG             TO MBR-STATS-V.WL-DB-CHG
MOVE #LT-50-55-DB-DROP      TO MBR-STATS-V.LT-50-55-DB-DROP
MOVE #TOT-CONTACTS          TO MBR-STATS-V.TOT-CONTACTS
*
WRITE 'mbc-active   =' #MBC-ACTIVE
WRITE 'mbc-inactive =' #MBC-INACTIVE
WRITE 'mbc-dead     =' #MBC-DEAD
WRITE 'mbc-widow    =' #MBC-WIDOW 'READ BY WIDOW-KEY BYPASS AFSC & SAMP'
WRITE (3) 'Total MS DB Gains         =' MBR-STATS-V.GAIN-DB
WRITE (3) 'Total MS DB Death Loss    =' MBR-STATS-V.LOSS-DB-DEATH
WRITE (3) 'Total MS DB Non-Death Loss=' MBR-STATS-V.LOSS-DB-NON-DEATH
WRITE 'EXISTING MS GAINS/LOSS ='
WRITE 'ACCUMED HERE *  LOADED BY ATHPSTAT'
WRITE #GAIN-LINES             MBR-STATS-V.GAIN-PLANS
WRITE #LOSS-LINES-DEATH       MBR-STATS-V.LOSS-PLANS-DEATHS
WRITE #LOSS-LINES-NON-DEATH   MBR-STATS-V.LOSS-PLANS-NON-DEATHS
WRITE #GAIN-DB                MBR-STATS-V.GAIN-DB
WRITE #LOSS-DB-DEATH          MBR-STATS-V.LOSS-DB-DEATH
WRITE #LOSS-DB-NON-DEATH      MBR-STATS-V.LOSS-DB-NON-DEATH
* BELOW REMOVED 2/24/2000 SINCE THEY ARE UPDATED IN ATHPSTAT W PRE-M-E
* MOVE #GAIN-LINES            TO MBR-STATS-V.GAIN-PLANS
* MOVE #LOSS-LINES-DEATH      TO MBR-STATS-V.LOSS-PLANS-DEATHS
* MOVE #LOSS-LINES-NON-DEATH  TO MBR-STATS-V.LOSS-PLANS-NON-DEATHS
* MOVE #GAIN-DB               TO MBR-STATS-V.GAIN-DB
* MOVE #LOSS-DB-DEATH         TO MBR-STATS-V.LOSS-DB-DEATH
* MOVE #LOSS-DB-NON-DEATH     TO MBR-STATS-V.LOSS-DB-NON-DEATH
*
IF #STATS-REC-FOUND
  WRITE 'UPDATED MS-RECORD'
  UPDATE (0294)
ELSE
  WRITE 'STORED MS-RECORD'
  STORE MBR-STATS-V
END-IF
*
RESET #REPT-EXTRACT
RESET #I4                   /* 18 LINES
MOVE '7' TO #RE-SECTION     /* WRITE OUT ARMY LOSS TOTALS
*
FOR #I1 1 TO 6              /* TERM TYPE
  MOVE #I1 TO #RE-SUBSECTION
  FOR #I2 1 TO 3            /* ACT/RET/SEP
    RESET #I5               /* INTRO/FG/COMP/INTRO/FG/COMP
    ADD 1 TO #I5            /* INTRO/FG/COMP/INTRO/FG/COMP
    MOVE #ARMY-INTRO-MBRS (#I1, #I2) TO #RE-LOSS-BY-GRADE (#I2, #I5)
*
    ADD 1 TO #I5
    MOVE #ARMY-COMP-GRADE-MBRS (#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
    ADD 1 TO #I5
    MOVE #ARMY-FIELD-GRADE-MBRS (#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
*
    ADD 1 TO #I5              /* INTRO/FG/COMP/FG/COMP
    MOVE #ARMY-INTRO-UNITS(#I1, #I2) TO #RE-LOSS-BY-GRADE (#I2, #I5)
*
    ADD 1 TO #I5
    MOVE #ARMY-COMP-GRADE-UNITS(#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
    ADD 1 TO #I5
    MOVE #ARMY-FIELD-GRADE-UNITS(#I1, #I2)
                                      TO #RE-LOSS-BY-GRADE (#I2, #I5)
  END-FOR
*
  WRITE WORK 5 #REPT-EXTRACT
END-FOR
*
MOVE '8' TO #RE-SECTION     /* WRITE OUT AIRF LOSS TOTALS
*
FOR #I1 1 TO 6              /* TERM TYPE
  MOVE #I1 TO #RE-SUBSECTION
  FOR #I2 1 TO 3            /* ACT/RET/SEP
    RESET #I5               /* INTRO/FG/COMP/INTRO/FG/COMP
    ADD 1 TO #I5            /* INTRO/FG/COMP/INTRO/FG/COMP
    MOVE #AIRF-INTRO-MBRS (#I1, #I2) TO #RE-LOSS-BY-GRADE (#I2, #I5)
*
    ADD 1 TO #I5
    MOVE #AIRF-COMP-GRADE-MBRS (#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
    ADD 1 TO #I5
    MOVE #AIRF-FIELD-GRADE-MBRS (#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
*
    ADD 1 TO #I5              /* INTRO/FG/COMP/FG/COMP
    MOVE #AIRF-INTRO-UNITS(#I1, #I2) TO #RE-LOSS-BY-GRADE (#I2, #I5)
*
    ADD 1 TO #I5
    MOVE #AIRF-COMP-GRADE-UNITS(#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
    ADD 1 TO #I5
    MOVE #AIRF-FIELD-GRADE-UNITS(#I1, #I2)
                                       TO #RE-LOSS-BY-GRADE (#I2, #I5)
  END-FOR
*
  WRITE WORK 5 #REPT-EXTRACT
END-FOR
*
END TRANSACTION
*
END-SUBROUTINE /* (0180)
END
