* >Natural Source Header 000000
* :Mode S
* :CP ISO_8859-1:1987
* :LineIncrement 10
* <Natural Source Header
/** New Subprogram AUCNARV1.
/**
/** :author nguentchev
/* TODO: Enter your code here
DEFINE DATA
PARAMETER
1 #ADDR-REL
  2 CONTACT-ID (N8)
  2 ADDRESS-POOL-ID (N8)
  2 ADDR-TYPE-CD (A1)
  2 ADDR-LOCATION (A1)
  2 ATTENTION-LINE (A50)
  2 RETURNED-MAIL-IND (A1)
  2 PREVENT-OVER-IND (A1)
  2 ADDRESS-SOURCE (A1)
  2 STATUS (A1)
  2 STATUS-DATE (N8)
1 #ADDRESS-UI
  2 #ERRORS (L)
  2 #POS (I4)
  2 #STATUS-DATE (A10)
  2 #CERT-REQUEST (L)
  2 #ZIP (A10)
1 #MSG            (A) DYNAMIC
1 ErrorCode       (I4)
LOCAL
1 #CONTACT-ADDR-POOL    (I2/3)
1 #CONTACT-ADDR-POOL-ID (N8/3)
1 #ERROR-CODE-A         (A3)
1 REDEFINE #ERROR-CODE-A
  2 #ERROR-CODE-N       (N3)
1 A-ADD-REL VIEW OF A-ADDRESS-RELATIONSHIP
  2 ADDRESS-POOL-ID (N8)
  2 ADDR-TYPE-CD    (A1)
  2 STATUS          (A1)
1 PRIMARY           (A1) CONST <'P'>
1 SECONDARY         (A1) CONST <'S'>
1 BLANK             (A1) CONST <' '>
*
END-DEFINE
*
RESET #MSG #CONTACT-ADDR-POOL (*)
  #CONTACT-ADDR-POOL-ID (*)
FIND A-ADD-REL WITH CONTACT-ID = #ADDR-REL.CONTACT-ID
  DECIDE ON FIRST VALUE OF A-ADD-REL.ADDR-TYPE-CD
    VALUE PRIMARY
      IF A-ADD-REL.STATUS NE 'D'
        ADD 1 TO #CONTACT-ADDR-POOL (1)
        #CONTACT-ADDR-POOL-ID (1) := A-ADD-REL.ADDRESS-POOL-ID
      END-IF
    VALUE SECONDARY
      IF A-ADD-REL.STATUS NE 'D'
        ADD 1 TO #CONTACT-ADDR-POOL (2)
        #CONTACT-ADDR-POOL-ID (2) := A-ADD-REL.ADDRESS-POOL-ID
      END-IF
    NONE VALUE
      ADD 1 TO #CONTACT-ADDR-POOL (3)
  END-DECIDE
END-FIND
*
PERFORM CHECK-VALUES
IF #ERRORS
  ErrorCode := #ERROR-CODE-N
END-IF
/*
DEFINE CHECK-VALUES
/*     ============
IF #ADDR-REL.STATUS = 'R'
  IF #ADDR-REL.ADDR-TYPE-CD EQ PRIMARY AND #CONTACT-ADDR-POOL (1) > 0
    #ERROR-CODE-A := '357'  /* 9
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
    ESCAPE ROUTINE
  END-IF
  IF #ADDR-REL.ADDR-TYPE-CD EQ SECONDARY AND #CONTACT-ADDR-POOL (2) > 0
    #ERROR-CODE-A := '357'  /* 9
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
    ESCAPE ROUTINE
  END-IF
END-IF
*
IF #ADDR-REL.ADDR-TYPE-CD EQ PRIMARY AND #CONTACT-ADDR-POOL (1) > 0
  IF #CONTACT-ADDR-POOL-ID (1) NE #ADDR-REL.ADDRESS-POOL-ID
    #ERROR-CODE-A := '354'  /* 6
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
    ESCAPE ROUTINE
  END-IF
END-IF
*
IF #ADDR-REL.ADDR-TYPE-CD EQ SECONDARY AND #CONTACT-ADDR-POOL (2) > 0
  IF #CONTACT-ADDR-POOL-ID (2) NE #ADDR-REL.ADDRESS-POOL-ID
*   #ERROR-NBR := 7
    #ERROR-CODE-A := '355' 
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
    ESCAPE ROUTINE
  END-IF
END-IF
*
#MSG := FUNCTION-CV-CHECK (<'006',#ADDR-REL.ADDR-TYPE-CD>)
IF #MSG NE BLANK
  #ERRORS := TRUE; #ERROR-CODE-A := '999'
  #POS := POS ( #ADDR-REL.ADDR-TYPE-CD )
  ESCAPE ROUTINE
END-IF
*
#MSG := FUNCTION-CV-CHECK (<'017',#ADDR-REL.ADDRESS-SOURCE>)
IF #MSG NE BLANK
  #ERRORS := TRUE; #ERROR-CODE-A := '999'
  #POS := POS ( #ADDR-REL.ADDRESS-SOURCE )
  ESCAPE ROUTINE
END-IF
*
#MSG := FUNCTION-CV-CHECK (<'002',#ADDR-REL.ADDR-LOCATION>)
IF #MSG NE BLANK
  #ERRORS := TRUE; #ERROR-CODE-A := '999'
  #POS := POS ( #ADDR-REL.ADDR-LOCATION )
  ESCAPE ROUTINE
END-IF
*
#MSG := FUNCTION-CV-CHECK (<'004',#ADDR-REL.PREVENT-OVER-IND>)
IF #MSG NE BLANK
  #ERRORS := TRUE; #ERROR-CODE-A := '999'
  #POS := POS ( #ADDR-REL.PREVENT-OVER-IND )
  ESCAPE ROUTINE
END-IF
*
#MSG := FUNCTION-CV-CHECK (<'005',#ADDR-REL.RETURNED-MAIL-IND>)
IF #MSG NE BLANK
  #ERRORS := TRUE; #ERROR-CODE-A := '999'
  #POS := POS ( #ADDR-REL.RETURNED-MAIL-IND )
  ESCAPE ROUTINE
END-IF
*
#MSG := FUNCTION-CV-CHECK (<'018',#ADDR-REL.STATUS>)
IF #MSG NE BLANK
  #ERRORS := TRUE; #ERROR-CODE-A := '999'
  #POS := POS ( #ADDR-REL.STATUS )
  ESCAPE ROUTINE
END-IF
*
IF #ADDR-REL.STATUS = ' ' AND #STATUS-DATE NE ' '
*  #ERROR-NBR := 2
    #ERROR-CODE-A := '350'   
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
  ESCAPE ROUTINE
END-IF
*
IF #STATUS-DATE NE ' ' AND #STATUS-DATE NE MASK(MMDDYYYY)
*  #ERROR-NBR := 3
    #ERROR-CODE-A := '351'  
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
  ESCAPE ROUTINE
END-IF
*
IF #ADDR-REL.ADDR-TYPE-CD EQ ' '
*  #ERROR-NBR := 4
    #ERROR-CODE-A := '353'  
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
  ESCAPE ROUTINE
END-IF
*
IF #ADDR-REL.ADDRESS-SOURCE EQ ' '
*  #ERROR-NBR := 4
    #ERROR-CODE-A := '353'   
    #ERRORS := TRUE
    #MSG := F-ERROR-DESCRIPTION(< #ERROR-CODE-A >)
    #POS := POS ( #ADDR-REL.STATUS )
  ESCAPE ROUTINE
END-IF
END-SUBROUTINE
*
END

