* >Natural Source Header 000000
* :Mode S
* :CP ISO_8859-1:1987
* :LineIncrement 10
* <Natural Source Header
***************************************************************
* SUBPROGRAM-ID: GPRNTR04 - TRANSACTION LOG GENERIC MODULE 5
*                           Policy Roles/Beneficiaries
***************************************************************
*        MODIFICATION LOG
***************************************************************
* USER   DATE      TAG  REASON
* TMT    04222015       Initial Creation
* YAK    06202017  YK1  Changes for the Payer project EB&P III
***************************************************************
*
DEFINE DATA
PARAMETER
1 #FUNCTION            (A) DYNAMIC
PARAMETER USING GPRATR04   /* KXKXNDNF will Change name later         YK1
LOCAL USING GPRA0004       /* PDA to pass data to TR log subprogram
LOCAL USING GPRL0004
LOCAL
1 TR_DESCRIPTION       (A) DYNAMIC
1 I  (I4)
1 J  (I4)
1 K  (I4)
1 #LOG-ROLE-CHANGES    (A) DYNAMIC CONSTANT <2>
1 #LOG-BENE-CHANGES    (A) DYNAMIC CONSTANT <3>
1 #ROLE-CHANGE         (A) DYNAMIC CONSTANT <'RoleChng:'>
1 #BENE-CHANGE         (A) DYNAMIC CONSTANT <'BeneChng: '>
*
END-DEFINE
*
DECIDE ON FIRST VALUE #FUNCTION
  VALUE #LOG-ROLE-CHANGES
    TR_DESCRIPTION := #ROLE-CHANGE
    PERFORM LOG-ROLE-CHANGES
  VALUE #LOG-BENE-CHANGES
    TR_DESCRIPTION := #BENE-CHANGE
    PERFORM LOG-BENE-CHANGE
  NONE VALUE
    IGNORE
END-DECIDE
*
PERFORM WRITE-TRAN-LOG
*
DEFINE SUBROUTINE WRITE-TRAN-LOG
* ------------------------------
IF J NE 0
  #TR-NAME               := TR_NAME
  #TR-ID-NUMBER          := TR_ID_NUMBER
*   #LOG-DESCRIPTION       := ' '
  #TR-CLERK-ID           := TR_CLERK
  #TR-DATE-LAST-UPDATE   := BEFORE_IMAGE.DATE-LAST-UPDATE
*   #NEW-DATA-TAG(1)       := ' '
  CALLNAT 'GPRN0004'
    #TR-FIELDS #SYNC-FIELD-TABLE(*)
    #OLD-DATA-TABLE(*) #NEW-DATA-TABLE(*)
END-IF
END-SUBROUTINE
* ------------

DEFINE SUBROUTINE LOG-ROLE-CHANGES
* ------------------------------
FOR I = 1 TO *OCCURRENCE(BEFORE_IMAGE.ROLE)
  DECIDE FOR EVERY CONDITION
    WHEN BEFORE_IMAGE.ROLE(I) <> AFTER_IMAGE.ROLE(I)
      ADD 1 TO J
      #FIELD-DESCRIPTION(j) := #ROLE-CHANGE
      COMPRESS FULL BEFORE_IMAGE.ROLE(I)
        '   Name: ' BEFORE_IMAGE.FULL-NAME(I) 'Pol:' BEFORE_IMAGE.POLICY-NUMBER TO #OLD-DATA(J) LEAVING NO
      COMPRESS FULL AFTER_IMAGE.ROLE(I)
        '   Name: ' AFTER_IMAGE.FULL-NAME(I) 'Pol:'  AFTER_IMAGE.POLICY-NUMBER  TO #NEW-DATA(J) LEAVING NO
*   WHEN BEFORE_IMAGE.FULL-NAME(I) <> AFTER_IMAGE.FULL-NAME(I)
*     ADD 1 TO J
*     #FIELD-DESCRIPTION(j) := #ROLE-CHANGE
*     COMPRESS FULL 'Name: ' BEFORE_IMAGE.FULL-NAME(I) TO #OLD-DATA(J) LEAVING NO
*     COMPRESS FULL 'Name: ' AFTER_IMAGE.FULL-NAME TO #NEW-DATA(J) LEAVING NO
    WHEN NONE
      IGNORE
  END-DECIDE

END-FOR
* ADD 1 TO J
END-SUBROUTINE
* ------------

DEFINE SUBROUTINE LOG-BENE-CHANGE
* ------------------------------
DECIDE FOR EVERY CONDITION
  WHEN BEFORE_IMAGE.DESIGNATION-STATUS <> AFTER_IMAGE.DESIGNATION-STATUS
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL 'Status: ' BEFORE_IMAGE.DESIGNATION-STATUS
      '     Policy:' BEFORE_IMAGE.POLICY-NUMBER TO #OLD-DATA(J) LEAVING NO
    COMPRESS FULL 'Status: ' AFTER_IMAGE.DESIGNATION-STATUS
      '     Policy:' AFTER_IMAGE.POLICY-NUMBER TO #NEW-DATA(J) LEAVING NO

  WHEN BEFORE_IMAGE.PRIMARY-DESIG-TYPE        <> AFTER_IMAGE.PRIMARY-DESIG-TYPE
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL  'Prim Desig Type:' BEFORE_IMAGE.PRIMARY-DESIG-TYPE TO #OLD-DATA(J)
    COMPRESS FULL  'Prim Desig Type:' AFTER_IMAGE.PRIMARY-DESIG-TYPE TO #NEW-DATA(J)

  WHEN  BEFORE_IMAGE.CONTINGENT-DESIG-TYPE        <> AFTER_IMAGE.CONTINGENT-DESIG-TYPE
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL 'Cont Desig Type:' BEFORE_IMAGE.CONTINGENT-DESIG-TYPE TO #OLD-DATA(J)
    COMPRESS FULL 'Cont Desig Type:' AFTER_IMAGE.CONTINGENT-DESIG-TYPE TO #NEW-DATA(J)

  WHEN BEFORE_IMAGE.COMMON-DISASTER        <> AFTER_IMAGE.COMMON-DISASTER
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL  'Common Dis: ' BEFORE_IMAGE.COMMON-DISASTER TO #OLD-DATA(J) LEAVING NO
    COMPRESS FULL  'Common Dis: ' AFTER_IMAGE.COMMON-DISASTER TO #NEW-DATA(J) LEAVING NO

  WHEN BEFORE_IMAGE.ALL-CHILDREN-PRIMARY    <> AFTER_IMAGE.ALL-CHILDREN-PRIMARY
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL  'All Kids Prim: '  BEFORE_IMAGE.ALL-CHILDREN-PRIMARY TO #OLD-DATA(J) LEAVING NO
    COMPRESS FULL  'All Kids Prim: '  AFTER_IMAGE.ALL-CHILDREN-PRIMARY TO #NEW-DATA(J) LEAVING NO

  WHEN BEFORE_IMAGE.ALL-CHILDREN-CONTINGENT <> AFTER_IMAGE.ALL-CHILDREN-CONTINGENT
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL  'All Kids Cont: '  BEFORE_IMAGE.ALL-CHILDREN-CONTINGENT TO #OLD-DATA(J) LEAVING NO
    COMPRESS FULL 'All Kids Cont: '  AFTER_IMAGE.ALL-CHILDREN-CONTINGENT TO #NEW-DATA(J) LEAVING NO

  WHEN BEFORE_IMAGE.PER-STIRPES-PRIMARY      <> AFTER_IMAGE.PER-STIRPES-PRIMARY
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL 'Per Stirpes Prim: ' BEFORE_IMAGE.PER-STIRPES-PRIMARY TO #OLD-DATA(J) LEAVING NO
    COMPRESS FULL 'Per Stirpes Prim: ' AFTER_IMAGE.PER-STIRPES-PRIMARY  TO #NEW-DATA(J) LEAVING NO

  WHEN BEFORE_IMAGE.PER-STIRPES-CONTINGENT   <> AFTER_IMAGE.PER-STIRPES-CONTINGENT
    ADD 1 TO J
    #FIELD-DESCRIPTION(j) := #BENE-CHANGE
    COMPRESS FULL 'Per Stirpes Cont: ' BEFORE_IMAGE.PER-STIRPES-PRIMARY TO #OLD-DATA(J) LEAVING NO
    COMPRESS FULL 'Per Stirpes Cont: ' AFTER_IMAGE.PER-STIRPES-PRIMARY  TO #NEW-DATA(J) LEAVING NO

  WHEN *OCCURRENCE(BEFORE_IMAGE.ROLE) > 0
    FOR I 1 TO *OCCURRENCE(BEFORE_IMAGE.ROLE)
      ADD 1 TO J
      #FIELD-DESCRIPTION(J) := #BENE-CHANGE
      COMPRESS FULL
        ' Name: '    BEFORE_IMAGE.FULL-NAME(I)
        ' SSN: '     BEFORE_IMAGE.SSN(I)
        '              DOB: '     BEFORE_IMAGE.DOB(I)
        ' RES: '     BEFORE_IMAGE.RESTRICTION(I)
        ' SET: '     BEFORE_IMAGE.SETTLEMENT(I)
        ' Share: ' BEFORE_IMAGE.share(I) '%' TO #OLD-DATA(J) LEAVING NO
      COMPRESS FULL
        ' Name: '    AFTER_IMAGE.FULL-NAME(I)
        ' SSN: '     AFTER_IMAGE.SSN(I)
        '              DOB: '     AFTER_IMAGE.DOB(I)
        ' RES: '     AFTER_IMAGE.RESTRICTION(I)
        ' SET: '     AFTER_IMAGE.SETTLEMENT(I)
        ' Share: ' AFTER_IMAGE.share(I) '%' TO #NEW-DATA(J) LEAVING NO
    END-FOR
  WHEN NONE
    IGNORE
END-DECIDE
END-SUBROUTINE
* ------------

IF *SERVER-TYPE = 'DEVELOP'
  END TRANSACTION
END-IF

* *****************************
* DEFINE SUBROUTINE LOG-PO-TRAN
* *****************************
* *
* IF BEFORE_IMAGE.ANNS-DELIVERY-FLAG <> AFTER_IMAGE.ANNS-DELIVERY-FLAG
*   #I := #I + 1
*   #FIELD-DESCRIPTION(#I) := #ROLE-CHANGE
*   COMPRESS FULL 'Annual Statement Delivery ' BEFORE_IMAGE.ANNS-DELIVERY-FLAG TO #OLD-DATA(#I) LEAVING NO
*   COMPRESS FULL 'Annual Statement Delivery ' AFTER_IMAGE.ANNS-DELIVERY-FLAG  TO #NEW-DATA(#I) LEAVING NO
* END-IF
* IF BEFORE_IMAGE.BILL-DELIVERY-FLAG <> AFTER_IMAGE.BILL-DELIVERY-FLAG
*   #I := #I + 1
*   #FIELD-DESCRIPTION(#I) := #ROLE-CHANGE
*   COMPRESS FULL 'Billing Statement Delivery ' BEFORE_IMAGE.BILL-DELIVERY-FLAG TO #OLD-DATA(#I) LEAVING NO
*   COMPRESS FULL 'Billing Statement Delivery ' AFTER_IMAGE.BILL-DELIVERY-FLAG  TO #NEW-DATA(#I) LEAVING NO
* END-IF
* IF BEFORE_IMAGE.FIRMBA-DELIVERY-FLAG <> AFTER_IMAGE.FIRMBA-DELIVERY-FLAG
*   #I := #I + 1
*   #FIELD-DESCRIPTION(#I) := #ROLE-CHANGE
*   COMPRESS FULL 'FIR/MBA Delivery ' BEFORE_IMAGE.FIRMBA-DELIVERY-FLAG TO #OLD-DATA(#I) LEAVING NO
*   COMPRESS FULL 'FIR/MBA Delivery ' AFTER_IMAGE.FIRMBA-DELIVERY-FLAG  TO #NEW-DATA(#I) LEAVING NO
* END-IF
* *
* END-SUBROUTINE
*

*       DECIDE FOR EVERY CONDITION
*         WHEN BEFORE_IMAGE.ROLE(I) <> AFTER_IMAGE.ROLE(I)
*         WHEN NONE
*           IGNORE
*       END-DECIDE
* end transaction
END
