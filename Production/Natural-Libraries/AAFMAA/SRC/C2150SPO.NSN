* >Natural Source Header 000000
* :Mode S
* :CP ISO_8859-1:1987
* :LineIncrement 2
* <Natural Source Header
* PGM-ID: C2150SPO - Possible Options for Insurance
************************************************************************
*                       MODIFICATION LOG                               *
* USER   DATE      TAG  REASON                                         *
* DRW    01052005  DW1  if suffix is OLD use 20041231 LTII rates       *
* DRW    02012005  DW2  Add AL (Annuity Life) Processing               *
* DRW    04252005  DW3  Allow TERM quote for GEN age 18 thru 23        *
* DRW    04292005  DW4  Add DOB processing to GMAXSXX                  *
* DRW    05052005  DW5  Fix Minimum age quoting                        *
* DRW    05032005  DW6  Show all WL options for GEN under age 17       *
* DRW    05162995  DW7  Add SEX to GPREMSXX linkage                    *
* DRW    05202995  DW8  Add Smoker Indicator to PO Sceeen              *
* DRW    05232995  DW9  VLT VGLI LETTER APP PROCESSING                 *
* PAM    05312005  PM10 Adjust AVL-TDIV for 124156 per RLB             *
* PAM    06142005  PM11 Adjust tobacco and smoker to Nictoine          *
* DRW    08132007  DW12 Add Quot-LT2-Class Processing                  *
* DRW  10/01/2007  DW13 Delete AFSC Suffix's (FIR)                     *
* DRW  10/05/2007) DW14 Add 'Monthly Charge' to Eligible Msg           *
* PAM  03/11/2008  PM15 Display insured name for GEN                   *
* PAM  05/12/2008  PM16 Added new RT refund for 2008                   *
* DRW  08/13/2008  DW17 Generations Plus processing                    *
* DRW  09/02/2008  DW18 Fix non-GPL Prems on cases of less than age 12 *
* RSE  10/02/2009  RE1  Change PROCESS-IND/600K logic for Unification  *
* bz   11/19/2009  bz1  Remove Re1. Unification: Identify SAS Only     *
* PAM  12/24/2009  PM19 Added new generational insured requirements    *
* PAM  11/26/2010  PM20 Default smoker-flag to 'N' for non-insured     *
* NGG  20121029    NG1  LTII re-newable changes                        *
* RE1  03/07/2013  RE2  Add EZ Term on screen                          *
* NGG  03/25/2013  NG2  Changes for EZ Term                            *
* NGG  06/25/2013  NG3  Changes for Ticket 1584 and Ticket 1540        *
* TMT  12/31/2013  TT1  ADDED GP2 POLICY                               *
* vxt  05/20/2014  vt1  Policy rate change /Ticket 2656/               *
* TMT  10/14/2014  TT2 ANNUITYLife Harmonization                       *
************************************************************************
*
DEFINE DATA
PARAMETER USING C2150APO
LOCAL USING C2150LPO
LOCAL USING CONTPDA1
LOCAL
* below is used in linkage to C2151SPO
1 #SCN-AOD-YYYYMMDD (N8)
1 #SCN-AS-OF-DT     (A8)
1 REDEFINE #SCN-AS-OF-DT
  2 #SCN-AOD-N       (N8)
1 REDEFINE #SCN-AS-OF-DT
  2 #SCN-AOD-MMDD    (A4)
  2 #SCN-AOD-YYYY    (A4)
*
1 #SCN-DOB          (A8)
1 REDEFINE #SCN-DOB
  2 #SCN-DOB-N       (N8)
1 REDEFINE #SCN-DOB
  2 #SCN-DOB-MMDD    (A4)
  2 #SCN-DOB-YYYY    (A4)
*
1 #SCN-SPS-GEN      (A1)
1 #SCN-SPS-GEN-CV   (C)
1 #RATED-FACE-AMT   (P7.2/3)
1 #DESIRED-FACE-AMT (N7/3)
1 REDEFINE #DESIRED-FACE-AMT
  2 #DES-FACE-OCC    (3)
    3 #DES-FAC-N3     (N4)            /*TT increased size from 3 to 4
    3 #DES-FAC-REST   (N3)
1 #DESIRED-PLAN     (A1/10)
1 #FIRST-TIME       (L) INIT <TRUE>
1 #FROM-AT          (L)
1 #FROM-IM          (L)
1 #SO-MBR           (L)
1 #TERMED-MBR       (L)
1 #VT-TYPE    (A2)
1 #VT-TERM    (N2)
1 #VT-RIDER   (A1)
* above is linkage to C2151SPO
*
1 #POL-FEE          (N1.2) INIT <2.95>               /* vt4 was 3.00
1 #GPL-SELECTED    (L)              /* DW17
1 #REBUILD-GPL     (L)
1 #GPL-FAC-TO-USE  (N2/5)
1 #ORIG-FACE-AMT   (N7.2)
*
1 #REFUND-1-ONLINE (A78)
*
1 #ORIG-ID     (N6)
1 #TEXT        (A78)
1 #I1          (I2)
1 #I2          (I2)
1 #IFL         (I2)
1 #CGA-ISN     (P8)
1 #TODAY-YYYYMMDD-N    (N8)
1 REDEFINE #TODAY-YYYYMMDD-N
  2 #TODAY-YYYY   (N4)
  2 #TODAY-MM     (N2)
  2 #TODAY-DD     (N2)
1 #CGA-ID-G    (A6)
1 REDEFINE #CGA-ID-G
  2 #CGA-ID     (N6)
1 #SCRR-SEL    (A1/20)
1 #SCRR-SEL-CV (C/20)
1 #SCRR-TYPE   (A1/20)
1 #SCRR-NAME   (A25/20)
1 #SCRR-DOB-N  (N8/20)
1 #SCRR-DOB    (A10/20)
1 #SCRR-SSN-N  (N9/20)
1 #SCRR-SSN    (A11/20)
1 #SCRR-FACE-N (N6/20)
1 #SCRR-FACE   (A8/20)
1 #SCRR-AVAIL-N(N6/20)
1 #SCRR-AVAIL  (A12/20)
1 #SCRR-ACT-FLG (A1/20)
1 #ADD-GEN-SEL (A1)
1 #ADD-GEN-SEL-CV (C)
*
1 #SCR-SUFF (A3)
1 REDEFINE #SCR-SUFF
  2 #SCR-SUFF-FST-1 (A1)
  2 #SCR-SUFF-LST-2 (N2)
*
1 #CN    (N6)
1 REDEFINE #CN
  2 #CN-A  (A6)
1 #ADDL   (A10)
1 #I3   (I2)
1 #I4   (I2)
1 #I5   (I2)
*
1 #SSN-HIDE      (A9)   INIT <'ON FILE'>
1 #AVL-TDIV    (P7.2)
1 #DB          (P9.2)
1 #USE-AT-QUOT (L)
*
1 ST-V VIEW OF A-STATUS
  2 ID-NUMBER
  2 MEMBER-CONTACT-ID
  2 PROCESS-IND
  2 RANK
  2 NAME
  2 SSN
  2 MILITARY-STATUS
  2 LINKED-CN   (10)
  2 REDEFINE LINKED-CN
    3 LINKED-CN-A (A6/10)
  2 RESTRICT-MBR-SW
  2 SUSPEND-CODE
  2 CHIEF-OF-STAFF-IND
  2 INTRO-FLAG
  2 NAME-SP
  2 STATUS-CODE-SP
  2 SSN-SP
  2 DUES-ALL-PAID-IND
  2 ONLINE-ACTION-GN
  2 NUMBER-MEMBERSHIPS
  2 STATUS     (9)
  2 PAID-UP-DATE (9)
  2 ISSUE-DATE (9)
  2 REDEFINE ISSUE-DATE
    3 ISS-DT-OCC (9)
      4  ISSUE-DATE-YYYY (N4)
      4  ISSUE-DATE-MM (N2)
      4  ISSUE-DATE-DD (N2)
  2 PLAN       (9)
  2 REDEFINE PLAN
    3 PLAN-A1   (A1/9)
    3 PLAN-N2   (N2/9)
  2 PAY-STATUS (9)
  2 MONTH-ALLOC-AMT  (9)
  2 DEATH-BENEFIT      (9)
  2 NXT-MON-DEATH-BENEFIT  (9)
  2 SMOKER-FLAG        (9)
  2 NUM-MBRSHIPS     (9)
  2 EXPIRY-DAY       (9)
  2 ONLINE-ACTION    (9)
  2 ISSUE-AGE        (9)
  2 FACE-AMOUNT     (9)
  2 CASH-VALUE      (9)
  2 BEG-CASH-VALUE  (9)
  2 LAST-ANN-CASH-VALUE (9)
*
1 ST-NAME-V VIEW OF A-STATUS
  2 ID-NUMBER
  2 NAME
  2 INTRO-FLAG
  2 SSN
  2 SUSPEND-CODE
  2 DATE-OF-DEATH
  2 RANK
  2 STATUS      (9)
  2 FACE-AMOUNT (9)
*
1 FR-V VIEW OF A-FIRS
  2 DEPN-NAME     (14)
  2 DEPN-DATE-OF-BIRTH (14)
  2 DEPN-SSN      (14)
  2 DEPN-STATUS-CD (14)
*
1 AT-V VIEW OF A-APPL-TRACKING
  2 ID-NUMBER
  2 SSN
  2 SEX     /* DW7
  2 NAME
  2 MEMBER-CN
  2 REFERING-ID-NUMBER   (2)
  2 REDEFINE REFERING-ID-NUMBER
    3 REF-ID-A  (A6/2)
  2 DATE-OF-BIRTH
  2 INTRO-FLAG
  2 MIL-STATUS
  2 RANK
  2 HOME-PHONE
  2 HOME-PHONE-INTR
  2 WORK-PHONE
  2 WORK-PHONE-INTR
  2 SMOKER-FLAG
  2 INS-ONLY
  2 QUOT-FAC-AMT  (5)
  2 QUOT-PLAN     (13)                       /* DW17
  2 QUOT-LT2-CLASS  (A1)   /* DW12
*
1 IM-V VIEW OF A-INTRO-MEMBER
  2 ID-NUMBER
  2 SSN
  2 SEX   /* DW7
  2 NAME
  2 DATE-OF-BIRTH
  2 RANK
1 #TO-PLAN             (A2)
1 #DUES-DIFF           (N5.2)
1 #OUTPUT-CALC-AMT     (P7.2)     /* passed to c1601sco for results
1 #OUTPUT-OLD-PDUP-AMT (P7.2) /* passed to c1601sco for results
1 #PRORATE-LOAN        (L)
1 #RPU-ACV             (P5.2)
1 #NU-ANN-PREM         (N6.2)
1 #TOT-LOAN-AMOUNT     (P5.2)
1 #TOT-CURR-ACCUM-INT  (P5.2)
*
1 #DIVIDEND   (N5.4)
1 REDEFINE #DIVIDEND
  2 #DIV-5    (N5)
  2 #REM      (N4)
* below is linkage to GPREMSXX -- also uses #smoker-flag
1 #SCR-COMMAND (A2)
1 #SCR-ID      (N9)
1 #SCR-SUFFIX  (A3)
1 #PLAN        (A3)
1 REDEFINE #PLAN
  2 #PLAN-A1   (A1)
  2 #PLAN-N2   (N2)
1 #AGE         (N2)
1 #APRM        (N7.2)
1 #ISSUE-DATE  (N8)
1 #FACE-AMT    (N7.2)
* above is linkage to GPREMSXX
*
1 #AVAIL-AGE    (N2)
1 #MON-PREM      (P5.2)
1 #TOT-MONTHLY   (P5.2)
1 #RANK          (A3)
*
1 #WYYMMDD
  2 #XYY  (N2)
  2 #XMM  (N2)
  2 #XDD  (N2)
1 REDEFINE #WYYMMDD
  2 #WYYMMDD-N  (N6)
*
1 #FND-REC       (L)
1 #BATCH-ERROR   (L)
1 #IS-A-MBR      (L)
1 #MATCH         (L)
1 #SUBTRACT-DUES (L)
1 #MSG         (A75)
*
1 #ONE-TIM-PREM-SP  (N6)     /* cost for $10k
1 #MONTHLY-PREM-7P  (N5.2)
1 #MONTHLY-PREM-20  (N5.2)
1 #MONTHLY-PREM-30  (N5.2)
1 #MONTHLY-PREM-OL  (N5.2)
1 #MONTHLY-PREM-RT  (N5.2)   /* cost for $50k
1 #MONTHLY-PREM-RT-5 (N5.2)
1 #MONTHLY-PREM-RT-10 (N5.2)
1 #MONTHLY-PREM-RT-15 (N5.2)
1 #MONTHLY-PREM-DT  (N5.2)   /*    of term
1 #ONE-TIM-PREM-SP-A  (N6)   /* cost for additional $10k chunks
1 #MON-PREM-7P-A  (N5.2)
1 #MON-PREM-20-A  (N5.2)
1 #MON-PREM-30-A  (N5.2)
1 #MON-PREM-OL-A  (N5.2)
1 #PREM         (N6.2)
1 #REFUND-CALC    (N6.2)
1 #REFUND         (N6.2)
1 #TTL-PAID       (N6.2)
1 #RT           (A2) INIT <'RT'>
1 #REFUND-LBL   (A16) INIT <'          Refund'>
1 #TTL-DUES-LBL (A16) INIT <'        Ttl Paid'>
1 #RT-REFUND-RATE (N1.2) INIT <0.30>
1 #RT-REFUND-RATE-2008 (N1.2) INIT <0.10>           /* PM16
1 #LT-REFUND-RATE (N1.2) INIT <0.20>
1 #LT-REFUND-RATE-2002 (N1.2) INIT <0.10>
1 #MINUS        (A1) INIT <'-'>
1 #EQUALS       (A1) INIT <'='>
1 #PREM-DOLS    (N5)
1 #CURR-DB      (P7.2)
1 #REM-FACE     (N7)
1 REDEFINE #REM-FACE
  2 #REM-FACE-N4  (N4)
  2 #REM-FACE-N3  (N3)
1 #REM-FACE-DISP (A8)
1 #REM-FACE-TERM (N7)  /* PAM - new maximums
1 #MBR-TOT-FACE  (P7)
1 #TOT-FACE-DISP (A8)
1 #ACTUAL-FACE   (P7)
*
1 #WORK-TELE     (N10)
1 REDEFINE #WORK-TELE
  2 #WORK-TELE-1  (A3)
  2 #WORK-TELE-2  (A3)
  2 #WORK-TELE-3  (A4)
1 #MIL-STATUS    (A1)
1 #LAST      (A25)
1 #FIRST/MID (A25)
1 #SUFFIX    (A25)
1 #EXTRA1    (A25)
1 #EXTRA2    (A25)
1 #AGE-4     (P4)
*
1 #WYYYYMMDD     (A8)
1 REDEFINE #WYYYYMMDD
  2 #WCENT    (N2)
  2 #WYY      (N2)
  2 #WMM      (N2)
  2 #WDD      (N2)
1 REDEFINE #WYYYYMMDD
  2 #WYYYYMMDD-N (N8)
1 REDEFINE #WYYYYMMDD
  2 #WYYYY-N   (N4)
  2 #WMMDD-N   (N4)
1 REDEFINE #WYYYYMMDD
  2 #WCENT-A   (A2)
  2 #WYY-A     (A2)
  2 #WMM-A     (A2)
  2 #WDD-A     (A2)
1 REDEFINE #WYYYYMMDD
  2 #WYYYY-A   (A4)
  2 #WMMDD-A   (A4)
*
1 #MONTHS (A36)  INIT
  <'JanFebMarAprMayJunJulAugSepOctNovDec'>
1 REDEFINE #MONTHS
  2 #MON       (A3/12)
1 #MAX-AGE  (N2)
1 #NUM-FAC   (P3)
1 #NUM-PLANS (P3)
1 #NUM-SEL   (P3)
1 #WL-PLANS  (P3)
*
1 #HOLD-SCR-COMMAND (A2)
1 #PAY-STAT         (A4)
1 #EFF-DATE         (N8)
*
1 #AFFL-ONLY (L) INIT <FALSE>                                         /*  bz1
1 #ID-NUMBER    (N6)                                                  /* PM18
1 REDEFINE #ID-NUMBER                                                 /* PM18
  2 #ID-NUMBER-A (A6)                                                 /* PM18
1 #RATED-CLASS   (N1)                                                 /* NG3
1 #DATE-OF-BIRTH    (N8.0)
1 #DATE-OF-BIRTH-SP (N8.0)
1 #GENDER           (A1)
1 #SPOUSE-GENDER    (A1)
1 #at-found               (l)                            /* vt2
END-DEFINE
* * * * * * * * *
*
SET KEY PF3
* WRITE 'top of C2150SPO' #PDA-SCR-COMMAND #PDA-SCR-ID #PDA-SCR-SUFFIX
MOVE #PDA-SCR-COMMAND TO #HOLD-SCR-COMMAND
RESET #CGA-ISN #FND-REC
*
IF #PDA-SCR-ID LT 999999
  MOVE #PDA-SCR-ID TO #CGA-ID
END-IF
*
IF #PDA-SCR-ID NE 0
  IF #PDA-SCR-ID LT 500000   /* member
    FIND (1) ST-V WITH MEMBER-KEY = #CGA-ID-G
      IF NO RECORDS FOUND
        FIND (1) ST-V WITH WIDOW-KEY = #CGA-ID-G
          IF NO RECORDS FOUND
            MOVE 'Member not found' TO #ERR-TEXT
            PERFORM ERROR-MSG
            ESCAPE ROUTINE
          END-NOREC
          MOVE TRUE TO #FND-REC
          MOVE TRUE TO #IS-A-MBR
          MOVE *ISN TO #CGA-ISN
        END-FIND
      END-NOREC
      MOVE TRUE TO #FND-REC
      MOVE TRUE TO #IS-A-MBR
      MOVE *ISN TO #CGA-ISN
    END-FIND
  ELSE
    IF #PDA-SCR-ID LT 700000   /* AT record (5xxxxx)
      FIND (1) AT-V WITH ID-NUMBER = #CGA-ID
        IF NO RECORDS FOUND
          MOVE 'AT Record not found' TO #ERR-TEXT
          PERFORM ERROR-MSG
          ESCAPE ROUTINE
        END-NOREC
        COMPRESS 'AT' AT-V.ID-NUMBER INTO #FORMAT-CN
        PERFORM MOVE-AT
      END-FIND
    ELSE
      IF #PDA-SCR-ID LT 800000   /* IM record (7XXXXX)
        FIND (1) IM-V WITH ID-NUMBER = #CGA-ID
          IF NO RECORDS FOUND
            MOVE 'IM Record not found' TO #ERR-TEXT
            PERFORM ERROR-MSG
            ESCAPE ROUTINE
          END-NOREC
          COMPRESS 'IM' AT-V.ID-NUMBER INTO #FORMAT-CN
          PERFORM MOVE-IM
        END-FIND
      ELSE
        FIND ST-V WITH SSN = #PDA-SCR-ID
          PERFORM  CHECK-AFFL-ONLY                     /* bz1
*          IF ST-V.PROCESS-IND = 'S' OR = 'C'           RE1
          IF ST-V.PROCESS-IND = 'C'                  /* RE1
              OR #AFFL-ONLY
*            OR AFFL-ONLY-CLIENT(<ST-V.ID-NUMBER>)    /* RE1  bz1
            ESCAPE TOP
          END-IF
          MOVE TRUE TO #FND-REC
          MOVE *ISN TO #CGA-ISN   /* FOR MEMBER RECORD
          MOVE TRUE TO #IS-A-MBR
          ESCAPE BOTTOM
        END-FIND
*
        IF NOT #FND-REC
          FIND AT-V WITH SSN = #PDA-SCR-ID
            IF AT-V.INTRO-FLAG = 'V'
              ESCAPE TOP
            END-IF
            PERFORM MOVE-AT
            ESCAPE BOTTOM
          END-FIND
        END-IF
*
        IF NOT #FND-REC
          FIND (1) IM-V WITH SSN = #PDA-SCR-ID
            IF NO RECORDS FOUND
              MOVE 'RECORD NOT FOUND' TO #ERR-TEXT
              PERFORM ERROR-MSG
              ESCAPE ROUTINE
            END-NOREC
            PERFORM MOVE-IM
            ESCAPE BOTTOM
          END-FIND
        END-IF
      END-IF
    END-IF
  END-IF
END-IF
*
If not #at-found                                           /* vt2
  RESET PDA-CONTACT #DATE-OF-BIRTH-SP #SPOUSE-GENDER #SEX
  P-CONTACT-ID := ST-V.MEMBER-CONTACT-ID
  CALLNAT 'CONTS001' PDA-CONTACT #DATE-OF-BIRTH-SP #SPOUSE-GENDER
  #DATE-OF-BIRTH := P-DATE-OF-BIRTH
  #GENDER        := P-GENDER
end-if                                                     /* vt2
*
MOVE ST-V.INTRO-FLAG TO #INTRO-FLAG
MOVE ST-V.MILITARY-STATUS TO #MILITARY-STATUS
MOVE #GENDER TO #SEX               /* DW7
*
IF #IS-A-MBR AND (#PDA-SCR-SUFFIX = MASK ('D'))
    AND (#PDA-SCR-SUFFIX = MASK (.NN))
  MOVE 'K' TO #INTRO-FLAG
  FIND (1) FR-V WITH MEMBER-KEY = #CGA-ID-G
    MOVE #PDA-SCR-SUFFIX TO #SCR-SUFF
    MOVE #SCR-SUFF-LST-2 TO #I4
    MOVE FR-V.DEPN-NAME (#I4)          TO ST-V.NAME
    MOVE FR-V.DEPN-DATE-OF-BIRTH (#I4) TO #DATE-OF-BIRTH
    MOVE FR-V.DEPN-SSN (#I4)           TO ST-V.SSN
    #INSURED := FR-V.DEPN-NAME (#I4)                         /* PM15
    RESET #SEX    /* DW7
*
    IF FR-V.DEPN-STATUS-CD (#I4) = 'G'
      MOVE 'G' TO #INTRO-FLAG
    END-IF
  END-FIND
*
  RESET ST-V.SUSPEND-CODE ST-V.RESTRICT-MBR-SW
  RESET #IS-A-MBR
  RESET #PDA-SCR-SUFFIX
END-IF
*
RESET #SO-MBR
IF #IS-A-MBR AND PLAN (1) = 'SO' OR = 'FSO'
  MOVE TRUE TO #SO-MBR
END-IF
*
RESET #TERMED-MBR
IF #IS-A-MBR AND (NUMBER-MEMBERSHIPS = 0)
  MOVE TRUE TO #TERMED-MBR
END-IF
*
IF #PDA-SCR-SUFFIX = 'APN' OR = 'ASN' /* force non-smoker
  MOVE 'N' TO #SMOKER-FLAG
END-IF
*
IF #PDA-SCR-SUFFIX = 'APT' OR = 'AST' /* force smoker (tobacco)
  MOVE 'S' TO #SMOKER-FLAG
END-IF
*
IF #PDA-SCR-SUFFIX = 'SPS'
  MOVE 'S' TO #INTRO-FLAG
  MOVE 'F' TO #SEX   /* DW7
END-IF
*
IF (#PDA-SCR-SUFFIX = 'GEN') AND (#INTRO-FLAG = ' ')
  MOVE 'K' TO #INTRO-FLAG /* assume child
END-IF
*
IF #PDA-SCR-SUFFIX = 'AS ' OR = 'ASN' OR = 'AST' OR = 'ASG'
  MOVE 'S' TO #INTRO-FLAG
  MOVE 'F' TO #SEX   /* DW7
END-IF
*
MOVE *DATN TO #TODAY-YYYYMMDD-N
MOVE *DATN TO #SCN-AOD-YYYYMMDD
*
MOVE *DATN TO #WYYYYMMDD-N
COMPRESS #WMM-A #WDD-A #WCENT-A #WYY-A INTO #SCN-AS-OF-DT LEAVING NO
*
CALLNAT 'C2152SPO'   /* load initial value
  #PDA-AREA-C2150APO
*
IF #IS-A-MBR
  IF #CGA-ISN NE 0
*   GET CI-V #CGA-ISN
    COMPRESS 'CN' ST-V.ID-NUMBER INTO #FORMAT-CN
    IF NOT #PDA-SCR-SUFFIX = 'SPS' OR = 'AS' OR = 'ASN' OR = 'AST'
        OR = 'ASG' OR = 'GEN'
      PERFORM GET-CUR-INS
      MOVE ' Additional Whole Life Insurance Desired $_________________'
        TO #WL-INS-DESIRED
      MOVE ' Additional Term Insurance Desired $_________________'
        TO #TM-INS-DESIRED
    END-IF
  END-IF
END-IF
*
* WRITE #PDA-SCR-ID #PDA-SCR-SUFFIX #FORMATED-NAME (EM=XXXXXXXXXXXXXXX)
*    'insured=' #INSURED (EM=XXXXXXXXXXXXXXX)
*    'format-cn=' #FORMAT-CN
IF #PDA-SCR-SUFFIX = 'SPS' OR = 'AS' OR = 'ASN' OR = 'AST' OR = 'ASG'
  COMPRESS 'MBR:' #FORMATED-NAME TO #LINKED-MBR-NAME
  MOVE #FORMAT-CN  TO #LINKED-MBR-CN  /* do not use #last-name below
  SEPARATE ST-V.NAME-SP LEFT INTO #LAST #FIRST/MID #SUFFIX
    #EXTRA1 #EXTRA2 WITH DELIMITER ','
  COMPRESS #FIRST/MID #LAST INTO #INSURED
*
  RESET #FORMAT-CN
*
  IF #DATE-OF-BIRTH-SP = 0                              /* TT2
    IF #PDA-SCR-SUFFIX NE 'SPS'
      MOVE 'No DOB for Spouse' TO #ERR-TEXT
      PERFORM ERROR-MSG
      ESCAPE ROUTINE
    END-IF
  ELSE
    MOVE #SPOUSE-GENDER    TO #SEX                       /* TT2
    MOVE #DATE-OF-BIRTH-SP TO #DATE-OF-BIRTH             /* TT2
  END-IF
*
  MOVE SSN-SP TO ST-V.SSN
  RESET ST-V.MILITARY-STATUS
  RESET ST-V.RANK
*   intro-flag must stay st-v.intro-flag (must be actual)
  IF ST-V.INTRO-FLAG = 'S' OR = 'K' OR = 'G'
    IF #PDA-SCR-ID GE 500000
      MOVE REFERING-ID-NUMBER (1) TO #CN
    ELSE
      MOVE LINKED-CN (1) TO #CN
    END-IF
*
    IF #CN NE 0
      FIND (1) ST-NAME-V WITH MEMBER-KEY = #CN-A
        SEPARATE ST-NAME-V.NAME LEFT INTO #LAST-NAME #FIRST/MID
          #SUFFIX #EXTRA1 #EXTRA2 WITH DELIMITER ','
        COMPRESS 'MBR:' ST-NAME-V.RANK #FIRST/MID #LAST-NAME
          INTO #LINKED-MBR-NAME
        COMPRESS 'CN' #CN INTO #LINKED-MBR-CN
      END-FIND
    END-IF
  END-IF
END-IF
*
IF #SMOKER-FLAG = ' '
  MOVE 'N' TO #SMOKER-FLAG /* assume non-smok unless "S" exists w/o "N"
  IF NOT #FROM-AT                               /* PM20
      AND NOT #PDA-SCR-SUFFIX = 'SPS' OR = 'GEN'   /* PM20
      AND #IS-A-MBR                                /* PM20
    FOR #I1 1 TO 9
      IF ST-V.SMOKER-FLAG (#I1) = 'S'
        MOVE 'S' TO #SMOKER-FLAG
      END-IF
*
      IF ST-V.SMOKER-FLAG (#I1) = 'N'
        MOVE 'N' TO #SMOKER-FLAG
        ESCAPE BOTTOM  /* all pols must be S to make S as per rss 12/2000
      END-IF
    END-FOR
  END-IF                                        /* PM20
END-IF
*
IF #DATE-OF-BIRTH NE 0                          /* TT2
  MOVE #DATE-OF-BIRTH TO #WYYYYMMDD-N                                  /* TT2
  COMPRESS #WMM-A #WDD-A #WCENT-A #WYY-A INTO #SCN-DOB LEAVING NO
END-IF
*
IF #INTRO-FLAG = 'S' OR = 'K' OR = 'G'
  MOVE #INTRO-FLAG TO #SCN-SPS-GEN
END-IF
*
IF #PDA-SCR-ID NE 0
  MOVE (AD=P) TO #SCN-SPS-GEN-CV
END-IF
MOVE (AD=P) TO #SCN-SPS-GEN-CV  /* ADDED 6/29/2000
*
CALLNAT 'GMAXSXX'     /* obtain maximum amounts per insurance line
  #PDA-SCR-COMMAND
  #MAX-FACE
  #MAX-FACE-TERM
  #OVERRIDE-MAX-FACE-TOTAL
  #OVERRIDE-MAX-FACE-TERM
  #INTRO-FLAG
  #DATE-OF-BIRTH   /* dw4                               /* TT2
*
REPEAT         /* <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
*
*
  IF  (*DEVICE NE 'BATCH')
      OR (#PDA-SCR-COMMAND = 'MR') /* FROM AOAP005A/MR APPS OR 005E/MR VP
*    #RATED-FACE-AMT (*) := #DESIRED-FACE-AMT (*)
    CALLNAT 'C2151SPO'   /* input override screen
      #PDA-AREA-C2150APO
      #SCN-AOD-YYYYMMDD
      #SCN-AS-OF-DT
      #DATE-OF-BIRTH                                       /* TT2
      #SCN-DOB
      #SCN-SPS-GEN
      #SCN-SPS-GEN-CV
      ST-V.SSN
      #DESIRED-FACE-AMT  (1:3)
      #DESIRED-PLAN     (1:10)
      #FIRST-TIME
      #FROM-AT
      #FROM-IM
      AT-V.MEMBER-CN
      #SO-MBR
      #TERMED-MBR
      ST-V.RESTRICT-MBR-SW
      ST-V.SUSPEND-CODE
      #VT-TYPE
      #VT-TERM
      #VT-RIDER
      #RATED-CLASS              /* NG3
*
    IF   (#ERR-TEXT = 'G1000PXX')
        AND (*DEVICE NE 'BATCH')
      ESCAPE ROUTINE
    END-IF
  END-IF
*
  CALLNAT 'GMAXSXX'     /* obtain maximum amounts per insurance line
    #PDA-SCR-COMMAND
    #MAX-FACE
    #MAX-FACE-TERM
    #OVERRIDE-MAX-FACE-TOTAL
    #OVERRIDE-MAX-FACE-TERM
    #INTRO-FLAG
    #DATE-OF-BIRTH   /* dw4                       /* TT2
*
  RESET #NUM-PLANS #NUM-FAC
  FOR #I1 1 TO 10
    IF #DESIRED-PLAN (#I1) NE ' ' /* selected plans
      ADD 1 TO #NUM-PLANS
    END-IF
  END-FOR
*
  FOR #I1 1 TO 3
    IF #DESIRED-FACE-AMT (#I1) NE 0
      ADD 1 TO #NUM-FAC
      FOR #I2 1 TO 10
        IF   (#DESIRED-PLAN (#I2) NE ' ') /* selected plans
          IF (#I2 =  6 OR = 7)   /* term
              AND (#DESIRED-FACE-AMT (#I1) LT 50000) /* below minium
            IGNORE
          ELSE
            ADD 1 TO #NUM-SEL
          END-IF
        END-IF
      END-FOR
    END-IF
  END-FOR
*
  IF #FROM-AT                                                       /* PM19
    #ID-NUMBER-A := AT-V.MEMBER-CN                                  /* PM19
  ELSE                                                              /* PM19
    #ID-NUMBER   := ST-V.ID-NUMBER                                  /* PM19
  END-IF                                                            /* PM19
*
  IF #INTRO-FLAG = 'K' OR = 'G'
      AND FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = FALSE                /* PM19
    MOVE 24 TO #MAX-AGE
  ELSE
    IF  (#INTRO-FLAG = 'S')
        OR ((#PDA-SCR-ID NE 0) AND (#PDA-SCR-ID LT 500000))  /* CUR MBR
        OR ((#FROM-AT) AND (AT-V.MEMBER-CN NE ' ')) /* AT on existing mbr
      MOVE 80 TO #MAX-AGE
    ELSE
      MOVE 66 TO #MAX-AGE
    END-IF
  END-IF
*
  MOVE #SCN-AOD-YYYYMMDD TO #WYYYYMMDD-N
  SUBTRACT #DATE-OF-BIRTH FROM #WYYYYMMDD-N                               /* TT2
  MOVE #WYYYY-N TO #CURR-AGE
*
  MOVE EDITED #MAX-FACE (EM=ZZZ,ZZ9) TO #REM-FACE-DISP
  COMPRESS '$' #REM-FACE-DISP INTO #REM-FACE-DISP LEAVING NO
* if #SO-MBR OR #TERMED-MBR /* SO removed 11/26/3004 RLB
  IF  #TERMED-MBR
      OR (#PDA-SCR-ID = 0) OR (#PDA-SCR-ID GE 500000)
      OR (#PDA-SCR-SUFFIX = 'SPS' OR = 'AS' OR = 'AST' OR = 'ASN' OR = 'ASG'
      OR = 'OVR')   /* ALLOW MAX
    MOVE #MAX-FACE TO #REM-FACE
    MOVE #MAX-FACE-TERM TO #REM-FACE-TERM   /* PAM - new maximums
  ELSE
    COMPUTE #REM-FACE = #MAX-FACE - #TOT-FACE
    COMPUTE #REM-FACE-TERM = #MAX-FACE-TERM - #TOT-FACE-TERM   /* PAM
*                                                            /* new max
    COMPUTE #DIVIDEND = #REM-FACE / 5000
    IF #REM NE 0
      COMPUTE #REM-FACE = 5000 * (#DIV-5 + 1)
    END-IF
*
    MOVE 'additional' TO #ADDL
*
    MOVE EDITED #TOT-FACE (EM=ZZZ,ZZ9) TO #TOT-FACE-DISP
    COMPRESS '$' #TOT-FACE-DISP INTO #TOT-FACE-DISP LEAVING NO
    MOVE EDITED #ACTUAL-FACE (EM=ZZZ,ZZ9) TO #ACTUAL-FACE-DISP
    COMPRESS '$' #ACTUAL-FACE-DISP INTO #ACTUAL-FACE-DISP LEAVING NO
    MOVE EDITED #REM-FACE (EM=ZZZ,ZZ9) TO #REM-FACE-DISP
    COMPRESS '$' #REM-FACE-DISP INTO #REM-FACE-DISP LEAVING NO
    MOVE EDITED #CURR-DB (EM=Z,ZZZ,ZZZ.99) TO #CURR-DB-DISP
    COMPRESS '$' #CURR-DB-DISP INTO #CURR-DB-DISP LEAVING NO
    COMPRESS 'Insured for' #ACTUAL-FACE-DISP 'Current Death Benefit'
      #CURR-DB-DISP  INTO #TOP-LINE
  END-IF
*
*   IF ST-V.TELE-NUMBER = 0
*     MOVE '___-___-____' TO #SCR-HOME-TELE
*   ELSE
*     MOVE ST-V.TELE-NUMBER TO #WORK-TELE
*     COMPRESS #WORK-TELE-1 #WORK-TELE-2 #WORK-TELE-3 INTO #SCR-HOME-TELE
*       WITH '-'
*   END-IF
* *
*   IF ST-V.HOME-TELE-INTR NE ' '
*     COMPRESS #SCR-HOME-TELE '-' ST-V.HOME-TELE-INTR
*       INTO #SCR-HOME-TELE LEAVING NO
*   END-IF
* *
*   IF ST-V.NXT-OF-KIN-TELE-NUMBER = 0
*     MOVE '___-___-____' TO #SCR-WORK-TELE
*   ELSE
*     MOVE ST-V.NXT-OF-KIN-TELE-NUMBER TO #WORK-TELE
*     COMPRESS #WORK-TELE-1 #WORK-TELE-2 #WORK-TELE-3 INTO #SCR-WORK-TELE
*       WITH '-'
* *
*     IF ST-V.WORK-TELE-INTR NE ' '
*       COMPRESS #SCR-WORK-TELE '-' ST-V.WORK-TELE-INTR
*         INTO #SCR-WORK-TELE LEAVING NO
*     END-IF
*   END-IF
*
  IF ST-V.SSN = 0
    MOVE '___-__-____' TO #SCR-SSN
  ELSE
    IF ST-V.CHIEF-OF-STAFF-IND = 'Q' OR = 'S'
      MOVE #SSN-HIDE TO #SCR-SSN
    ELSE
      MOVE #SSN-HIDE TO #SCR-SSN   /* added 9/5/2001 bmg
*    MOVE EDITED ST-V.SSN (EM=999-99-9999) TO #SCR-SSN
    END-IF
  END-IF
*
  RESET #INELIGIBLE
*
  IF #PDA-SCR-SUFFIX = 'SPS' OR = 'AS' OR = 'ASN' OR = 'AST' OR = 'ASG'
      OR = 'GEN'
    IF #AGE GT #MAX-AGE
*    IF ((#SCN-AOD-YYYYMMDD - (#MAX-AGE * 10000))
*        GE ST-V.DATE-OF-BIRTH)
        OR ((#PDA-SCR-SUFFIX = 'SPS')
        AND (ST-V.SUSPEND-CODE = '7' OR = '8' OR = '9')) /* INS REJ/DEF INS
      MOVE TRUE TO #INELIGIBLE
    END-IF
  ELSE
    IF (#TOT-FACE GE #MAX-FACE)      /* ALREADY HAS MAX COVERAGE
        OR (ST-V.SUSPEND-CODE = '5' OR = '6' OR = '9')  /* INS REJ/DEF INS
        OR (ST-V.RESTRICT-MBR-SW = 'Y')        /* RESTRICTED (SPC CATEGORY)
        OR #AGE GT #MAX-AGE
*        OR ((#SCN-AOD-YYYYMMDD - (#MAX-AGE * 10000))
*        GE ST-V.DATE-OF-BIRTH)
*  OR (#HAS-ETI)                    /* HAS AN ETI POLICY
      MOVE TRUE TO #INELIGIBLE
    END-IF
  END-IF
*
  IF #PDA-SCR-SUFFIX = 'OVR'  /* allow max insurance
      OR = 'VLT'    /* DW9
    RESET #INELIGIBLE
    RESET #TOT-FACE
    RESET #TOT-FACE-TERM
  END-IF
*
  IF (*DEVICE = 'BATCH')  /* no APPL if doing batch APPL
      AND (#INELIGIBLE)
    ESCAPE BOTTOM
  END-IF
*
  MOVE 'Monthly Premiums(s) Shown' TO #ELIGIBLE-MSG               /* DW14
  IF #INELIGIBLE
    COMPRESS #ELIGIBLE-MSG '- You have max available cov or are ineligible' /* DW14
      INTO #ELIGIBLE-MSG
  ELSE
    IF #SMOKER-FLAG = 'S'
      COMPRESS #ELIGIBLE-MSG '- Nicotine:Yes' INTO #ELIGIBLE-MSG    /* DW14
    ELSE
      COMPRESS #ELIGIBLE-MSG '- Nicotine:No (Nicotine rates are higher)' INTO #ELIGIBLE-MSG
    END-IF
  END-IF
*
  MOVE #DATE-OF-BIRTH TO #WYYYYMMDD-N
  COMPRESS #WDD #MON (#WMM) #WYYYY-N INTO #SCR-DOB-X WITH '-'
  MOVE #SCN-AOD-YYYYMMDD TO #WYYYYMMDD-N
  COMPRESS #WDD #MON (#WMM) #WYYYY-N INTO #SCR-AOD-X WITH '-'
*
  MOVE #SCN-AOD-YYYYMMDD TO #WORK-DATE-YYYYMMDD-N
  SUBTRACT #DATE-OF-BIRTH FROM #WORK-DATE-YYYYMMDD-N
*
  MOVE #WORK-YY TO #AGE-4
*
* IF  ((#PDA-SCR-ID = 0) OR NOT #IS-A-MBR)   /* removed 8/19/2008  DW17
*  AND (NOT #INTRO-FLAG = 'S' OR = 'K' OR = 'G')
*   IGNORE
* ELSE
*   IF #INTRO-FLAG = 'K' OR = 'G'
*     MOVE 'SEX (M/F) ____' TO #TOP-LINE
*   END-IF
* END-IF
*
  MOVE #SCN-AOD-YYYYMMDD TO #WYYYYMMDD-N
  IF (#AGE-4 LT 0) OR (#AGE-4 GT #MAX-AGE)
      OR #INELIGIBLE
    MOVE 9999999 TO #TOT-FACE
    MOVE '$0.00' TO #REM-FACE-DISP
    RESET #SCR-OPT-GPL-DUES (*)              /* DW17
    RESET #SCR-OPT-OL-DUES (*)
    RESET #SCR-OPT-7P-DUES (*)
    RESET #SCR-OPT-20-DUES (*)
    RESET #SCR-OPT-30-DUES (*)
    RESET #SCR-OPT-SP-DUES (*)
    RESET #SCR-OPT-RT-DUES (*)
    RESET #SCR-OPT-RT-REFUND (*)
    RESET #SCR-OPT-RT-TTL-DUES (*)
    RESET #SCR-OPT-RT-MINUS (*)
    RESET #SCR-OPT-RT-EQUAL (*)
    RESET #SCR-OPT-DT-DUES (*)
    RESET #SCR-OPT-DT-REFUND (*)
    RESET #SCR-OPT-DT-TTL-DUES (*)
    RESET #SCR-OPT-DT-MINUS (*)
    RESET #SCR-OPT-DT-EQUAL (*)
    RESET #RT-__ #LVL-TRM-LBL #LT-__ #LT-DESC-1
    RESET #LVL-TRM-REFUND-LBL #LVL-TRM-TTL-DUES-LBL
    RESET #LT-DESC-2 #LT-DESC-3 #LT-DESC-4 #LT-DESC-5 #LT-DESC-6
  ELSE
    MOVE #SCN-AOD-YYYYMMDD TO #ISSUE-DATE   /* was *datn
*
    MOVE #AGE-4 TO #AGE
    IF #SMOKER-FLAG = 'N'
*  AND (NOT #INTRO-FLAG = 'K' OR ='G')     /* DW3
        AND (#DESIRED-PLAN (8) = ' ')   /* var term not selected
      COMPRESS '* Owners of Term coverage on non-smokers may be eligible'
        'for premium refunds.' INTO #REFUND-1-ONLINE
      IF #AGE GE 46
        COMPRESS '* Owners of 5-Year Renewable Term coverage on'
          INTO #REFUND-2-BATCH
      ELSE
        COMPRESS '* Owners of 5-Year Renewable Term or Level Term to age'
          '50 coverage on' INTO #REFUND-2-BATCH
      END-IF
*
      COMPRESS 'non-smokers may be eligible for premium refunds based'
        'on the Association"s'    INTO #REFUND-3-BATCH
      MOVE     'claim experience.' TO #REFUND-4-BATCH
    END-IF
*
    MOVE ' Monthly Payment' TO #MONTHLY-DUES
    IF #SMOKER-FLAG = 'S'
*  COMPRESS #MONTHLY-DUES 'for Smoker - Non-Smoker rates are lower'
      COMPRESS #MONTHLY-DUES 'for Nicotine - Non-Nicotine rates are lower.'  /* DW14
        INTO #MONTHLY-DUES
      MOVE #MONTHLY-DUES TO #REFUND-1-ONLINE
    ELSE
      COMPRESS #MONTHLY-DUES 'for Non-Nicotine - Nicotine rates are higher.'  /* DW14
        INTO #MONTHLY-DUES
    END-IF
*
    MOVE 10000 TO #FACE-AMT
    MOVE 'OL' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-OL = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-OL-DUES (1)
    COMPRESS '$' #SCR-OPT-OL-DUES (1) INTO #SCR-OPT-OL-DUES (1) LEAVING NO
*
    MOVE '30P' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-30 = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-30-DUES (1)
    COMPRESS '$' #SCR-OPT-30-DUES (1) INTO #SCR-OPT-30-DUES (1) LEAVING NO
*
    MOVE '20P' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-20 = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-20-DUES (1)
    COMPRESS '$' #SCR-OPT-20-DUES (1) INTO #SCR-OPT-20-DUES (1) LEAVING NO
*
    MOVE '7P' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-7P = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-7P-DUES (1)
    COMPRESS '$' #SCR-OPT-7P-DUES (1) INTO #SCR-OPT-7P-DUES (1) LEAVING NO
*
    MOVE 'SI' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    MOVE ROUNDED #APRM TO #ONE-TIM-PREM-SP
    MOVE #ONE-TIM-PREM-SP TO #PREM
    MOVE EDITED #PREM (EM=Z,Z99) TO #SCR-OPT-SP-DUES (1)
    COMPRESS '$' #SCR-OPT-SP-DUES (1) INTO #SCR-OPT-SP-DUES (1) LEAVING NO
*
* IF  (NOT #INTRO-FLAG = 'K' OR = 'G')                                           /* DW3
    IF (#AGE LE 70)
        AND ((NOT #INTRO-FLAG = 'K' OR = 'G')                                       /* DW3
*     OR ((#CURR-AGE GE 18) AND (#CURR-AGE LE 23)))                              /* PM19
        OR ((#CURR-AGE GE 18)                                                      /* PM19
        AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
      MOVE 50000 TO #FACE-AMT
      MOVE 'RT' TO #PLAN
      PERFORM CALLNAT-GPREMSXX
      COMPUTE #MONTHLY-PREM-RT = (#APRM / 12)
      MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES (1)
      COMPRESS '$' #SCR-OPT-RT-DUES(1) INTO #SCR-OPT-RT-DUES(1)
        LEAVING NO
      COMPRESS '  Age' #AGE 'for 5 yrs' INTO #RT-AGE-LBL (1)
      MOVE #REFUND-LBL TO #RT-REFUND-LBL (1)
      MOVE #TTL-DUES-LBL TO #RT-TTL-DUES-LBL (1)
*
      IF #SMOKER-FLAG = 'N'
        COMPRESS #RT-AGE-LBL (1) '*' INTO #RT-AGE-LBL (1) LEAVING NO
      END-IF
    END-IF
*
    ADD 5 TO #AGE
    RESET #MONTHLY-PREM-RT-5
    IF  (#AGE LE 70)
        AND ((NOT #INTRO-FLAG = 'K' OR = 'G')                                       /* DW3
*     OR ((#CURR-AGE GE 18) AND (#CURR-AGE LE 23)))                              /* PM19
        OR ((#CURR-AGE GE 18)                                                      /* PM19
        AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
      PERFORM CALLNAT-GPREMSXX
      COMPUTE #MONTHLY-PREM-RT-5 = (#APRM / 12)
      MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES-5 (1)
      COMPRESS '$' #SCR-OPT-RT-DUES-5 (1) INTO #SCR-OPT-RT-DUES-5 (1)
        LEAVING NO
      COMPRESS '  Age' #AGE 'for 5 yrs' INTO #RT-AGE-LBL (2)
      MOVE #REFUND-LBL TO #RT-REFUND-LBL (2)
      MOVE #TTL-DUES-LBL TO #RT-TTL-DUES-LBL (2)
*
      IF #SMOKER-FLAG = 'N'
        COMPRESS #RT-AGE-LBL (2) '*' INTO #RT-AGE-LBL (2) LEAVING NO
      END-IF
    END-IF
*
    ADD 5 TO #AGE
    RESET #MONTHLY-PREM-RT-10
    IF  (#AGE LE 70)
        AND ((NOT #INTRO-FLAG = 'K' OR = 'G')                                       /* DW3
*     OR ((#CURR-AGE GE 18) AND (#CURR-AGE LE 23)))                              /* PM19
        OR ((#CURR-AGE GE 18)                                                      /* PM19
        AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
      PERFORM CALLNAT-GPREMSXX
      COMPUTE #MONTHLY-PREM-RT-10 = (#APRM / 12)
      MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES-10 (1)
      COMPRESS '$' #SCR-OPT-RT-DUES-10(1) INTO #SCR-OPT-RT-DUES-10 (1)
        LEAVING NO
      COMPRESS '  Age' #AGE 'for 5 yrs' INTO #RT-AGE-LBL (3)
      MOVE #REFUND-LBL TO #RT-REFUND-LBL (3)
      MOVE #TTL-DUES-LBL TO #RT-TTL-DUES-LBL (3)
*
      IF #SMOKER-FLAG = 'N'
        COMPRESS #RT-AGE-LBL (3) '*' INTO #RT-AGE-LBL (3) LEAVING NO
      END-IF
    END-IF
*
    ADD 5 TO #AGE
    RESET #MONTHLY-PREM-RT-15
    IF  (#AGE LE 70)
        AND ((NOT #INTRO-FLAG = 'K' OR = 'G')                                       /* DW3
*     OR ((#CURR-AGE GE 18) AND (#CURR-AGE LE 23)))                              /* PM19
        OR ((#CURR-AGE GE 18)                                                      /* PM19
        AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
      PERFORM CALLNAT-GPREMSXX
      COMPUTE #MONTHLY-PREM-RT-15 = (#APRM / 12)
      MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES-15 (1)
      COMPRESS '$' #SCR-OPT-RT-DUES-15(1) INTO #SCR-OPT-RT-DUES-15 (1)
        LEAVING NO
      COMPRESS '  Age' #AGE 'for 5 yrs' INTO #RT-AGE-LBL (4)
      MOVE #REFUND-LBL TO #RT-REFUND-LBL (4)
      MOVE #TTL-DUES-LBL TO #RT-TTL-DUES-LBL (4)
*
      IF #SMOKER-FLAG = 'N'
        COMPRESS #RT-AGE-LBL (4) '*' INTO #RT-AGE-LBL (4) LEAVING NO
      END-IF
    END-IF
    SUBTRACT 15 FROM #AGE  /* Reset to orig Iss age
*     below is also in athpbltr
*   IF   ((#SMOKER-FLAG = 'S') AND (#AGE GE 36)) /* chgd from 38 6/2001
*    OR  ((#SMOKER-FLAG = 'N') AND (#AGE GE 46))
    IF  (((#SMOKER-FLAG = 'S') AND (#AGE GE 40)) /* chgd from 36 6/2003
        OR  ((#SMOKER-FLAG = 'N') AND (#AGE GE 50))) /*       EL
        AND ((NOT #INTRO-FLAG = 'K' OR = 'G')                /* DW3
*     OR ((#CURR-AGE GE 20) AND (#CURR-AGE LE 23)))   /* LTII 18/19 no           /* PM19
        OR ((#CURR-AGE GE 20)                                                      /* PM19
        AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
      RESET #LVL-TRM-LBL #LT-__ #LT-DESC-1 #DT-DROP-LBL (*)
      RESET #LVL-TRM-REFUND-LBL #LVL-TRM-TTL-DUES-LBL
      RESET #LT-DESC-2 #LT-DESC-3 #LT-DESC-4 #LT-DESC-5 #LT-DESC-6
      RESET #SOLID-LINE-LT
*
      MOVE '__' TO #LTII-
      RESET #LTII-PREMS (*)
*      MOVE 'V10' TO #PLAN                       /* TEMP
      MOVE 'R10' TO #PLAN
      IF #CURR-AGE + #PLAN-N2 LE 85
        PERFORM CALLNAT-GPREMSXX
        COMPUTE #MONTHLY-PREM-DT = (#APRM / 12)
        MOVE EDITED #PREM (EM=ZZZ.99) TO #LTII-PREMS (1)
        COMPRESS '$' #LTII-PREMS (1) INTO #LTII-PREMS (1) LEAVING NO
      END-IF
*
*      MOVE 'V15' TO #PLAN                       /* TEMP
      MOVE 'R15' TO #PLAN
      IF #CURR-AGE + #PLAN-N2 LE 85
        PERFORM CALLNAT-GPREMSXX
        COMPUTE #MONTHLY-PREM-DT = (#APRM / 12)
        MOVE EDITED #PREM (EM=ZZZ.99) TO #LTII-PREMS (2)
        COMPRESS '$' #LTII-PREMS (2) INTO #LTII-PREMS (2) LEAVING NO
      END-IF
*
*      MOVE 'V20' TO #PLAN                       /* TEMP
      MOVE 'R20' TO #PLAN
      IF #CURR-AGE + #PLAN-N2 LE 85
        PERFORM CALLNAT-GPREMSXX
        COMPUTE #MONTHLY-PREM-DT = (#APRM / 12)
        MOVE EDITED #PREM (EM=ZZZ.99) TO #LTII-PREMS (3)
        COMPRESS '$' #LTII-PREMS (3) INTO #LTII-PREMS (3) LEAVING NO
      END-IF
    ELSE
      IF ((NOT #INTRO-FLAG = 'K' OR = 'G')                /* DW3
*     OR ((#CURR-AGE GE 20) AND (#CURR-AGE LE 23)))                       /* DW3 /* PM19
          OR ((#CURR-AGE GE 20)                                                      /* PM19
          AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
        MOVE 'LT' TO #PLAN
        IF #LVL-TRM-LBL = ' '
          MOVE 'LEVEL TERM TO AGE 50' TO #LVL-TRM-LBL
        END-IF
        PERFORM CALLNAT-GPREMSXX
        COMPUTE #MONTHLY-PREM-DT = (#APRM / 12)
        MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-DT-DUES (1)
        COMPRESS '$' #SCR-OPT-DT-DUES(1) INTO #SCR-OPT-DT-DUES(1)
          LEAVING NO
*
        IF #SMOKER-FLAG = 'S'
          MOVE 'LEVEL TERM TO AGE 40' TO #LVL-TRM-LBL
          MOVE 'Cov at age 40' TO #DT-DROP-LBL (1)
        ELSE
          COMPRESS #LVL-TRM-LBL '*' INTO #LVL-TRM-LBL
          MOVE #REFUND-LBL TO #LVL-TRM-REFUND-LBL
          MOVE #TTL-DUES-LBL TO #LVL-TRM-TTL-DUES-LBL
          MOVE 'Cov at age 50' TO #DT-DROP-LBL (1)
        END-IF
*
        IF #SMOKER-FLAG = 'S'
          MOVE 'Cov at age 45' TO #DT-DROP-LBL (2)
        ELSE
          MOVE 'Cov at age 55' TO #DT-DROP-LBL (2)
        END-IF
*
        IF #SMOKER-FLAG = 'S'
          MOVE 'Cov at age 50' TO #DT-DROP-LBL (3)
        ELSE
          MOVE 'Cov at age 60' TO #DT-DROP-LBL (3)
        END-IF
*
        COMPUTE #DT-COV = #FACE-AMT * .27
        MOVE EDITED #DT-COV (EM=ZZ,ZZ9) TO #SCR-DT-COV-1 (1)
        COMPRESS '$' #SCR-DT-COV-1 (1) INTO #SCR-DT-COV-1 (1) LEAVING NO
        COMPUTE #DT-COV = #FACE-AMT * .20
        MOVE EDITED #DT-COV (EM=ZZ,ZZ9) TO #SCR-DT-COV-2 (1)
        COMPRESS '$' #SCR-DT-COV-2 (1) INTO #SCR-DT-COV-2 (1) LEAVING NO
        MOVE '$     0' TO #SCR-DT-COV-3 (1)
      END-IF
    END-IF
* END-IF
*
    MOVE 'A10' TO #SCR-SUFFIX
    MOVE 'OL' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MON-PREM-OL-A = (#APRM / 12)
    MOVE '30P' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MON-PREM-30-A = (#APRM / 12)
    MOVE '20P' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MON-PREM-20-A = (#APRM / 12)
    MOVE '7P' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MON-PREM-7P-A = (#APRM / 12)
    MOVE 'SI' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    MOVE ROUNDED #APRM TO #ONE-TIM-PREM-SP-A
    RESET #SCR-SUFFIX
  END-IF
*
  RESET #I1 #I2
  RESET #SCR-ADDL-COV-1 (*) #SCR-ADDL-COV-2 (*)
*
  IF NOT #INELIGIBLE
    PERFORM FORMAT-NEW-PREMS
  END-IF
*
  MOVE #SCR-ADDL-COV-1 (*) TO #SCR-ADDL-COV-2 (*)
*
  FOR #I1 1 TO 5
    IF #SCR-ADDL-COV-2 (#I1) LT ' $ 50k'
      RESET #SCR-ADDL-COV-2 (#I1)
    END-IF
  END-FOR
*
  IF  (#INTRO-FLAG = 'K' OR = 'G')
* AND ((#CURR-AGE LT 18) OR(#CURR-AGE GT 23))                              /* DW3 PM19
      AND ((#CURR-AGE LT 18) OR (#CURR-AGE GT 23 AND FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = FALSE)) /* PM19
    RESET #TI-LBL #5-YR-REN-LBL #LVL-TRM-LBL #FIR-EAC-LBL #ADDL-10K
    RESET #5-YR-REN-LBL2
    RESET #LVL-TRM-REFUND-LBL #LVL-TRM-TTL-DUES-LBL
    RESET #DT-DROP-LBL(*) #SCR-ADDL-TM-FIRST #SCR-ADDL-COV-2(*)
  END-IF
*
  IF (((#SMOKER-FLAG = 'S') AND (#AGE LE 35)) /* NOT OLD ENOUGH FOR RT
      OR ((#SMOKER-FLAG = 'N') AND (#AGE LE 45)))
      AND (*DEVICE = 'BATCH')  /* online shows all options
    RESET #5-YR-REN-LBL #5-YR-REN-LBL2 #SCR-OPT-RT-DUES (*)
      #SCR-OPT-RT-DUES-5(*) #SCR-OPT-RT-DUES-10(*) #SCR-OPT-RT-DUES-15(*)
      #RT-AGE-LBL (*)
      #RT-REFUND-LBL (*) #RT-TTL-DUES-LBL (*)
      #SCR-OPT-RT-REFUND (*) #SCR-OPT-RT-TTL-DUES (*)
      #SCR-OPT-RT-REFUND-5 (*) #SCR-OPT-RT-TTL-DUES-5 (*)
      #SCR-OPT-RT-REFUND-10 (*) #SCR-OPT-RT-TTL-DUES-10 (*)
      #SCR-OPT-RT-REFUND-15 (*) #SCR-OPT-RT-TTL-DUES-15 (*)
      #SCR-OPT-RT-MINUS (*) #SCR-OPT-RT-EQUAL (*)
      #SCR-OPT-RT-MINUS-5 (*) #SCR-OPT-RT-EQUAL-5 (*)
      #SCR-OPT-RT-MINUS-10 (*) #SCR-OPT-RT-EQUAL-10 (*)
      #SCR-OPT-RT-MINUS-15 (*) #SCR-OPT-RT-EQUAL-15 (*)
      #SOLID-LINE-RT
*
    IF #SMOKER-FLAG = 'S' /* indicate smoker/non-smoker
      MOVE 'S' TO #RT-__
    ELSE
      MOVE 'N' TO #RT-__
    END-IF
  END-IF
*
  IF #NUM-FAC NE 0
    RESET #FIR-EAC-LBL-WL #FIR-EAC-LBL #ADDL-10K-WL #ADDL-10K
      #SCR-ADDL-VA-FIRST #SCR-ADDL-TM-FIRST
      #SCR-OPT-SP-DUES (1:2) #SCR-OPT-7P-DUES (1:2) #SCR-OPT-20-DUES (1:2)
      #SCR-OPT-30-DUES (1:2) #SCR-OPT-OL-DUES (1:2) #SCR-OPT-RT-DUES (1:2)
      #SCR-OPT-RT-DUES-5 (1:2) #SCR-OPT-RT-DUES-10 (1:2)
      #SCR-OPT-RT-DUES-15 (1:2) #SCR-DT-COV-1 (1:2)
      #SCR-DT-COV-2 (1:2) #SCR-DT-COV-3  (1:2)
      #SCR-OPT-DT-DUES-OCC (1:2)
      #SCR-OPT-GPL-DUES (1:2)                        /* DW17
  END-IF
*
  IF #NUM-PLANS NE 0
    IF #DESIRED-PLAN(1) NE ' ' MOVE 'X' TO #PLAN-TO-USE(8)  END-IF /*OL
    IF #DESIRED-PLAN(2) NE ' ' MOVE 'X' TO #PLAN-TO-USE(9)  END-IF /*30p
    IF #DESIRED-PLAN(3) NE ' ' MOVE 'X' TO #PLAN-TO-USE(10) END-IF /*20p
    IF #DESIRED-PLAN(4) NE ' ' MOVE 'X' TO #PLAN-TO-USE(11) END-IF /*7p
    IF #DESIRED-PLAN(5) NE ' ' MOVE 'X' TO #PLAN-TO-USE(12) END-IF /*SP
    IF #DESIRED-PLAN(6) NE ' ' MOVE 'X' TO #PLAN-TO-USE(7)  END-IF /*RT
    IF #DESIRED-PLAN(7) NE ' ' MOVE 'X' TO #PLAN-TO-USE(2)  END-IF /*LT
    IF #DESIRED-PLAN(9) NE ' ' MOVE 'X' TO #PLAN-TO-USE(13)        /* GPL  DW17
      MOVE TRUE TO #GPL-SELECTED  END-IF
*    IF #DESIRED-PLAN(10) NE ' ' MOVE 'X' TO #PLAN-TO-USE(14) END-IF /* EZ  RE2
*
    MOVE 5 TO #WL-PLANS
    IF #DESIRED-PLAN (1) = ' '   /* clear un-asked for plans
      RESET #SCR-OPT-OL-DUES (*) #PAY-100-LBL
      SUBTRACT 1 FROM #WL-PLANS
    END-IF
*
    IF #DESIRED-PLAN (2) = ' '
      RESET #SCR-OPT-30-DUES (*) #PAY-30-LBL
      SUBTRACT 1 FROM #WL-PLANS
    END-IF
*
    IF #DESIRED-PLAN (3) = ' '
      RESET #SCR-OPT-20-DUES (*) #PAY-20-LBL
      SUBTRACT 1 FROM #WL-PLANS
    END-IF
*
    IF #DESIRED-PLAN (4) = ' '
      RESET #SCR-OPT-7P-DUES (*) #PAY-7-LBL
      SUBTRACT 1 FROM #WL-PLANS
    END-IF
*
    IF #DESIRED-PLAN (5) = ' '
      RESET #SCR-OPT-SP-DUES (*) #PAY-1-LBL
      SUBTRACT 1 FROM #WL-PLANS
    END-IF
*
    IF #DESIRED-PLAN (6) = ' '
      RESET #5-YR-REN-LBL #5-YR-REN-LBL2
        #SCR-OPT-RT-DUES (*) #SCR-OPT-RT-DUES-5 (*)
        #SCR-OPT-RT-DUES-10 (*) #SCR-OPT-RT-DUES-15 (*) #RT-AGE-LBL (*)
        #RT-__ #RT-DESC-1 #RT-DESC-2 #RT-DESC-3 #RT-DESC-4
        #RT-REFUND-LBL (*) #RT-TTL-DUES-LBL (*)
        #SCR-OPT-RT-REFUND (*) #SCR-OPT-RT-TTL-DUES (*)
        #SCR-OPT-RT-REFUND-5 (*) #SCR-OPT-RT-TTL-DUES-5 (*)
        #SCR-OPT-RT-REFUND-10 (*) #SCR-OPT-RT-TTL-DUES-10 (*)
        #SCR-OPT-RT-REFUND-15 (*) #SCR-OPT-RT-TTL-DUES-15 (*)
        #SCR-OPT-RT-MINUS (*) #SCR-OPT-RT-EQUAL (*)
        #SCR-OPT-RT-MINUS-5 (*) #SCR-OPT-RT-EQUAL-5 (*)
        #SCR-OPT-RT-MINUS-10 (*) #SCR-OPT-RT-EQUAL-10 (*)
        #SCR-OPT-RT-MINUS-15 (*) #SCR-OPT-RT-EQUAL-15 (*)
        #SOLID-LINE-RT
    ELSE
      MOVE TRUE TO #SEL-TERM
    END-IF
*
    IF #DESIRED-PLAN (7) = ' '
      RESET #LVL-TRM-LBL  #LT-DESC-1
        #LVL-TRM-REFUND-LBL #LVL-TRM-TTL-DUES-LBL
        #SCR-OPT-DT-DUES (*) #DT-DROP-LBL (*)
        #SCR-OPT-DT-DUES-DUES-B #SCR-DT-COV-1 (*)
        #SCR-DT-COV-2 (*) #SCR-DT-COV-3(*) #LT-__
        #LT-DESC-1 #LT-DESC-2 #LT-DESC-3 #LT-DESC-4 #LT-DESC-5 #LT-DESC-6
        #SOLID-LINE-LT
        #SCR-OPT-DT-REFUND (*) #SCR-OPT-DT-TTL-DUES (*)   /* PM16
        #SCR-OPT-DT-MINUS  (*) #SCR-OPT-DT-EQUAL (*)      /* PM16
    ELSE
      MOVE TRUE TO #SEL-TERM
    END-IF
*
    IF #DESIRED-PLAN (8) = ' '
      IGNORE
    ELSE
      MOVE TRUE TO #SEL-VT
    END-IF
*
    IF #DESIRED-PLAN (9) = ' '    /* GPL                DW17
      RESET #SCR-OPT-GPL-DUES (*)
    END-IF

    IF #WL-PLANS = 0
      RESET #WL-DESC-1 #WL-DESC-2 #WL-DESC-3 #WL-DESC-4 #WL-DESC-5
      RESET #FIR-EAC-LBL-WL #SCR-ADDL-VA-FIRST #ADDL-10K-WL
        #SOLID-LINE-WL #WL-LBL #WL-ADDED-LBL
*         #SCR-ADDL-COV-1 (*)
    ELSE
      MOVE TRUE TO #SEL-WL
    END-IF
*
    IF NOT #SEL-TERM
      RESET #FIR-EAC-LBL #ADDL-10K #SCR-ADDL-TM-FIRST
      RESET #SCR-ADDL-COV-2 (*)
      MOVE 'below.' TO #OR-TERM-MSG
    END-IF
  END-IF
*
  MOVE '*' TO #PDA-SCR-COMMAND
*
* write 'c2150SPO line 2510' 'num-sel=' #num-sel 'vt-type=' #vt-type 'plan=' #plan
* write 'sel lines=' #desired-lines (*)
* write 'desired-plan=' #desired-plan (*)
* for #i1 1 to 9
*   write #i1 'des-plan=' #desired-plan (#i1)
* end-for
* IF   (#PDA-SCR-SUFFIX NE 'OLD')  /* DW1
  IF *DEVICE NE 'BATCH'
    IF  #DESIRED-PLAN (1) = 'X'  /* NG3 Start
        OR #DESIRED-PLAN (2) = 'X'
        OR #DESIRED-PLAN (3) = 'X'
        OR #DESIRED-PLAN (4) = 'X'
        OR #DESIRED-PLAN (5) = 'X'
      MOVE 'PO' TO #PDA-SCR-COMMAND
      CALLNAT 'C2153SPO' #PDA-AREA-C2150APO
        #RATED-CLASS
      ESCAPE ROUTINE
    END-IF                         /* NG3  End
    IF  (NOT #NUM-SEL = 1 OR = 2 OR = 3)   /* added 11/4/2002
        OR #DESIRED-PLAN (9) = 'X'  /* GPL selected           /* DW17
      MOVE 'PO' TO #PDA-SCR-COMMAND
      CALLNAT 'C2153SPO' #PDA-AREA-C2150APO
      ESCAPE ROUTINE
    END-IF
  END-IF
*
  IF *DEVICE = 'BATCH'
    IF #NUM-SEL GT 3
      RESET #DESIRED-LINES (*)
    END-IF
*
    ESCAPE BOTTOM
  END-IF
*
* write 'c2150SPO line 2556' 'num-sel=' #num-sel 'vt-type=' #vt-type
  IF #NUM-SEL = 1 OR = 2 OR = 3
    IF  NOT #SEL-TERM   /* to show refunds
        AND (#VT-TYPE NE '**')
      MOVE 'PO' TO #PDA-SCR-COMMAND
    END-IF
*
    IF #VT-RIDER = 'R' /* RE-NEW OPTION NG1
      #RATED-FACE-AMT (*) := #DESIRED-FACE-AMT (*)
      CALLNAT 'C2152NPO'
        #RATED-FACE-AMT (*)
        #VT-TERM
        #CURR-AGE
        #ELIGIBLE-MSG
        #MBR-SPS-GEN
        #DESIRED-LINES    (*)
        #INSURED
        #USER
        #PDA-SCR-COMMAND
        #PDA-SCR-ID
        #PDA-SCR-SUFFIX
        #REFUND-1-ONLINE
        #SCR-AOD-X
        #SCR-DOB-X
        #SCR-SSN
        #SEX
        #TOP-LINE
    ELSE
      IF #VT-TYPE = '**' /* special var term show all 3
        INPUT TEXT #TEXT USING MAP 'C2153MPO'   /* new simple screen
        IF  #PDA-SCR-COMMAND NE '*'
          MOVE 'G1000PXX' TO #ERR-TEXT
          ESCAPE BOTTOM
        END-IF
        RESET #NUM-SEL   /* added
        ESCAPE TOP    /*  1/22/2001  <<<<<<<<<<<
      ELSE
        IF #DESIRED-PLAN(10) NE ' '
          INPUT TEXT #TEXT USING MAP 'C2162MPO'   /* new EZ screen  NG2
        ELSE
          INPUT TEXT #TEXT USING MAP 'C2152MPO'   /* new simple screen
        END-IF
      END-IF
    END-IF
    IF  #PDA-SCR-COMMAND NE '*'
      MOVE 'G1000PXX' TO #ERR-TEXT
      ESCAPE BOTTOM
    END-IF
    IF #PDA-SCR-SUFFIX = 'VP'   /* RETURN TO MR VP
      ESCAPE BOTTOM
    END-IF
  END-IF
*
  IF #SMOKER-FLAG = 'N'
      AND (#SCR-OPT-RT-DUES (*) NE ' ' OR #SCR-OPT-DT-DUES (*) NE ' ')
    MOVE 'Press enter to see premium refunds' TO #TEXT  /* pm added 04/00
  ELSE
    MOVE 'Press enter to refresh PO options' TO #TEXT
  END-IF
*
  INPUT TEXT #TEXT USING MAP 'C2150MPO'   /* all poss options
*
  IF #PDA-SCR-COMMAND NE '*'
    MOVE 'G1000PXX' TO #ERR-TEXT
    ESCAPE BOTTOM
  END-IF
*
  IF #SMOKER-FLAG = 'N'    /* pm added 04/2000 to display refunds
      AND (#SCR-OPT-RT-DUES (*) NE ' ' OR #SCR-OPT-DT-DUES (*) NE ' ')
* MOVE 'Press enter to refresh PO options' TO #TEXT
    MOVE 'PO' TO #PDA-SCR-COMMAND
    INPUT TEXT #TEXT USING MAP 'C2156MPO'
*
    IF #PDA-SCR-COMMAND NE '*'
      MOVE 'G1000PXX' TO #ERR-TEXT
      ESCAPE BOTTOM
    END-IF
  END-IF
*
  RESET #SCR-OPT-SP-DUES (*)
  RESET #SCR-OPT-7P-DUES (*)
  RESET #SCR-OPT-20-DUES (*)
  RESET #SCR-OPT-30-DUES (*)
  RESET #SCR-OPT-OL-DUES (*)
  RESET #SCR-OPT-GPL-DUES (*)            /* DW17
  RESET #RT-AGE-LBL      (*)
  RESET #RT-REFUND-LBL(*) #RT-TTL-DUES-LBL (*)
  RESET #SCR-OPT-RT-DUES (*)
  RESET #SCR-OPT-RT-DUES-5 (*)
  RESET #SCR-OPT-RT-DUES-10 (*)
  RESET #SCR-OPT-RT-DUES-15 (*)
  RESET #SCR-OPT-RT-REFUND (*)
  RESET #SCR-OPT-RT-REFUND-5 (*)
  RESET #SCR-OPT-RT-REFUND-10 (*)
  RESET #SCR-OPT-RT-REFUND-15 (*)
  RESET #SCR-OPT-RT-TTL-DUES (*)
  RESET #SCR-OPT-RT-TTL-DUES-5 (*)
  RESET #SCR-OPT-RT-TTL-DUES-10 (*)
  RESET #SCR-OPT-RT-TTL-DUES-15 (*)
  RESET #SCR-OPT-RT-MINUS (*)
  RESET #SCR-OPT-RT-EQUAL (*)
  RESET #SCR-OPT-RT-MINUS-5 (*)
  RESET #SCR-OPT-RT-EQUAL-5 (*)
  RESET #SCR-OPT-RT-MINUS-10 (*)
  RESET #SCR-OPT-RT-EQUAL-10 (*)
  RESET #SCR-OPT-RT-MINUS-15 (*)
  RESET #SCR-OPT-RT-EQUAL-15 (*)
  RESET #SCR-OPT-DT-DUES-A
  RESET #SCR-OPT-DT-REFUND (*)
  RESET #SCR-OPT-DT-TTL-DUES (*)
  RESET #SCR-OPT-DT-MINUS (*)
  RESET #SCR-OPT-DT-EQUAL (*)
  RESET #SCR-DT-COV-1 (*)
  RESET #SCR-DT-COV-2 (*)
  RESET #SCR-DT-COV-3 (*)
  RESET #I2
*
  IF #TOT-FACE = 9999999
    RESET #TOT-FACE
  END-IF
*
END-REPEAT /*(0646)
*
* * * * * * * * * * * * * * * * * *
DEFINE SUBROUTINE FORMAT-NEW-PREMS
* * * * * * * * * * * * * * * * * *
*
RESET #USE-AT-QUOT
IF #FROM-AT
  FOR #I4 1 TO 5
    IF QUOT-FAC-AMT (#I4) NE 0
      MOVE TRUE TO #USE-AT-QUOT
      ESCAPE BOTTOM
    END-IF
  END-FOR
END-IF
*
IF #USE-AT-QUOT
*  write 'C2150SPO line 2822 using at quotes' quot-fac-amt (*) quot-plan (*)
  FOR #I4 1 TO 5
    MOVE QUOT-FAC-AMT (#I4) TO #FAC-TO-USE (#I4)
  END-FOR
*
  FOR #I4 1 TO 13                                     /* DW17
    MOVE QUOT-PLAN (#I4) TO #PLAN-TO-USE (#I4)
  END-FOR
*
  FOR #I4 3 TO 6
    MOVE QUOT-PLAN (#I4) TO #LT2-TERM-TO-USE (#I4 - 2)
  END-FOR
*
  MOVE QUOT-LT2-CLASS TO #LT2-CLASS-TO-USE       /* DW12
ELSE
  IF ((#NUM-PLANS NE 0) AND (NOT #SEL-VT))
      OR ((#INTRO-FLAG = 'K' OR = 'G')
*   and ((#CURR-AGE LT 18) OR (#CURR-AGE GT 23)))                             /* DW3 PM19
      AND ((#CURR-AGE LT 18)                                                        /* PM19
      OR (#CURR-AGE GT 23 AND FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = FALSE)))    /* PM19

    IGNORE
  ELSE
    MOVE '05' TO #LT2-TERM-TO-USE (1)
    MOVE '10' TO #LT2-TERM-TO-USE (2)
    MOVE '15' TO #LT2-TERM-TO-USE (3)
    MOVE '20' TO #LT2-TERM-TO-USE (4)
  END-IF
*
* IF (#NUM-PLANS = 0) AND (#NUM-FAC = 0)  /* nothing selected on input
  IF #NUM-FAC = 0  /* nothing selected on input
    IF #PDA-SCR-SUFFIX = 'VLT'     /* DW9
      MOVE 50  TO #FAC-TO-USE (1)
      MOVE 100 TO #FAC-TO-USE (2)
      MOVE 200 TO #FAC-TO-USE (3)
      MOVE 500 TO #FAC-TO-USE (4)
      MOVE 600 TO #FAC-TO-USE (5)
    ELSE
      MOVE 100 TO #FAC-TO-USE (1)
      MOVE 250 TO #FAC-TO-USE (2)
      MOVE 500 TO #FAC-TO-USE (3)
      MOVE 600 TO #FAC-TO-USE (4)
      MOVE 800 TO #FAC-TO-USE (5)
*
      IF #REM-FACE GT 600000  /* (4) above
        COMPUTE #FAC-TO-USE (5) = #REM-FACE / 1000
      ELSE
        IF #REM-FACE GT 500000  /* (3) above
          RESET #FAC-TO-USE (5)
          COMPUTE #FAC-TO-USE (4) = #REM-FACE / 1000
        ELSE
          IF #REM-FACE GT 250000  /* (2) above
            RESET #FAC-TO-USE (5)
            RESET #FAC-TO-USE (4)
            COMPUTE #FAC-TO-USE (3) = #REM-FACE / 1000
          ELSE
            IF #REM-FACE GT 100000
              RESET #FAC-TO-USE (5)
              RESET #FAC-TO-USE (4)
              RESET #FAC-TO-USE (3)
              COMPUTE #FAC-TO-USE (2) = #REM-FACE / 1000
            ELSE
              RESET #FAC-TO-USE (5)
              RESET #FAC-TO-USE (4)
              RESET #FAC-TO-USE (3)
              RESET #FAC-TO-USE (2)
              COMPUTE #FAC-TO-USE (1) = #REM-FACE / 1000
            END-IF
          END-IF
        END-IF
      END-IF
    END-IF
  END-IF
*
  IF #NUM-PLANS = 0  /* nothing selected on input
    MOVE 'X' TO #PLAN-TO-USE (2:8)  /* all terms but only OL for WL
    MOVE 'X' TO #PLAN-TO-USE (14)   /* EZ  RE2
  END-IF
*
  IF #INTRO-FLAG = 'K' OR = 'G'    /* DW5
    RESET #PLAN-TO-USE (7)    /* no RT for GEN
    IF #NUM-PLANS = 0  /* nothing selected on input    DW17
      MOVE 'X' TO #PLAN-TO-USE (8:12)  /* all WL options     /* DW6
    END-IF
*
    IF (#AGE LT 18) OR (#AGE GT 23 AND FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = FALSE) /* PM19
      RESET #PLAN-TO-USE (2:7) #LT2-TERM-TO-USE (*) #LT2-CLASS-TO-USE  /* DW12
    END-IF
*
    IF #AGE LE 14                              /* TT2                 /* DW17
      MOVE 'X' TO #PLAN-TO-USE (13)
    END-IF
  ELSE
    IF #AGE LT 17                  /* DW5
      RESET #PLAN-TO-USE (2:8) #LT2-TERM-TO-USE (*) #LT2-CLASS-TO-USE   /* DW12
    END-IF
  END-IF
*
  IF #AGE GT 70  /* rt/lt/lt2 not valid after age 70
    RESET #PLAN-TO-USE (2) #PLAN-TO-USE (7) #LT2-TERM-TO-USE (*)
      #LT2-CLASS-TO-USE                        /* DW12
    MOVE 'X' TO #PLAN-TO-USE (12) /* show sp
  END-IF
*
  IF #PDA-SCR-SUFFIX = 'VLT'     /* DW9
    RESET #PLAN-TO-USE (*)
    MOVE 'X' TO #PLAN-TO-USE (3:6) /* show LTII Only
  END-IF
END-IF
*
MOVE 1 TO #I1   /* #10k is already calced
RESET #I3       /* for headers
MOVE '__$10,000' TO #SCR-ADDL-COV-X (1)
MOVE '$10,000' TO #SCR-ADDL-VA-FIRST
MOVE '$50,000' TO #SCR-ADDL-TM-FIRST
*
IF #TOT-FACE = 795000  /* $10k prems can be split to get $5k prems
  MOVE '__$5,000' TO #SCR-ADDL-COV-X (1)
  MOVE ' $5,000' TO #SCR-ADDL-VA-FIRST
*
  COMPUTE ROUNDED #PREM-DOLS = #ONE-TIM-PREM-SP / 2
  MOVE #PREM-DOLS TO #PREM
  MOVE EDITED #PREM (EM=ZZ,Z99) TO #SCR-OPT-SP-DUES (1)
  COMPRESS '$' #SCR-OPT-SP-DUES (1)
    INTO #SCR-OPT-SP-DUES (1) LEAVING NO
  COMPUTE #PREM = #MONTHLY-PREM-7P / 2
  MOVE EDITED #PREM (EM=Z99.99) TO #SCR-OPT-7P-DUES (1)
  COMPRESS '$' #SCR-OPT-7P-DUES (1)
    INTO #SCR-OPT-7P-DUES (1) LEAVING NO
  COMPUTE #PREM = #MONTHLY-PREM-20 / 2
  MOVE EDITED #PREM (EM=Z99.99) TO #SCR-OPT-20-DUES (1)
  COMPRESS '$' #SCR-OPT-20-DUES (1)
    INTO #SCR-OPT-20-DUES (1) LEAVING NO
  COMPUTE #PREM = #MONTHLY-PREM-30 / 2
  MOVE EDITED #PREM (EM=ZZ9.99) TO #SCR-OPT-30-DUES (1)
  COMPRESS '$' #SCR-OPT-30-DUES (1)
    INTO #SCR-OPT-30-DUES (1) LEAVING NO
  COMPUTE #PREM = #MONTHLY-PREM-OL / 2
  MOVE EDITED #PREM (EM=Z99.99) TO #SCR-OPT-OL-DUES (1)
  COMPRESS '$' #SCR-OPT-OL-DUES (1)
    INTO #SCR-OPT-OL-DUES (1) LEAVING NO
  RESET #SCR-OPT-RT-DUES (1)
  RESET #SCR-OPT-DT-DUES (1)
ELSE
  ADD 1 TO #I1
*
  COMPUTE ROUNDED #PREM-DOLS = #ONE-TIM-PREM-SP-A * 1
  MOVE EDITED #PREM-DOLS (EM=ZZ,Z99) TO #SCR-OPT-SP-DUES (#I1)
  COMPRESS '$' #SCR-OPT-SP-DUES (#I1)
    INTO #SCR-OPT-SP-DUES(#I1) LEAVING NO
  COMPUTE #PREM = #MON-PREM-7P-A * 1
  MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-7P-DUES (#I1)
  COMPRESS '$' #SCR-OPT-7P-DUES (#I1)
    INTO #SCR-OPT-7P-DUES (#I1) LEAVING NO
  COMPUTE #PREM = #MON-PREM-20-A * 1
  MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-20-DUES (#I1)
  COMPRESS '$' #SCR-OPT-20-DUES (#I1)
    INTO #SCR-OPT-20-DUES (#I1) LEAVING NO
  COMPUTE #PREM = #MON-PREM-30-A * 1
  MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-30-DUES (#I1)
  COMPRESS '$' #SCR-OPT-30-DUES (#I1)
    INTO #SCR-OPT-30-DUES (#I1) LEAVING NO
  COMPUTE #PREM = #MON-PREM-OL-A * 1
  MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-OL-DUES (#I1)
  COMPRESS '$' #SCR-OPT-OL-DUES (#I1)
    INTO #SCR-OPT-OL-DUES (#I1) LEAVING NO
* IF (NOT #INTRO-FLAG = 'K' OR = 'G')   /* DW3
  COMPUTE #PREM = (#MONTHLY-PREM-RT - #POL-FEE)  / 5
  MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES (#I1)
  COMPRESS '$' #SCR-OPT-RT-DUES (#I1)
    INTO #SCR-OPT-RT-DUES (#I1) LEAVING NO
  IF #MONTHLY-PREM-RT-5 NE 0
    COMPUTE #PREM = (#MONTHLY-PREM-RT-5 - #POL-FEE)  / 5
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES-5 (#I1)
    COMPRESS '$' #SCR-OPT-RT-DUES-5 (#I1)
      INTO #SCR-OPT-RT-DUES-5 (#I1) LEAVING NO
  END-IF
*
  IF #MONTHLY-PREM-RT-10 NE 0
    COMPUTE #PREM = (#MONTHLY-PREM-RT-10 - #POL-FEE)  / 5
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES-10 (#I1)
    COMPRESS '$' #SCR-OPT-RT-DUES-10 (#I1)
      INTO #SCR-OPT-RT-DUES-10 (#I1) LEAVING NO
  END-IF
*
  IF #MONTHLY-PREM-RT-15 NE 0
    COMPUTE #PREM = (#MONTHLY-PREM-RT-15 - #POL-FEE)  / 5
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-RT-DUES-15 (#I1)
    COMPRESS '$' #SCR-OPT-RT-DUES-15 (#I1)
      INTO #SCR-OPT-RT-DUES-15 (#I1) LEAVING NO
  END-IF
*
*   IF   ((#SMOKER-FLAG = 'S') AND (#AGE GE 36)) /* chgd from 38 6/2001
*    OR  ((#SMOKER-FLAG = 'N') AND (#AGE GE 46))
  IF   ((#SMOKER-FLAG = 'S') AND (#AGE GE 40)) /* chgd from 36 6/2003
      OR  ((#SMOKER-FLAG = 'N') AND (#AGE GE 50))
    IGNORE
  ELSE
    COMPUTE #PREM = (#MONTHLY-PREM-DT - #POL-FEE)  / 5
    MOVE EDITED #PREM (EM=ZZZ.99) TO #SCR-OPT-DT-DUES (#I1)
    COMPRESS '$' #SCR-OPT-DT-DUES (#I1)
      INTO #SCR-OPT-DT-DUES (#I1) LEAVING NO
  END-IF
* END-IF     /* DW3
*
  IF #NUM-FAC NE 0
    ADD 1 TO #I1   /* spread it out
    ADD 1 TO #I3   /* spread it out
    FOR #I4 1 TO 3
      IF #DESIRED-FACE-AMT (#I4) NE 0
        ADD 1 TO #I1
        ADD 1 TO #I3
        MOVE #DES-FAC-N3 (#I4) TO #FAC-TO-USE (#I3)  /* PAM - new max        /*TT99
        MOVE EDITED #DES-FAC-N3 (#I4) (EM=ZZZ9) TO #SCR-ADDL-COV-1 (#I3)
*
        COMPRESS ' $' #SCR-ADDL-COV-1 (#I3) 'k'
          INTO #SCR-ADDL-COV-1 (#I3) LEAVING NO
        MOVE #SCR-ADDL-COV-1 (#I3) TO #SCR-ADDL-COV-2 (#I3)
        ADD 1 TO #I2
        COMPRESS '__' #SCR-ADDL-COV-1 (#I3)
          INTO #SCR-ADDL-COV-X (#I2) LEAVING NO
        MOVE #DESIRED-FACE-AMT (#I4) TO #FACE-AMT
        PERFORM SHOW-PREMS
      END-IF
    END-FOR
    ESCAPE ROUTINE
  END-IF
*
  FOR #I4 1 TO 5
*  write 'c2150spo ln 3233 fac-to-use=' #fac-to-use (*)
    IF #FAC-TO-USE (#I4) = 0
      RESET #SCR-OPT-OL-DUES (#I4 + 2) #SCR-OPT-7P-DUES (#I4 + 2)
        #SCR-OPT-20-DUES (#I4 + 2) #SCR-OPT-30-DUES (#I4 + 2)
        #SCR-OPT-SP-DUES (#I4 + 2)
      ESCAPE TOP
    END-IF
*
    ADD 1 TO #I1
    ADD 1 TO #I2
    ADD 1 TO #I3
    IF #FAC-TO-USE (#I4) LT 100
      COMPRESS '__ $' #FAC-TO-USE (#I4) 'k'
        INTO #SCR-ADDL-COV-X (#I2) LEAVING NO
      COMPRESS '  $' #FAC-TO-USE (#I4) 'k'
        INTO #SCR-ADDL-COV-1 (#I2) LEAVING NO
    ELSE
      COMPRESS '__$' #FAC-TO-USE (#I4) 'k'
        INTO #SCR-ADDL-COV-X (#I2) LEAVING NO
      COMPRESS ' $' #FAC-TO-USE (#I4) 'k'
        INTO #SCR-ADDL-COV-1 (#I2) LEAVING NO
    END-IF
*
    COMPUTE #FACE-AMT = #FAC-TO-USE (#I4) * 1000
*    write 'c2150spo ln 3280 perform Show-prem i4=' #i4
    PERFORM SHOW-PREMS
  END-FOR
END-IF
*
END-SUBROUTINE
*
* * * * * * * * * * * * * * *
DEFINE SUBROUTINE SHOW-PREMS
* * * * * * * * * * * * * * *
*
* write 'C2150SPO line 3298 *** show-prems' #intro-flag #curr-age 'fac=' #face-amt
*   'i1/i2/i3=' #i1 #i2 #i3 'plan=' #plan 'i4=' #i4
* write '3300 fac-to-use=' #fac-to-use (*)
MOVE #FACE-AMT TO #ORIG-FACE-AMT                              /* DW18
IF #CURR-AGE LE 14                          /* TT1           /* DW17
  FOR #I5 1 TO 5
    IF #FAC-TO-USE (#I5) GT 50              /* TT1   /* must have been from WL request
      MOVE TRUE TO #REBUILD-GPL
    END-IF
  END-FOR
*
  IF #REBUILD-GPL
*    write 'rebuild GPL'                    /* TT1 GPL
    MOVE 10 TO #GPL-FAC-TO-USE (1)
    MOVE 20 TO #GPL-FAC-TO-USE (2)
    MOVE 30 TO #GPL-FAC-TO-USE (3)
    MOVE 40 TO #GPL-FAC-TO-USE (4)
    MOVE 50 TO #GPL-FAC-TO-USE (5)
    COMPUTE #FACE-AMT = #GPL-FAC-TO-USE (#I4) * 1000
  END-IF
*
  MOVE 'GP2' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-GPL-DUES (#I1)
  MOVE #ORIG-FACE-AMT TO #FACE-AMT                                /* DW18
END-IF
*
IF  (#INTRO-FLAG = 'K' OR = 'G')
    OR (#CURR-AGE GE 17)
  MOVE 'OL' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-OL-DUES (#I1)
*
  MOVE '30P' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-30-DUES (#I1)
*
  MOVE '20P' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-20-DUES (#I1)
*
  MOVE '7P' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-7P-DUES (#I1)
*
  MOVE 'SI' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  MOVE ROUNDED #APRM TO #ONE-TIM-PREM-SP
  MOVE #ONE-TIM-PREM-SP TO #PREM
  MOVE EDITED #PREM (EM=ZZZ,Z99) TO #SCR-OPT-SP-DUES (#I1)
END-IF
*
IF   (#FACE-AMT GE 50000)    /* $50k is minimum
    AND ((NOT #INTRO-FLAG = 'K' OR = 'G')
* OR  ((#CURR-AGE GE 18) AND (#CURR-AGE LE 23)))                      /* DW3 /* PM19
    OR ((#CURR-AGE GE 18)                                                      /* PM19
    AND (#CURR-AGE LE 23 OR FUNCTION-GEN23-INSURE(<#ID-NUMBER-A>) = TRUE)))    /* PM19
    AND (#FACE-AMT LE #MAX-FACE-TERM)
  MOVE 'RT' TO #PLAN
  PERFORM CALLNAT-GPREMSXX
  COMPUTE #MONTHLY-PREM-RT = (#APRM / 12)
  MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-RT-DUES (#I1)
  PERFORM CALCULATE-REFUND
  MOVE EDITED #REFUND (EM=ZZZZ.99) TO #SCR-OPT-RT-REFUND (#I1)
  MOVE EDITED #TTL-PAID (EM=ZZZZ.99) TO #SCR-OPT-RT-TTL-DUES (#I1)
  MOVE #MINUS TO #SCR-OPT-RT-MINUS (#I1)
  MOVE #EQUALS TO #SCR-OPT-RT-EQUAL (#I1)
*
  ADD 5 TO #AGE
  IF #AGE LE 70
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-RT-5 = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-RT-DUES-5 (#I1)
    PERFORM CALCULATE-REFUND
    MOVE EDITED #REFUND (EM=ZZZZ.99) TO #SCR-OPT-RT-REFUND-5 (#I1)
    MOVE EDITED #TTL-PAID (EM=ZZZZ.99) TO #SCR-OPT-RT-TTL-DUES-5 (#I1)
    MOVE #MINUS TO #SCR-OPT-RT-MINUS-5 (#I1)
    MOVE #EQUALS TO #SCR-OPT-RT-EQUAL-5 (#I1)
  END-IF
*
  ADD 5 TO #AGE
  IF #AGE LE 70
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-RT-10 = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-RT-DUES-10 (#I1)
    PERFORM CALCULATE-REFUND
    MOVE EDITED #REFUND (EM=ZZZZ.99) TO #SCR-OPT-RT-REFUND-10 (#I1)
    MOVE EDITED #TTL-PAID (EM=ZZZZ.99) TO #SCR-OPT-RT-TTL-DUES-10 (#I1)
    MOVE #MINUS TO #SCR-OPT-RT-MINUS-10 (#I1)
    MOVE #EQUALS TO #SCR-OPT-RT-EQUAL-10 (#I1)
  END-IF
*
  ADD 5 TO #AGE
  IF #AGE LE 70
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-RT-15 = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-RT-DUES-15 (#I1)
    PERFORM CALCULATE-REFUND
    MOVE EDITED #REFUND (EM=ZZZZ.99) TO #SCR-OPT-RT-REFUND-15 (#I1)
    MOVE EDITED #TTL-PAID (EM=ZZZZ.99) TO #SCR-OPT-RT-TTL-DUES-15 (#I1)
    MOVE #MINUS TO #SCR-OPT-RT-MINUS-15 (#I1)
    MOVE #EQUALS TO #SCR-OPT-RT-EQUAL-15 (#I1)
  END-IF
  SUBTRACT 15 FROM #AGE
*
* IF   ((#SMOKER-FLAG = 'S') AND (#AGE GE 36)) /* chgd from 38 6/2001
*  OR  ((#SMOKER-FLAG = 'N') AND (#AGE GE 46))
  IF   ((#SMOKER-FLAG = 'S') AND (#AGE GE 40)) /* chgd from 36 6/2003
      OR  ((#SMOKER-FLAG = 'N') AND (#AGE GE 50))
    IGNORE
  ELSE
    MOVE 'LT' TO #PLAN
    PERFORM CALLNAT-GPREMSXX
    COMPUTE #MONTHLY-PREM-DT = (#APRM / 12)
    MOVE EDITED #PREM (EM=ZZZZ.99) TO #SCR-OPT-DT-DUES (#I1)
    PERFORM CALCULATE-REFUND
    MOVE EDITED #REFUND (EM=ZZZZ.99) TO #SCR-OPT-DT-REFUND (#I1)
    MOVE EDITED #TTL-PAID (EM=ZZZZ.99) TO #SCR-OPT-DT-TTL-DUES (#I1)
    MOVE #MINUS TO #SCR-OPT-DT-MINUS (#I1)
    MOVE #EQUALS TO #SCR-OPT-DT-EQUAL (#I1)
*
    COMPUTE #DT-COV = #FACE-AMT * .27
    MOVE EDITED #DT-COV (EM=ZZZ,ZZ9) TO #SCR-DT-COV-1 (#I1)
    COMPUTE #DT-COV = #FACE-AMT * .20
    MOVE EDITED #DT-COV (EM=ZZZ,ZZ9) TO #SCR-DT-COV-2 (#I1)
    MOVE '      0' TO #SCR-DT-COV-3 (#I1)
  END-IF
*
  FOR #I5 1 TO 4
    IF #LT2-TERM-TO-USE (#I5) NE ' '
      IF #LT2-CLASS-TO-USE = 'U'                            /* DW12
        COMPRESS 'U' #LT2-TERM-TO-USE (#I5) INTO #PLAN LEAVING NO
      ELSE
        IF #LT2-CLASS-TO-USE = 'W'                            /* DW12
          COMPRESS 'W' #LT2-TERM-TO-USE (#I5) INTO #PLAN LEAVING NO
        ELSE
*          COMPRESS 'V' #LT2-TERM-TO-USE (#I5) INTO #PLAN LEAVING NO    TEMP
          COMPRESS 'R' #LT2-TERM-TO-USE (#I5) INTO #PLAN LEAVING NO
        END-IF
      END-IF
*
      PERFORM CALLNAT-GPREMSXX
      MOVE EDITED #PREM (EM=ZZZZ.99) TO #LTII-APA-PREMS (#I5, #I1)
    END-IF
  END-FOR
END-IF
*
END-SUBROUTINE
*
* * * * * * * * * * * * * * * *
DEFINE SUBROUTINE GET-CUR-INS
* * * * * * * * * * * * * * * *
*
RESET #I2
*
FOR #IFL 1 TO 9
  IF  (ST-V.STATUS (#IFL) NE 'D')
      OR (PLAN (#IFL) = 'SO' OR = 'FSO')
    ESCAPE TOP
  END-IF
*
  MOVE *DATN TO #EFF-DATE
  IF ((ST-V.PLAN (#IFL) = 'LT')
      AND (#DATE-OF-BIRTH LE (#EFF-DATE - 400000)))
      OR  ((ST-V.PLAN(#IFL) = 'RT')
      AND (ST-V.ISSUE-AGE(#IFL) GT '65'))
      OR  (((ST-V.PLAN-A1 (#IFL) GE 'U') AND (ST-V.PLAN-A1 (#IFL) LE 'Z'))
      AND ((ST-V.ISSUE-DATE(#IFL) + 40000) LE #EFF-DATE))
      OR (IS-ANNUITY-LIFE(<ST-V.PLAN(#IFL)>))   /* DW2         /* TT2
*
    CALLNAT 'GDROPSTM' USING
      ST-V.PLAN          (#IFL)
      ST-V.SMOKER-FLAG   (#IFL)
      #DATE-OF-BIRTH
      ST-V.ISSUE-DATE    (#IFL)
      ST-V.PAID-UP-DATE  (#IFL)
      #EFF-DATE
      ST-V.ISSUE-AGE     (#IFL)
      #PAY-STAT
      ST-V.FACE-AMOUNT   (#IFL)
      ST-V.DEATH-BENEFIT (#IFL)
      ST-V.CASH-VALUE    (#IFL)
      ST-V.BEG-CASH-VALUE(#IFL)
  END-IF
*
* IF PAY-STATUS (#IFL) = '45'  /* rpu    - removed 5/98 as per BMG
*   IF ISSUE-DATE (#IFL) LT 19941201
*     COMPUTE #TOT-FACE = #TOT-FACE + (NUM-MBRSHIPS (#IFL) * 5000)
*   ELSE
*     COMPUTE #TOT-FACE = #TOT-FACE + (EXPIRY-DAY (#IFL) * 5000)
*   END-IF
* ELSE
  ADD ST-V.FACE-AMOUNT (#IFL) TO #TOT-FACE
  IF (ST-V.PLAN (#IFL) = 'LT')               /* PAM - new maximums for
      OR (ST-V.PLAN(#IFL) = 'RT')               /* term and whole life
      OR ((ST-V.PLAN-A1 (#IFL) GE 'U') AND (ST-V.PLAN-A1 (#IFL) LE 'Z'))
    ADD ST-V.FACE-AMOUNT (#IFL) TO #TOT-FACE-TERM
  END-IF
* END-IF
  ADD ST-V.FACE-AMOUNT (#IFL) TO #ACTUAL-FACE
*
  IF (ONLINE-ACTION (#IFL) = '1') OR (ONLINE-ACTION-GN = '2')
      OR (ST-V.PLAN (#IFL) = 'LT')
    ADD  ST-V.FACE-AMOUNT (#IFL) TO #CURR-DB
  ELSE
    RESET #AVL-TDIV
    IF   (ISSUE-DATE (#IFL) GE 19970101)
        AND (MONTH-ALLOC-AMT (#IFL) NE 999.99)
      COMPUTE #AVL-TDIV = BEG-CASH-VALUE (#IFL) - MONTH-ALLOC-AMT (#IFL)
*
      IF #AVL-TDIV LT 0
        RESET #AVL-TDIV
      END-IF
*
      IF ST-V.ID-NUMBER = 124156                                 /* PM10
          AND ST-V.ISSUE-DATE (#IFL) = 20040413                     /* PM10
          AND ST-V.DEATH-BENEFIT (#IFL) = 226000                    /* PM10
        MOVE 10150.58 TO #AVL-TDIV                               /* PM10
      END-IF                                                     /* PM10
    END-IF
*
    IF (ISSUE-DATE-DD (#IFL) = 01)
        OR (#TODAY-DD GE ISSUE-DATE-DD (#IFL))
      MOVE DEATH-BENEFIT (#IFL) TO #DB  /* USE CURRENT DB
      ADD #AVL-TDIV TO #DB
*
      IF (ISSUE-DATE (#IFL) GE 19970101)
          AND (MONTH-ALLOC-AMT (#IFL) NE 999.99)
          AND (LAST-ANN-CASH-VALUE (#IFL) GT #DB)
        MOVE LAST-ANN-CASH-VALUE (#IFL) TO #DB
      END-IF
*
      ADD #DB TO #CURR-DB
    ELSE
      MOVE NXT-MON-DEATH-BENEFIT (#IFL) TO #DB  /* USE LAST DB
      IF (ISSUE-DATE (#IFL) GE 19970101)
          AND (MONTH-ALLOC-AMT (#IFL) NE 999.99)
          AND (LAST-ANN-CASH-VALUE (#IFL) GT
          NXT-MON-DEATH-BENEFIT (#IFL))
        MOVE LAST-ANN-CASH-VALUE (#IFL) TO #DB
      END-IF
      ADD #DB TO #CURR-DB
    END-IF
  END-IF
END-FOR
*
IF #PDA-SCR-SUFFIX = 'OVR' OR = 'VLT'  /* DW9  /* allow max insurance
  RESET #TOT-FACE
END-IF
*
END-SUBROUTINE
*
* * * * * * * * * * * * * *
DEFINE SUBROUTINE MOVE-AT
* * * * * * * * * * * * * *
*
MOVE TRUE TO #FND-REC
MOVE TRUE TO #FROM-AT
MOVE AT-V.ID-NUMBER       TO ST-V.ID-NUMBER
MOVE AT-V.INTRO-FLAG      TO ST-V.INTRO-FLAG
MOVE AT-V.SEX             TO #GENDER   /* DW7        /* TT2
MOVE AT-V.SSN             TO ST-V.SSN
MOVE AT-V.DATE-OF-BIRTH   TO #DATE-OF-BIRTH          /* TT2
MOVE AT-V.NAME            TO ST-V.NAME
MOVE AT-V.MIL-STATUS      TO ST-V.MILITARY-STATUS
MOVE AT-V.RANK            TO ST-V.RANK
* MOVE AT-V.HOME-PHONE      TO ST-V.TELE-NUMBER
* MOVE AT-V.HOME-PHONE-INTR TO ST-V.HOME-TELE-INTR
* MOVE AT-V.WORK-PHONE      TO ST-V.NXT-OF-KIN-TELE-NUMBER
* MOVE AT-V.WORK-PHONE-INTR TO ST-V.WORK-TELE-INTR
*
#at-found := true                                      /* vt2
IF AT-V.SMOKER-FLAG = 'Y'
  MOVE 'S' TO #SMOKER-FLAG
END-IF
*
END-SUBROUTINE
*
* * * * * * * * * * * * *
DEFINE SUBROUTINE MOVE-IM
* * * * * * * * * * * * *
*
MOVE TRUE TO #FND-REC
MOVE TRUE TO #FROM-IM
MOVE IM-V.ID-NUMBER     TO ST-V.ID-NUMBER
RESET                      ST-V.INTRO-FLAG
MOVE IM-V.SSN           TO ST-V.SSN
MOVE IM-V.SEX           TO #GENDER   /* DW7          /* TT2
MOVE IM-V.DATE-OF-BIRTH TO #DATE-OF-BIRTH            /* TT2
MOVE IM-V.NAME          TO ST-V.NAME
MOVE 'A'                TO ST-V.MILITARY-STATUS
MOVE IM-V.RANK          TO ST-V.RANK
*
END-SUBROUTINE
* * * * * * * * * * * * * * * * * *
DEFINE SUBROUTINE CALLNAT-GPREMSXX
* * * * * * * * * * * * * * * * * *
* rating not needed since only for new policies
IF   (#PDA-SCR-SUFFIX = 'OLD')      /* DW1
    AND ((#PLAN-A1 GE 'U') AND (#PLAN-A1 LE 'Z'))
    AND (#SEX = 'F')
  MOVE 20050531 TO #ISSUE-DATE
END-IF
*
IF   (#PDA-SCR-SUFFIX = 'ATA') /*to get nu rates ahead of time for quote
    AND (#SEX = 'F')
    AND ((#PLAN-A1 GE 'U') AND (#PLAN-A1 LE 'Z'))
  MOVE 20050601 TO #ISSUE-DATE
* WRITE ST-V.ID-NUMBER 'bumped to 6/1/2005' #PLAN
END-IF
*                                 NG3 Start
IF #SCR-SUFFIX = ' '
  IF #RATED-CLASS > 0
    COMPRESS 'SB' #RATED-CLASS INTO #SCR-SUFFIX LEAVING NO
  ELSE
    RESET #SCR-SUFFIX
  END-IF
END-IF
*                                 NG3 End
CALLNAT 'GPREMSXX' #SCR-COMMAND #SCR-ID #SCR-SUFFIX
  #PLAN #AGE #APRM #ISSUE-DATE #SMOKER-FLAG #FACE-AMT #SEX  /* DW7
COMPUTE #PREM = #APRM / 12
IF   (#PDA-SCR-SUFFIX = 'OLD')    /* DW1
    AND ((#PLAN-A1 GE 'U') AND (#PLAN-A1 LE 'Z'))
    AND (#SEX = 'F')
  MOVE #SCN-AOD-YYYYMMDD TO #ISSUE-DATE
END-IF
RESET #SCR-SUFFIX
* write 'ln 3928 after callnat gpremsxx aprm=' #aprm
*
END-SUBROUTINE
*
* * * * * * * * * * * * * *
DEFINE SUBROUTINE ERROR-MSG
* * * * * * * * * * * * * *
*
IF *DEVICE = 'BATCH'
  MOVE TRUE TO #BATCH-ERROR
END-IF
*
END-SUBROUTINE
*
* * * * * * * * * * * * * * * * * *
DEFINE SUBROUTINE CALCULATE-REFUND
* * * * * * * * * * * * * * * * * *
*
MOVE #PREM TO #REFUND-CALC
*
IF #SUBTRACT-DUES
  SUBTRACT 2.00 FROM #REFUND-CALC
END-IF
*
IF #PLAN = #RT
  IF #SCN-AOD-YYYYMMDD GE 20080101                                  /* PM16
    COMPUTE ROUNDED #REFUND = #REFUND-CALC * #RT-REFUND-RATE-2008   /* PM16
  ELSE                                                              /* PM16
    COMPUTE ROUNDED #REFUND = #REFUND-CALC * #RT-REFUND-RATE
  END-IF                                                            /* PM16
ELSE
  IF   (#SCN-AOD-YYYYMMDD GE 20030701)
      AND (#FACE-AMT LE 100000)
      AND (#SMOKER-FLAG = 'N')
    RESET #REFUND
  ELSE
    IF #SCN-AOD-YYYYMMDD GE 20020102
      COMPUTE ROUNDED #REFUND = #REFUND-CALC * #LT-REFUND-RATE-2002
    ELSE
      COMPUTE ROUNDED #REFUND = #REFUND-CALC * #LT-REFUND-RATE
    END-IF
  END-IF
END-IF
*
COMPUTE #TTL-PAID = #PREM - #REFUND
*
END-SUBROUTINE
*
** - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
DEFINE SUBROUTINE CHECK-AFFL-ONLY                                       /*  bz1
*  PERFORM  CHECK-AFFL-ONLY                                             /*  bz1
* 1 #AFFL-ONLY (L) INIT <FALSE>                                         /*  bz1
IF ( ST-V.PROCESS-IND <> "S" ) OR ( ST-V.STATUS(*) <> " " )            /*  bz1
  #AFFL-ONLY := FALSE                                                  /*  bz1
ELSE                                                                   /*  bz1
  IF ST-V.INTRO-FLAG NE 'A'  #AFFL-ONLY := TRUE                        /*  bz1
  ELSE #AFFL-ONLY := FALSE                                          /*  bz1
  END-IF                                                               /*  bz1
END-IF                                                                 /*  bz1
END-SUBROUTINE
END
