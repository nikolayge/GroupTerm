* >Natural Source Header 000000
* :Mode S
* :CP ISO_8859-1:1987
* :LineIncrement 2
* <Natural Source Header
**************************************************************************
* SUBPROGRAM-ID: GUPCISXX
* DESCRIPTION: PF4 FUNCTION - View/Update/Add/Delete Contact Record
**************************************************************************
*        MODIFICATION LOG
**************************************************************************
* USER   DATE      TAG  REASON
* LR  03-19-2010   LR1  Correct date format from (YYYYMMDD) to  (MMDDYYYY)
* RSE 04-22-2010   RE1  Add confirmation pop-up for Last Name;
*                       Change PF5 to PF11; Move 'N' to DELETE-FLAG if
*                       deleted Contact was selected.
* RSE 04-27-2010   RE2  Get next available Contact-ID from Terminals file
*                       instead of 'Read Contacts file descending'.
* RSE 04-28-2010   RE3  Validate SSN first before Last Name
* RSE 04-29-2010   RE4  Protect fields for Spouse/Dependents with CN
* RSE 05-03-2010   RE5  Allow dependents to be added to new Member
* RSE 06-03-2010   RE6  Unprotect Birth and Marriage Cert Codes for IAS user
* RSE 06-03-2010   RE7  Add dead spouse to MD file
* RSE 06-09-2010   RE8  Delete all relations records for a person with multiple roles
*                       that is selected for deletion (TEMP ONLY)
* RSE 06-15-2010   RE9  Default First Name to 'UNKNOWN' when left blank
* RSE 06-26-2010   RE10 Do not allow deletion of AER member's widow
* RSE 08-06-2010   RE11 Do a physical delete of records selected for deletion
* RSE 08-12-2010   RE12 Add Role Code 'O' for CAO
* RSE 08-13-2010   RE13 Increase length of variable #ORGANIZATION to 75; modify
*                       C2234MCB
* RSE 08-16-2010   RE14 Connect Notes and Address functionalities, also PF12
*                       for relationships
* RSE 08-18-2010   RE15 Set Depn Status Code to 'D' when date of death entered
* RSE 08-23-2010   RE16 Comment out check for year 1900
* RSE 09-10-2010   RE17 Default to 'Y' on Last Name screen
* RSE 09-11-2010   RE18 CR249 Changes
* RSE 09-28-2010   RE19 Allow duplicate SSNs (actually TIN) for Trustees
* RSE 10-08-2010   RE20 Update marriage cert code for former spouse
* RSE 10-25-2010   RE21 Add Role Code 'Z' (Business Partner) and 'H' (Grandparent)
* BZ  11-01-2010   bz1  Add validation for names
* BZ  11-01-2010   bz2  Exclude Trust-Owner from name validation
* vxt 11/05/2010   vt1  replace 60606060 with 99999999 for the grandfather.
* RSE 11/23/2010   RE22 Add SSN Protect processing
* RSE 12/03/2010   RE23 Add Original ID parameter
* RSE 12/08/2010   RE24 Add DEATH-CERT-CODE
* RSE 12-21-2010   RE25 Add Role Codes 'U' and 'W'
* RSE 01-04-2010   RE26 Add Prefix-Title/Contact Type; name optional for W and O
* RSE 01-24-2010   RE27 Delete by ISN
* RSE 01-28-2010   RE29 Add further checks before populating first name w/ "Unknown"
* NGG 02-08-2011   NG2  New rules for "Unknown"
* RSE 02-15-2011   RE30 Allow duplicate SSN for Contact Entities
* RSE 02-16-2011   RE31 Fix LAST-USER-UPD issue
* RSE 02-24-2011   RE32 Populate Spouse/Former Spouse Contact-ID's
* RSE 03-23-2011   RE33 Suppress Last Name pop-up for Other
* RSE 04-06-2011   RE34 Populate PREFIX for new spouse/dependents
* RSE 05-17-2011   RE35 Convert to external map; add name change reason
* RSE 05-19-2011   RE36 Add Role Codes 'L', 'Y' and 'V'
* RSE 05-25-2011   RE37 Call subprogram to sync with CRM
* RSE 06-07-2011   RE38 Add processing for organization; call validation rtn
* RSE 06-20-2011   RE39 Standardize TR Call
* RSE 06-27-2011   RE40 Unprotect fields except date of death or in View mode;
*                       process CB Member
* NGG 07-05-2011   NG3  Various fixes
* bz  07-07-2011   bz3  fix TR-REG duplicates
* bz  07-08-2011   bz4  Various
* RSE 07-13-2011   RE41 Pass original command to TR program; Change Role Code 'Y' to 'J'; add 'C'
*                       fix TR processing for widow
* RSE 07-14-2011   RE42 Display standard header for Rank and Name
* RSE 07-18-2011   RE43 Allow entry of duplicate SSN for Organization
* RSE 07-21-2011   RE44 When organization, update Status file NAME with organization name
* RSE 07-22-2011   RE45 Fix marriage/divorce date problem - member's dates should show on screen
* RSE 07-25-2011   RE46 Fix problem of not adding contact through PF4 (Search)
* RSE 07-28-2011   RE47 Name change screen should not display when Contact pulled through SSN
* RSE 08-03-2011   RE48 Fix problem of not being able to add contact by CN
* RSE 08-10-2011   RE49 Translate PREFIX to upper case
* RSE 08-12-2011   RE50 Ensure member's name is on the TR record
* RSE 08-17-2011   RE51 Default 'W' if coming from Death View (Funeral)
* NGG 08-18-2011   NG4  NM ... CON Functionality was added
* RSE 08-24-2011   RE52 When new organization, don't give SSN selection screen
* RSE 08-31-2011   RE53 After ADD mode, go to UPDATE mode right away
* RSE 09-22-2011   RE54 Fix two issues: Marriage Cert Code not being updated;
*                       Dependent status code not updated when DOD is removed
* RSE 10-12-2011   RE55 Add former husband processing; various fixes incl updating firs when
*                       S or X is changed to K, D, or G.
* RSE 12-27-2011   RE56 Don't display error message if spouse being added has CN and married to member
* RSE 01-04-2012   RE57 Use org's role code, if existing, for org contact being added; pop up screen
*                       when updating role of org; if contact type missing, prevent duplicate creation.
* RSE 02-13-2012   RE58 Use correct CID to delete
* vxt 04-12-2012   vt2  Open DOD for update for non member owner.
* RSE 05-07-2012   RE59 Qualified Status and Contact fields due to changes in GPRAPINF for AUC project
* bz-Name-C 07/07/2017     Fine Names. Keep all capital  
****************************************************************************
DEFINE DATA
PARAMETER
1 #CO-ID-1          (N8)    /* Member Contact ID
1 #CO-ID-2          (N8)    /* Spouse, Former Sp, Dependents, Others If 0 -> new contact
1 #CGA-ORIG-COMMAND (A2)
1 #CGA-ORIG-ID      (N6)
1 #CGA-USER-COMPANY (A1)
1 #CGA-CLERK        (A3)
1 #MODE             (A1)  /* U - Update, V - View  C - Member  O - Organization
1 #MSG              (A72)
LOCAL USING GPRAPINF      /* RE38
LOCAL USING C2230ACB      /* RE39
LOCAL
1 CNT VIEW OF A-CONTACTS
  2 CONTACT-ID       (N8)           /* D
  2 CONTACT-TYPE     (A1)           /* RE26
  2 RANK-ID          (N6)           /* RE35
  2 ID-NUMBER        (N6)           /* D
  2 PREFIX-TITLE     (A25)          /* RE26
  2 FIRST-NAME       (A25)
  2 MIDDLE-NAME      (A25)
  2 LAST-NAME        (A25)
  2 SUFFIX           (A10)
  2 GENDER-CD        (A1)         /* --NA
  2 DATE-OF-BIRTH    (N8)
  2 SSN              (N9)           /* D
  2 REDEFINE SSN
    3 #SSN-A         (A9)
    3 REDEFINE #SSN-A
      4 #SSN-A3      (A3)
      4 #SSN-A2      (A2)
      4 #SSN-A4      (A4)
  2 SSN-PROTECT      (A1)   /* RE22
  2 SSN-PROTECT-DATE (N8)   /* RE22
  2 DATE-OF-DEATH    (N8)
  2 BIRTH-CERT-CODE  (A1)
  2 DEATH-CERT-CODE  (A1)   /* RE24
  2 WEBSITE-URL      (A70)  /* RE35
  2 FIRM-ORGANIZATION-NAME (A75)
  2 FIRM-ESTABLISHED-DATE(N8)
  2 FIRM-CERT-CODE   (A1)
  2 CONTACT-REMARKS  (A75/3)    /* MU-FIELD
  2 LAST-USER-UPD    (A8)
  2 LAST-DATE-UPD    (N8)
*
1 CNT-U VIEW OF A-CONTACTS
  2 CONTACT-ID       (N8)           /* D
  2 CONTACT-TYPE     (A1)           /* RE26
  2 ID-NUMBER        (N6)           /* D
  2 PREFIX-TITLE     (A25)          /* RE26
  2 FIRST-NAME       (A25)
  2 MIDDLE-NAME      (A25)
  2 LAST-NAME        (A25)
  2 SUFFIX           (A10)
  2 GENDER-CD        (A1)         /* --NA
  2 DATE-OF-BIRTH    (N8)
  2 SSN              (N9)           /* D
  2 SSN-PROTECT      (A1)   /* RE22
  2 SSN-PROTECT-DATE (N8)   /* RE22
  2 DATE-OF-DEATH    (N8)
  2 BIRTH-CERT-CODE  (A1)
  2 DEATH-CERT-CODE  (A1)   /* RE24
  2 DELETE-FLAG      (A1)
  2 FIRM-ORGANIZATION-NAME (A75)
  2 FIRM-ESTABLISHED-DATE(N8) /* RE38
  2 FIRM-CERT-CODE   (A1)     /* RE38
  2 WEBSITE-URL      (A70)
  2 CONTACT-REMARKS  (A75/3)    /* MU-FIELD
  2 REDEFINE CONTACT-REMARKS
    3 #CONTACT-REMARKS (3)
      4 #OLD-DESC      (A20)
      4 #OLD-VALUE     (A50)
      4 #FILLER        (A5)
  2 LAST-USER-UPD    (A8)
  2 LAST-DATE-UPD    (N8)
  2 LAST-TIME-UPD    (N7)
*
1 CNT-S VIEW OF A-CONTACTS
  2 CONTACT-ID       (N8)           /* D
  2 CONTACT-TYPE     (A1)           /* RE26
  2 ID-NUMBER        (N6)           /* D
  2 PREFIX-TITLE     (A25)          /* RE26 RE34
  2 FIRST-NAME       (A25)
  2 MIDDLE-NAME      (A25)
  2 LAST-NAME        (A25)
  2 SUFFIX           (A10)
  2 RANK-ID          (N6)   /* RE55
  2 GENDER-CD        (A1)         /* --NA
  2 DATE-OF-BIRTH    (N8)
  2 SSN              (N9)           /* D
  2 SSN-PROTECT      (A1)   /* RE22
  2 SSN-PROTECT-DATE (N8)   /* RE22
  2 DATE-OF-DEATH    (N8)
  2 BIRTH-CERT-CODE  (A1)
  2 DEATH-CERT-CODE  (A1)   /* RE24
  2 DELETE-FLAG      (A1)
  2 FIRM-ORGANIZATION-NAME (A75)
  2 FIRM-ESTABLISHED-DATE(N8) /* RE38
  2 FIRM-CERT-CODE   (A1)     /* RE38
  2 WEBSITE-URL      (A70)
  2 CONTACT-REMARKS  (A75/3)    /* MU-FIELD
  2 LAST-USER-UPD    (A8)
  2 LAST-DATE-UPD    (N8)
  2 LAST-TIME-UPD    (N7)
*
1 CNT-REL VIEW OF A-CONTACT-RELATIONSHIPS
  2 CONTACT-1-ID     (N8)           /* D
  2 ROLE-1-CD        (A1)
  2 CONTACT-2-ID     (N8)           /* D
  2 ROLE-2-CD        (A1)
  2 ACCESS-AUTH-SVC  (A1)
  2 ACCESS-AUTH-INS  (A1)
*
1 CNT-REL-U VIEW OF A-CONTACT-RELATIONSHIPS
  2 CONTACT-1-ID     (N8)           /* D
  2 ROLE-1-CD        (A1)
  2 CONTACT-2-ID     (N8)           /* D
  2 ROLE-2-CD        (A1)
  2 ACCESS-AUTH-SVC  (A1)
  2 ACCESS-AUTH-INS  (A1)
  2 LAST-USER-UPD    (A8)
  2 LAST-DATE-UPD    (N8)
  2 LAST-TIME-UPD    (N7)
*
1 CNT-REL-S VIEW OF A-CONTACT-RELATIONSHIPS
  2 CONTACT-1-ID     (N8)           /* D
  2 ROLE-1-CD        (A1)
  2 CONTACT-2-ID     (N8)           /* D
  2 ROLE-2-CD        (A1)
  2 ACCESS-AUTH-SVC  (A1)
  2 ACCESS-AUTH-INS  (A1)
  2 LAST-USER-UPD    (A8)
  2 LAST-DATE-UPD    (N8)
  2 LAST-TIME-UPD    (N7)
*
1 STATUS VIEW OF A-STATUS
  2 ID-NUMBER
  2 MEMBER-CONTACT-ID
  2 MEMBER-FLAG
  2 WIDOW-FLAG
  2 NAME
*   2 SEX                       /* TT1
  2 SSN
  2 PROCESS-IND
  2 INTRO-FLAG
*   2 DATE-OF-BIRTH             /* TT1
  2 DATE-OF-MARRIAGE
  2 DATE-OF-DIVORCE
  2 DATE-OF-DEATH
  2 BIRTH-CERT-CODE
  2 DEATH-CERT-CODE              /* RE24
  2 MARRIAGE-CERT-CODE
  2 ACCESS-AUTH-CODE
  2 SPOUSE-CONTACT-ID
  2 NAME-SP
  2 SSN-SP
*   2 SEX-SP                     /* TT1
*   2 DATE-OF-BIRTH-SP           /* TT1
  2 STATUS-CODE-SP
  2 FORMER-SPOUSE-CONTACT-ID
  2 FORMER-SPOUSE-NAME
  2 FORMER-SPOUSE-SSN
*   2 FORMER-SPOUSE-DT-OF-BIRTH  /* TT1
  2 FORMER-SPOUSE-DATE-OF-MARRIAGE
  2 FORMER-SPOUSE-DATE-OF-DIVORCE
  2 FORMER-SPOUSE-STATUS
  2 FORMER-HUSBAND-CONTACT-ID
  2 FORMER-HUSBAND-NAME
  2 FORMER-HUSBAND-SSN
  2 FORMER-HUSBAND-SERV-CONN
  2 FORMER-HUSBAND-SBP-OPTION
  2 FORMER-HUSBAND-SBP-AMT
  2 FORMER-HUSBAND-VA-CLAIM-NUM
  2 FORMER-HUSBAND-DOD
  2 FORMER-HUSBAND-RANK
  2 FORMER-HUSBAND-SOC-SEC-PIA
  2 FORMER-HUSBAND-OFFSET-PIA
  2 FS-BIRTH-CERT-CD
  2 FS-MARR-CERT-CD
  2 BIRTH-CERT-CODE-SP
  2 TITLE-SP
  2 MAILING-FLAG-SP
  2 ALOT-SW
  2 LAST-FM-DATE
  2 DTS-DATN
  2 DTS-TIMN
  2 APPL-SOURCE  /* RE10
  2 CHIEF-OF-STAFF-IND /* RE22
  2 number-memberships                              /* vt2
*
1 STATUS-2 VIEW OF A-STATUS      /* RE54
  2 NAME                         /* RE54
*
1 FIRS VIEW OF A-FIRS
  2 ID-NUMBER
  2 MEMBER-FLAG
  2 WIDOW-FLAG
  2 CONTACT-ID-NUMBER
  2 DEPENDENT-TABLE  (60)
    3 DEPN-CONTACT-ID
    3 DEPN-NAME
    3 DEPN-BIRTH-CD
    3 DEPN-STATUS-CD
    3 DEPN-DATE-OF-BIRTH
    3 DEPN-SSN
    3 DEPN-REMARKS
  2 DEPN-COLL-FUND-TBL (60)
    3 DEPN-COLL-FUND (P7)
  2 DEPN-COLL-TYPE-TBL (60)
    3 DEPN-COLL-TYPE (A1)
  2 DEPN-COLL-INFO-TBL (60)
    3 DEPN-COLL-FROM-YYYY (N4)
    3 DEPN-COLL-THRU-YYYY (N4)
    3 DEPN-COLL-ANN-COST (P6)
  2 DP-LAST-FM-DATE (N8.0)
  2 DTS-DATN (P9.0)
  2 DTS-TIMN (P7.0)
*
1 TERM VIEW OF A-TERMINALS
  2 CLERK-ID
  2 COMMENTS
  2 REDEFINE COMMENTS
    3 #CONTACT-ID (N8)
*
1 MBRSHIP-MTD-DET-V VIEW OF A-MBRSHIP-MTD-DETAIL   /* DW9
  2 ID-NUMBER
  2 ENTRY-DATE
  2 REC-ISN
  2 CODE
  2 ISSUE-DATE
  2 NUM-MBRSHIPS
*
1 ADDR-REL-V VIEW OF A-ADDRESS-RELATIONSHIP
  2 ADDRESS-POOL-ID
*
1 ADDR-POOL-V VIEW OF A-ADDRESS-POOL
*
1 CNT-EMAIL-V VIEW OF A-CONTACT-EMAIL
*
1 CNT-PHONE-V VIEW OF A-CONTACT-PHONE
*
1 RANK-V VIEW OF A-RANK-REFERENCE  /* RE35
  2 RANK-IN-SAS                    /* RE35
*
1 #FIRST-NAME       (A25)
1 #MIDDLE-NAME      (A25)
1 #LAST-NAME        (A25)
1 #SUFFIX           (A10)
1 #SAVE-FIRST-NAME  (A25)
1 #SAVE-MIDDLE-NAME (A25)
1 #SAVE-LAST-NAME   (A25)
1 #SAVE-SUFFIX      (A10)
1 #SAVE-SSN         (N9)
1 #GENDER-CD        (A1)         /* --NA
1 #DATE-OF-BIRTH    (N8)
1 #SSN              (N9)           /* D
**1 REDEFINE #SSN
*  2 #SSN-3          (A3)
*  2 #SSN-2          (A2)
*  2 #SSN-4          (A4)
1 #DATE-OF-DEATH    (N8)
1 #MARRIAGE-CERT-CODE(A1)
1 #MMDDYYYY   (A8)
1 REDEFINE #MMDDYYYY
  2 #MM-C     (A2)
  2 #DD-C     (A2)
  2 #YYYY-C   (A4)
  2 REDEFINE #YYYY-C
    3 #YYYY-N (N4)
1 #YYYYMMDD   (N8)
1 REDEFINE #YYYYMMDD
  2 #YYYY   (N4)
  2 #MM     (N2)
  2 #DD     (N2)
1 REDEFINE #YYYYMMDD
  2 #YYYY-A (A4)
  2 #MM-A   (A2)
  2 #DD-A   (A2)
1 REDEFINE #YYYYMMDD
  2 #YYYYMMDD-A (A8)
1 #YYYYMMDD-2  (N8)
1 REDEFINE #YYYYMMDD-2
  2 #YYYYMMDD-2-A (A8)
1 #Title       (A46)
1 #xx          (A1)
1 #mod#        (C)
1 #CONTROL-VARS (C/12) 1 REDEFINE #CONTROL-VARS
  2 #CNT-CV      (C)
  2 #ROLE-MOD#   (C)
  2 #BCC-MOD#    (C)
  2 #DATE-CV     (C)
  2 #DOB-CV      (C)
  2 #DOD-CV      (C)
  2 #DOM-CV      (C)
  2 #ORG-CV      (C)
  2 #WEBSITE-CV  (C)
  2 #ENTER-PF3-TEXT-2-CV(C)
  2 #CONT-TYPE-CV(C)
1 #CV-ROLE       (C)
1 #CN          (N6)
1 #CID         (N8)
1 #NEW-CID     (N8)
1 #CID-PARM    (N8)
1 #BCC-TEXT    (A18)
1 #CN-TEXT     (A12)       /* NG4
1 #CONTACT-TEXT(A3)
1 #PRESS-PF3-TEXT(A34)
1 #ENTER-PF3-TEXT(A34)
1 #ENTER-PF3-TEXT-2(A35)
1 #ACTION-TEXT (A72)
1 #PF-TEXT     (A72)
1 #DOM-TEXT    (A18)
1 #DIV-TEXT    (A18)
1 #DOM-CD-TEXT (A5)
1 #DT-FORMAT-TEXT(A10)
1 #RL-TEXT     (A18)
1 #ORG-TEXT    (A18)
1 #WEBSITE-TEXT(A18)
1 #I           (N3)
1 #DOB         (A8)
1 REDEFINE #DOB
  2 #DOB-N     (N8)
1 REDEFINE #DOB
  2 #MM-B      (A2)
  2 #DD-B      (A2)
  2 #YYYY-B    (A4)
1 #DOD         (A8)
1 REDEFINE #DOD
  2 #DOD-N     (N8)
1 REDEFINE #DOD
  2 #MM-D      (A2)
  2 #DD-D      (A2)
  2 #YYYY-D    (A4)
1 #DOM         (A8)
1 REDEFINE #DOM
  2 #DOM-N     (N8)
1 REDEFINE #DOM
  2 #MM-M      (A2)
  2 #DD-M      (A2)
  2 #YYYY-M    (A4)
1 #DIV         (A8)
1 REDEFINE #DIV
  2 #DIV-N     (N8)
1 REDEFINE #DIV
  2 #MM-V      (A2)
  2 #DD-V      (A2)
  2 #YYYY-V    (A4)
1 #EST-DATE    (A8)   /* RE37 START
1 REDEFINE #EST-DATE
  2 #MM-E      (A2)
  2 #DD-E      (A2)
  2 #YYYY-E    (A4)   /* RE37 END
1 REDEFINE #EST-DATE
  2 #EST-DATE-N(N8)
1 #SPD         (A8)
1 REDEFINE #SPD
  2 #SPD-N     (N8)
1 #DOB-2       (N8)
1 #DOM-2       (N8)
1 #DIV-2       (N8)
1 #DOD-2       (N8)
1 #UPD-ON-TEXT (A10)
1 #UPD-BY-TEXT (A2)
1 #LST-UPD     (A10)
1 #LST-USR     (A22)
1 #AGE (N8)
1 REDEFINE #AGE
  2 #AGE-2 (N4)
  2 #FILL (N4)
1 #CONFIRM-DELETE (A1)
1 #CONFIRM-LN (A1)
1 #MEMBER-NAME  (A68)          /* RE42  Before A35   RE55 Before A50
1 REDEFINE #MEMBER-NAME        /* RE50
  2 #MEMBER-NAME-25(A25)       /* RE50
1 REDEFINE #MEMBER-NAME        /* RE50
  2 #MEMBER-NAME-33(A33)       /* RE55
  2 #SPOUSE-NAME (A35)         /* RE55
1 #MEMBER-ORG-NAME(A65)
1 #DEL-NAME      (A39)
1 #DEL-SSN       (N9)
1 #DEFAULT-LN   (A25)
1 #ORIG-ROLE-2-CD    (A1)
1 #SAVE-ROLE-2-CD    (A1)  /* RE38
1 #SCR-ROLE-2-CD(A1)
1 #ROLE-DESC    (A40)
1 #MEMBER       (L)
1 #WITH-SPOUSE-ALREADY(L)
1 #MEMBER-ORG   (L)  /* RE37
1 #INDIVIDUAL   (L)  /* RE37
1 #ORGANIZATION (L)  /* RE37
1 #BYPASS       (L)
1 #NOT-FOUND    (L)
1 #DUP-SSN      (L)
1 #MODIFIED     (L)
1 #CONF-SEL     (L)
1 #PF3          (L)
1 #DONT-DELETE  (L)
1 #FIRST-TIME   (L) INIT <TRUE>
1 #RELATED-TO-OTHER-CNS (L)
1 #X-DELETED    (L)
1 #PROTECT-FIELDS(L)
1 #SAME-CID     (L)
1 #BCC-MODIFY   (L)
1 #MCC-MODIFY   (L)
1 #FIRST-FORMER-SPOUSE(L)
1 #CONT-ISN     (P8)
1 #CNT-U-ISN    (P8)
1 #ST-ISN       (P8)
1 #HOLD-ST-ISN  (P8)
1 #FIRS-ISN     (P8)
1 #HOLD-FIRS-ISN(P8)
1 #HOLD-TIME    (P7)
1 #ITR1         (I2)
1 #ITR2         (I2)
1 #WIDOW-FLAG   (A1)                 /* RE7
1 #FUNC-SEL     (A1)
1 #BD-LINKS     (N6/100)
1 #BD-LINKS-A   (A6)
1 #SRCH-TYPE    (A3)
1 #SRCH         (L)
1 v_A25         (A25)
1 #FUNCTION     (A1)  /* N - Notes, A - Address RE14
1 #SRT-PARM
  2 #SRT-NUM-ENTRIES  (I2) INIT <60>
  2 #SRT-ENTRY-LENGTH (I2) INIT <58>
  2 #SRT-KEY-LENGTH   (I2) INIT <8>
  2 #SRT-KEY-POSITION (I2) INIT <26>  /* DOB ONLY
  2 #SRT-SORT-TYPE    (A1) INIT <'A'>
*
1 l_Trust       (L)    INIT <FALSE>
1 #EXIT-KEY     (A4/3) INIT <'PF3','PF7','PF8'>      /* NG1
1 #UNKNOWN-REL  (A1/5) INIT <'G','S','D','K','X'>  /* NG2
1 #MSG-ISN      (A8)   /* RE27
1 REDEFINE #MSG-ISN
  2 #MSG-ISN-N  (N8)
1 #PREFIX-TITLE-PARM (A25)             /* RE26 START
1 REDEFINE #PREFIX-TITLE-PARM
  2 #PREFIX-TITLE(A10)
1 #PREFIX-TITLE-DESC(A40)
1 #PREFIX-TITLE-TEXT(A7)
1 #PRF-CV       (C)
1 #GENDER-DESC  (A6)
1 #SECURED      (A1) INIT <'Y'>
1 #SECURED-2    (A1)
* #CONTACT-TYPE (A1)
1 #CONTACT-TYPE-DESC (A20)            /* RE26 END
1 #PROT-DESC    (A3)                  /* RE35
1 #BCC-DESC     (A20)                 /* RE35
1 #DCC-DESC     (A20)                 /* RE35
1 #MCC-DESC     (A20)                 /* RE35
1 #FCC-DESC     (A20)                 /* RE35
1 #SAVE-CONTACT-TYPE(A1)              /* RE35
1 #NAME-CHANGE-DESC(A20)              /* RE35
1 #NAME-CHANGE-CODE(A1)               /* RE35
1 #SYNCHRONIZE  (L)                   /* RE37
1 #REQUEST      (A) DYNAMIC           /* RE37
1 #RESPONSE-DSPL(A16)                 /* RE37
1 #ROLE-LABEL         (A14)  INIT <'Role/Relation:'>
1 #MSG-2        (A72)   /* RE38
1 #CG-ADD       (L)     /* RE40
1 #NOT-CB       (L)     /* RE55
1 #LAST-UPD-DATE (N8)
1 #SAVE-MCC     (A1)    /* RE41
1 #ADMIN-SCREEN (A) DYNAMIC /* RE42
1 #HOLD-DOM     (N8)    /* RE45 START
1 #HOLD-FS-DOM  (N8)
1 #HOLD-DIV     (N8)
1 #HOLD-FS-DIV  (N8)
1 #HOLD-STAT-CODE(A1)
1 #HOLD-FS-STAT-CODE(A1)
1 #HOLD-MCC     (A1)
1 #HOLD-FS-MCC  (A1)     /* RE45 END
1 #ADD-EXISTING-ORG(L)      /* RE43
1 #REPLACE-CONTACT(L)    /* RE47
1 #DONT-ADD     (L)      /* RE48
1 #SAVE-CONT-TYPE(A1)    /* RE55
1 #CHANGED-ORG-TO-IND(L) /* RE55
* --------- NG4 added NM CON functionality ----------------
1 #CREATE-CN-CV   (C)
1 #CREATE-CN      (A1)
1 #RESPONSE       (A1)   /* RE57
1 #PARM-MESSAGE   (A100) /* RE57
1 REDEFINE #PARM-MESSAGE
  2 #CHANGE-REASON(A47)  /* RE57
1 #CN-NO          (N2)   /* RE57
1 #PARM-CN        (N6)   /* RE57
1 #PARM-NAME      (A25)  /* RE57
1 #PARM-ROLE-CD   (A1)   /* RE57
1 #PARM-CONTACT-TYPE(A) DYNAMIC /* RE57
1 #HOLD-ROLE-2-CD   (A1)   /* RE57
1 #REPLACED-CID   (N8)   /* RE58
1 #STATUS-CODE    (A1)
*
1 #non-ins           (l)                 /* vt2
1 #num-mbships       (n2)                 /* vt2
END-DEFINE
*
DEFINE WINDOW Confirm-Delete
  SIZE 10 * 60
  BASE TOP LEFT
  FRAMED ON POSITION SYMBOL AUTO
*
DEFINE WINDOW Last-Name
  SIZE 10 * 49
  BASE 9/5
  FRAMED ON POSITION SYMBOL AUTO
*
DEFINE WINDOW Name-Change-Reason
  SIZE 15 * 40
  BASE 9/19
  FRAMED ON POSITION SYMBOL AUTO
*
EXPAND ARRAY #ERROR-CODE    TO (*:10)
EXPAND ARRAY #VALIDATE-FLAG TO (*:26)
*
IF FUNCTION-AUTHORIZED(<*INIT-USER>)                  /* RE55 START
  MOVE (AD=DU) TO #CONT-TYPE-CV
ELSE
  MOVE (AD=P) TO #CONT-TYPE-CV
END-IF                                                /* RE55 END
*
MOVE #CO-ID-2 TO #CID
MOVE #CO-ID-2 TO #REPLACED-CID                        /* RE58
*
IF #MSG = MASK(.NNNNNNNN)
  MOVE SUBSTR(#MSG,2,8) TO #MSG-ISN     /* RE27
END-IF
*
PERFORM POPULATE-SCREEN               /* RE35
*
**IF #SCR-ROLE-2-CD = 'W'
*  PERFORM PROCESS-FUNERAL
*  ESCAPE ROUTINE
**END-IF
*
REPEAT
  MOVE (AD=NP) TO #ORG-CV #WEBSITE-CV  /* RE35
  RESET #ORG-TEXT #WEBSITE-TEXT        /* RE35
    #LAST-UPD-DATE                     /* NG3
  IF #CO-ID-2 > 0 OR #CONF-SEL
    IF #LST-UPD > ' '
      MOVE 'Updated on' TO #UPD-ON-TEXT
      MOVE 'by' TO #UPD-BY-TEXT
      MOVE 'CI:' TO #CONTACT-TEXT
    END-IF
  END-IF
*
  PERFORM MOVE-DESCRIPTION
  PERFORM SAVE-VALUES-FOR-TR
*
  MOVE '!SCREEN' TO #ADMIN-SCREEN                 /* RE55  /* bz-Name-C
  CALLNAT 'GPRS0CNT' #CO-ID-1 #ADMIN-SCREEN      /* RE55
  MOVE #ADMIN-SCREEN TO #MEMBER-NAME             /* RE55
*
  IF (CNT.CONTACT-TYPE = 'O'
      OR #ORGANIZATION) AND NOT #CHANGED-ORG-TO-IND     /* RE55
    RESET #CHANGED-ORG-TO-IND                           /* RE55
*    #MEMBER-ORG-NAME := CNT.FIRM-ORGANIZATION-NAME     /* bz4    RE55
    INPUT WITH TEXT #MSG USING MAP 'GUPCIM02'           /* RE35
  ELSE
    IF NOT (#SCR-ROLE-2-CD = 'M' OR = 'S' OR = 'X' OR = 'K' OR = 'D' OR = 'G' OR = 'Y')   /* RE55
      IF #MODE NE 'V'
        MOVE (AD=DU) TO #ORG-CV #WEBSITE-CV
        MOVE 'Organiz. Name:' TO #ORG-TEXT
        MOVE 'Web Site     :'      TO #WEBSITE-TEXT
      END-IF
    END-IF
    IF (#SCR-ROLE-2-CD = 'S' OR = 'X' OR = ' ')    /* bz4
      IF #MODE NE 'V'                               /* RE55
        MOVE (AD=DU) TO #DATE-CV  #DOM-CV           /* bz4
        #DOM-TEXT := 'Marriage Date:'               /* bz4
        #DIV-TEXT := 'Divorce Date :'               /* bz4
        #DT-FORMAT-TEXT :=  '(MMDDYYYY)'            /* bz4
        #DOM-CD-TEXT    := 'Code:'
      END-IF                                        /* RE55
    ELSE                                           /* bz4
      MOVE (AD=NP) TO #DATE-CV  #DOM-CV            /* bz4
      #DOM-TEXT := ' '                            /* bz4
      #DIV-TEXT := ' '                            /* bz4
      #DT-FORMAT-TEXT :=  ' '                     /* bz4
      #DOM-CD-TEXT    := ' '
      #MCC-DESC       := ' '
    END-IF                                         /* bz4
*   #MEMBER-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
*    #MEMBER-NAME := FUNCTION-CONTACT-NAME(< #CO-ID-1 >) /* NG4  RE42
*    COMPRESS RANK-IN-SAS #MEMBER-NAME TO #MEMBER-NAME           RE42
*    MOVE 'SCREEN' TO #ADMIN-SCREEN                 /* RE42
*    CALLNAT 'GPRS0CNT' #CO-ID-1 #ADMIN-SCREEN      /* RE42
*    MOVE #ADMIN-SCREEN TO #MEMBER-NAME             /* RE42
    IF #SCR-ROLE-2-CD = 'Y'                                         /* RE55 START
      MOVE '!SCREEN' TO #ADMIN-SCREEN                               /* bz-Name-C 
      CALLNAT 'GPRS0CNT' STATUS.SPOUSE-CONTACT-ID #ADMIN-SCREEN
      COMPRESS '<Spouse>' #ADMIN-SCREEN TO #SPOUSE-NAME
    END-IF                                                          /* RE55 END
    INPUT WITH TEXT #MSG USING MAP 'GUPCIM01'           /* RE35
  END-IF
*
  IF *PF-KEY = #EXIT-KEY (*)
    #MODE := "N"              /* bz1
*    SET WINDOW OFF
    ESCAPE BOTTOM                /* RE38
*      ESCAPE ROUTINE            /* RE38
  END-IF
*
  IF #CO-ID-2 = 0 AND CNT.CONTACT-TYPE NE #SAVE-CONTACT-TYPE AND *PF-KEY = 'ENTR' /* RE35
    ESCAPE TOP  /* RE35
  END-IF        /* RE35
*
  IF #CONF-SEL AND #ORGANIZATION AND CNT.FIRM-ORGANIZATION-NAME = ' '  /* RE43
    REINPUT 'Organization name is required'                            /* RE43
      MARK *CNT.FIRM-ORGANIZATION-NAME                                 /* RE43
  END-IF                                                               /* RE43
*
*  IF #MOD# NOT MODIFIED AND #CONF-SEL
*    REINPUT 'No changes made. Press PF3 to exit'
*  END-IF
*
  IF #MODE NE 'V' AND #SCR-ROLE-2-CD = ' ' AND *PF-KEY = 'ENTR'
    MOVE 'Enter Role/Relationship' TO #MSG
    ESCAPE TOP
  ELSE
    IF #FUNCTION = 'X' AND *PF-KEY = #EXIT-KEY (*)
*      MOVE 'FUNC' TO #MSG
      SET WINDOW OFF
      ESCAPE BOTTOM                /* RE38
*      ESCAPE ROUTINE              /* RE38
    END-IF
*    IF #MSG = SCAN('added')                     /* RE53 START
*      MOVE 'X' TO #FUNCTION
*      REINPUT 'Press PF3 to exit.'
*    END-IF                                      /* RE53 END
    IF #MSG = SCAN('updated')
        OR = SCAN('added')                         /* RE53
      RESET #MODIFIED
    END-IF
    RESET #MSG
  END-IF
*
  IF *PF-KEY = 'PF4'                    /* RE14 Start
    IF #CO-ID-2 = 0
      CALLNAT 'ADRNS001' #CGA-ORIG-ID #CO-ID-1 #SCR-ROLE-2-CD #CID-PARM CNT.SSN CNT.FIRST-NAME CNT.MIDDLE-NAME CNT.LAST-NAME CNT.SUFFIX
        CNT.FIRM-ORGANIZATION-NAME CNT.GENDER-CD #DOB CNT.BIRTH-CERT-CODE #DOD CNT.DEATH-CERT-CODE #DOM #DIV CNT.ID-NUMBER #LST-UPD
        #LST-USR #NOT-FOUND #PF3 #SRCH-TYPE  /* RE24
      IF #NOT-FOUND OR #PF3
        RESET #NOT-FOUND
        IGNORE
      ELSE
*        MOVE TRUE TO #DUP-SSN #CONF-SEL  /* RE46
        MOVE TRUE TO #CONF-SEL            /* RE46
        IF #PF3
          RESET #SSN-A                    /* RE47    #PF3
        ELSE
          MOVE #CID-PARM TO #CID
          FIND CNT-U WITH CONTACT-ID = #CID
            IF CNT-U.PREFIX-TITLE NE ' '            /* NG3
*              CNT-U.PREFIX-TITLE := F-DEFAULT-PREFIX (<CNT-U.CONTACT-ID>)  /* RE34
              MOVE CNT-U.PREFIX-TITLE TO #PREFIX-TITLE
              #PREFIX-TITLE-DESC := FUNCTION-PREFIX-DESC(<#PREFIX-TITLE-PARM>)
            END-IF
*            IF CNT.CONTACT-TYPE = ' '                              /* RE47  RE57 START
            IF CNT-U.CONTACT-TYPE =  ' '
              IF CNT-U.FIRM-ORGANIZATION-NAME NE ' '
                MOVE 'O' TO CNT.CONTACT-TYPE
              ELSE
                MOVE 'I' TO CNT.CONTACT-TYPE
              END-IF
            ELSE                                                          /* RE57 END
              MOVE CNT-U.CONTACT-TYPE TO CNT.CONTACT-TYPE
            END-IF
*            END-IF                                                          RE57
            #CONTACT-TYPE-DESC := FUNCTION-CONT-TYPE-DESC(<CNT.CONTACT-TYPE>)
            MOVE CNT-U.FIRM-ORGANIZATION-NAME TO CNT.FIRM-ORGANIZATION-NAME
            MOVE CNT-U.WEBSITE-URL TO CNT.WEBSITE-URL
            MOVE CNT-U.CONTACT-REMARKS(*) TO CNT.CONTACT-REMARKS(*)
            IF CNT.CONTACT-TYPE = 'O'                                 /* RE57 START
              FIND CNT-REL WITH CONTACT-2-ID = CNT-U.CONTACT-ID
                MOVE ROLE-2-CD TO #SCR-ROLE-2-CD
                ESCAPE BOTTOM
              END-FIND
            END-IF                                                    /* RE57 END
          END-FIND
        END-IF
        IF CNT.ID-NUMBER > 0 AND NOT #PF3
          IF #SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D'
            RESET #DT-FORMAT-TEXT #DOM-TEXT #DIV-TEXT #DOM-CD-TEXT
            MOVE (AD=P) TO #DATE-CV #DOM-CV
          END-IF
          MOVE CNT.ID-NUMBER TO #CN
*          MOVE 'CN' TO #CN-TEXT     NG4
*          MOVE (AD=P) TO #CNT-CV #DOB-CV #DOD-CV #ORG-CV #WEBSITE-CV   /* RE40
*          IF #CGA-USER-COMPANY = 'I' AND NOT #BCC-MODIFY      /* RE6   RE40
*            MOVE (AD=P) TO #BCC-MOD#
*          END-IF
        END-IF
        IF #SCR-ROLE-2-CD = ' '
          MOVE 'Enter Role/Relationship' TO #MSG
        END-IF
      END-IF
      IF CNT.SSN = 0
        RESET #SSN-A
      END-IF
      IF #PF3          /* RE47
        RESET #PF3     /* RE47
      ELSE
        MOVE 'Press Enter to confirm this selection.' TO #MSG  /* RE46
      END-IF
      SET KEY PF11=OFF                                       /* RE46
      ESCAPE TOP
    ELSE
      FETCH RETURN 'ADRP0001' CNT.ID-NUMBER #CGA-ORIG-ID #CID #CGA-CLERK  /* RE23
      MOVE 'X' TO #FUNCTION
*      MOVE 'X' TO #MSG                  /* NG3              /* RE55
      ESCAPE TOP
    END-IF
  END-IF                                /* RE14 End
*
  IF *PF-KEY = 'PF12'                    /* RE14 Start
    CALLNAT 'GPF12SXX' #CID
    ESCAPE TOP
  END-IF                                /* RE14 End
*
  IF #MODE = 'U'
    IF *PF-KEY = 'PF11'                  /* RE1
      IF STATUS.APPL-SOURCE = 'AER' AND #SCR-ROLE-2-CD = 'S'     /* RE10   RE17
        REINPUT 'The widow of an AER member cannot be deleted.'
      END-IF
      FIND NUMBER CNT WITH DEATH-NOTIFIED-BY-CONTACT-ID = #CO-ID-2
      IF *NUMBER(0820) > 0
        REINPUT 'Cannot delete a DN NOTIFIED-BY contact'
          MARK 1
      ELSE
        FIND NUMBER STATUS WITH NOK-CONTACT-ID = #CO-ID-2
        IF *NUMBER(0825) > 0
          REINPUT 'Cannot delete a DN NOK contact'
            MARK 1
        END-IF
      END-IF
      IF #CO-ID-2 > 0
        PERFORM DELETE-RECORD
        IF NOT *PF-KEY = #EXIT-KEY (*)
          PERFORM WRITE-TRANS-REG
          PERFORM DELETE-STATUS-FIRS
          END TRANSACTION
          ESCAPE BOTTOM
        END-IF
      END-IF
    ELSE
*   print '=' #BYPASS '='#MODIFIED '='#OLD-SSN '='CNT.SSN  '='#SCR-ROLE-2-CD '='#ORIG-ROLE-2-CD '='#conf-sel '='#dup-ssn
      IF NOT #CONF-SEL AND                                      /* RE46
          ((#MOD# NOT MODIFIED AND NOT #BYPASS AND NOT #MODIFIED
*          AND #CO-ID-2 =  #CID-PARM AND #PRF-CV NOT MODIFIED       /* RE26
          AND #PRF-CV NOT MODIFIED
          AND #OLD-SSN = CNT.SSN) OR        /* RE40
          (#MOD# NOT MODIFIED AND #SCR-ROLE-2-CD = 'X' AND #ORIG-ROLE-2-CD = 'X'
*          AND #CO-ID-2 =  #CID-PARM AND #PRF-CV NOT MODIFIED       /* RE26
          AND #PRF-CV NOT MODIFIED       /* RE26
          AND #OLD-SSN = CNT.SSN))         /* RE40
        REINPUT "No changes made. Press PF3 to exit."
      ELSE
        MOVE TRUE TO #MODIFIED
        PERFORM VALIDATE-FIELDS
        IF #CONFIRM-LN = 'N' OR = 'Y'
          RESET #CONFIRM-LN
          ESCAPE TOP
        END-IF
        IF #DUP-SSN
          RESET #DUP-SSN
          IF #PF3
            RESET #PF3
          ELSE
*            #ROLE-DESC := FUNCTION-DISP-RL-DESC(<ROLE-2-CD>)          /* RE40
            IF CNT-REL.ROLE-2-CD = 'Y'                           /* RE55
              MOVE 'Spouse FMR-SPS' TO #ROLE-DESC                /* RE55
            ELSE
              #ROLE-DESC := FUNCTION-CODE-1-DESC(<'041',CNT-REL.ROLE-2-CD>)      /* RE40
            END-IF
            MOVE 'Press Enter to confirm this selection.' TO #MSG
            SET KEY PF11=OFF                        /* RE1
            MOVE TRUE TO #CONF-SEL
          END-IF
          ESCAPE TOP
        END-IF
*        DISPLAY #MEMBER #CGA-ORIG-COMMAND #CG-ADD
        IF #CG-ADD OR #NOT-CB                      /* RE40  RE55
          IGNORE                                   /* RE40
        ELSE
          IF (NOT #MEMBER OR
              #CGA-ORIG-COMMAND = 'CB' OR = 'CG')    /* RE40
            PERFORM WRITE-TRANS-REG
          END-IF
        END-IF
        PERFORM UPDATE-OR-ADD-CONTACT
* ------------------- NG4 --------------------------
        IF #CREATE-CN-CV MODIFIED
          CALLNAT 'C2001NNM' #CO-ID-2 #CN #MSG
        END-IF
* ------------------- NG4 --------------------------
        IF #CG-ADD OR #NOT-CB                      /* RE40 RE55
          IGNORE                                   /* RE40
        ELSE
          IF (NOT (#MEMBER OR #MEMBER-ORG)
              OR #CGA-ORIG-COMMAND = 'CB' OR = 'CG')  /* RE40
            END TRANSACTION
          END-IF
        END-IF
      END-IF
    END-IF
  END-IF
  IF #MEMBER
      AND #CG-ADD                            /* RE40
      OR (#NOT-CB AND NOT (#ORGANIZATION OR #MEMBER-ORG))          /* RE55
    IF CNT.FIRST-NAME NE #SAVE-FIRST-NAME OR
        CNT.MIDDLE-NAME NE #SAVE-MIDDLE-NAME OR
        CNT.LAST-NAME NE #SAVE-LAST-NAME OR
        CNT.SUFFIX NE #SAVE-SUFFIX
      CALLNAT 'GONMN001' #NAME-CHANGE-CODE #NAME-CHANGE-DESC   /* RE35
*      MOVE 'NAME CHANGE' TO #MSG                              /* RE35
*      MOVE #NAME-CHANGE-DESC TO #MSG                           /* RE35
*      SET WINDOW OFF                                           /* RE35
*      ESCAPE ROUTINE                                           /* RE35
    END-IF
  END-IF
  SET WINDOW OFF
  MOVE CNT.FIRST-NAME  TO #SAVE-FIRST-NAME  /* RE38
  MOVE CNT.LAST-NAME   TO #SAVE-LAST-NAME   /* RE38
  MOVE CNT.MIDDLE-NAME TO #SAVE-MIDDLE-NAME /* RE38
  MOVE CNT.SUFFIX      TO #SAVE-SUFFIX      /* RE38
  IF #LAST-UPD-DATE NE 0                    /* NG3
    MOVE #LAST-UPD-DATE TO #YYYYMMDD
    COMPRESS #MM-A '-' #DD-A '-' #YYYY-A INTO #LST-UPD LEAVING NO
  END-IF
*
END-REPEAT
*
PERFORM SYNCHRONIZE
IF (#NAME-CHANGE-DESC NE ' ' AND (#MEMBER OR #MEMBER-ORG)    /* RE35
    AND #CGA-ORIG-COMMAND NE 'CB')                           /* RE40
    OR (#NAME-CHANGE-DESC NE ' ' AND #NOT-CB)                /* RE55
  MOVE #NAME-CHANGE-DESC TO #MSG     /* RE35
ELSE                                 /* RE35
  IF #SYNCHRONIZE            /* RE38 START
    IF #CONFIRM-DELETE = 'Y'
      IGNORE
    ELSE
      MOVE 'X' TO #MSG
    END-IF
  END-IF
END-IF                       /* RE38 END
*********************************
DEFINE SUBROUTINE POPULATE-SCREEN        /* RE35
*********************************
**MOVE (AD=U) TO #CONTROL-VARS (*)
**CALLNAT 'ADRN0004' #CO-ID-1 #HEADER1 #HEADER2
*
IF #MSG = 'CG ADD'
  MOVE TRUE TO #CG-ADD
  RESET #MSG
END-IF
*
IF #MSG = 'NOT CB'            /* RE55 Comes from a command other than CB
  MOVE TRUE TO #NOT-CB
  RESET #MSG
END-IF
*
FIND CNT WITH CONTACT-ID = #CO-ID-1          /* Get Last Name of Member; format member name
  MOVE CNT.LAST-NAME TO #DEFAULT-LN
*  IF CONTACT-TYPE = 'O'
*    #MEMBER-ORG-NAME := FIRM-ORGANIZATION-NAME
*  ELSE
*  #MEMBER-NAME := FUNCTION-CONTACT-NAME(< #CO-ID-1 >)   /* NG4  RE42
*    #MEMBER-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,#DEFAULT-LN,CNT.SUFFIX>) /* RE35 START
*  FIND RANK-V WITH RANK-ID = CNT.RANK-ID
*    COMPRESS RANK-IN-SAS #MEMBER-NAME TO #MEMBER-NAME
*  END-FIND                                                                                       /* RE35 END
  MOVE '!SCREEN' TO #ADMIN-SCREEN                 /* RE42     /* bz-Name-C
  CALLNAT 'GPRS0CNT' #CO-ID-1 #ADMIN-SCREEN      /* RE42
  MOVE #ADMIN-SCREEN TO #MEMBER-NAME             /* RE42
*  END-IF
END-FIND
*
FIND CNT WITH CONTACT-ID = #CO-ID-2                  /* Get Contact Record of Spouse/Fmr Spouse/Dependent/Other
  MOVE CNT.CONTACT-TYPE TO #SAVE-CONT-TYPE            /* RE55
  MOVE *ISN TO #CONT-ISN
END-FIND
*
IF CNT.ID-NUMBER NE 0                         /* ONLY FOR EXISTING SPOUSE/DEPENDENTS/OTHERS
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID   /* RE11 Saves STATUS ISN of Member in case spouse/depn/other is deleted
    IF PROCESS-IND = 'C' AND INTRO-FLAG <> 'A' l_Trust := TRUE END-IF    /*  bz2
    MOVE *ISN TO #HOLD-ST-ISN
    PERFORM SAVE-MEMBER-MARR-DIV-DATES        /* RE45
  END-FIND
  FIND STATUS WITH ID-NUMBER = CNT.ID-NUMBER
    MOVE *ISN TO #ST-ISN
  END-FIND
  FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID     /* RE11 Saves FIRS ISN of Member in case spouse/depn/other is deleted
    MOVE *ISN TO #HOLD-FIRS-ISN
  END-FIND
  FIND FIRS WITH ID-NUMBER = CNT.ID-NUMBER
    MOVE *ISN TO #FIRS-ISN
  END-FIND
ELSE
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
    IF PROCESS-IND = 'C' AND INTRO-FLAG <> 'A' l_Trust := TRUE END-IF    /*  bz2
    MOVE *ISN TO #ST-ISN
    PERFORM SAVE-MEMBER-MARR-DIV-DATES        /* RE45
  END-FIND
  FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID
    IF NO RECORD FOUND                        /* RE5
      MOVE #CGA-ORIG-ID TO FIRS.ID-NUMBER
      MOVE STATUS.MEMBER-CONTACT-ID  TO FIRS.CONTACT-ID-NUMBER
      MOVE STATUS.MEMBER-FLAG TO FIRS.MEMBER-FLAG
      MOVE STATUS.WIDOW-FLAG TO FIRS.WIDOW-FLAG
      MOVE *DATN      TO FIRS.DP-LAST-FM-DATE
      MOVE *DATN      TO FIRS.DTS-DATN
      MOVE *TIMN      TO FIRS.DTS-TIMN
      STORE FIRS
      END TRANSACTION
      FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID
        MOVE *ISN TO #FIRS-ISN
      END-FIND
      ESCAPE BOTTOM
    END-NOREC
    MOVE *ISN TO #FIRS-ISN
  END-FIND
END-IF
MOVE STATUS.WIDOW-FLAG TO #WIDOW-FLAG        /* RE7
*
**FIND GEN-V WITH GEN-KEY = 'ROLE'             /* RE12 Start
*  ACCEPT IF GEN-NUMBER-VALUE = 2
*  ADD 1 TO #I
*  MOVE GEN-SUB-KEY TO #ROLE-CD-TABLE(#I)
**END-IF                                       /* RE12 End
*
IF #CO-ID-1 = #CO-ID-2                     /* MEMBER
  MOVE 'M' TO #SCR-ROLE-2-CD
  IF #MODE = 'O' OR CNT.CONTACT-TYPE = 'O'
    MOVE 'ORGANIZATION' TO #ROLE-DESC
    MOVE TRUE TO #MEMBER-ORG
  ELSE
    MOVE 'MEMBER' TO #ROLE-DESC
    MOVE TRUE TO #MEMBER
  END-IF
  IF #MODE NE 'V'
    MOVE 'U' TO #MODE
  END-IF
ELSE
  IF #MODE = 'C'
    MOVE TRUE TO #MEMBER
    MOVE 'U' TO #MODE
  ELSE
    IF #MODE = 'O'
      MOVE TRUE TO #MEMBER-ORG
      MOVE 'U' TO #MODE
    END-IF
  END-IF
  DECIDE ON FIRST VALUE OF #MSG
    VALUE 'S'
      MOVE 'SPOUSE' TO #ROLE-DESC
      MOVE 'S' TO #ORIG-ROLE-2-CD #SCR-ROLE-2-CD
      MOVE TRUE TO #SAME-CID
    VALUE 'X'
      MOVE 'FORMER SPOUSE' TO #ROLE-DESC
      MOVE 'X' TO #ORIG-ROLE-2-CD #SCR-ROLE-2-CD
      MOVE TRUE TO #SAME-CID
    VALUE 'F'
      MOVE TRUE TO #FIRST-FORMER-SPOUSE
    NONE
      IF #MSG-ISN-N > 0
        GET CNT-REL #MSG-ISN-N
        MOVE ROLE-2-CD TO #ORIG-ROLE-2-CD #SCR-ROLE-2-CD #SAVE-ROLE-2-CD
        IF ROLE-2-CD = 'X'
          MOVE 'FORMER SPOUSE' TO #ROLE-DESC
        ELSE
*          #ROLE-DESC := FUNCTION-DISP-RL-DESC(<ROLE-2-CD>)    /* RE40
          IF CNT-REL.ROLE-2-CD = 'Y'                           /* RE55
            MOVE 'Spouse FMR-SPS' TO #ROLE-DESC                /* RE55
          ELSE
            #ROLE-DESC := FUNCTION-CODE-1-DESC(<'041',CNT-REL.ROLE-2-CD>)      /* RE40
          END-IF
        END-IF
      ELSE
        FIND CNT-REL WITH CONTACT-2-ID = #CO-ID-2    /* SPOUSE/DEPENDENT/OTHER
          IF CONTACT-1-ID = #CO-ID-1
            MOVE ROLE-2-CD TO #ORIG-ROLE-2-CD #SCR-ROLE-2-CD #SAVE-ROLE-2-CD
*            IF ROLE-2-CD = 'X'                                             /* RE55 START
*              MOVE 'FORMER SPOUSE' TO #ROLE-DESC
*            ELSE
*              #ROLE-DESC := FUNCTION-DISP-RL-DESC(<ROLE-2-CD>)    /* RE40  /* RE55 END
            IF CNT-REL.ROLE-2-CD = 'Y'                           /* RE55
              MOVE 'Spouse FMR-SPS' TO #ROLE-DESC                /* RE55
            ELSE
              #ROLE-DESC := FUNCTION-CODE-1-DESC(<'041',CNT-REL.ROLE-2-CD>)      /* RE40
            END-IF
*            END-IF                                                         /* RE55
            ESCAPE BOTTOM
          END-IF
        END-FIND
      END-IF
      IF #CGA-ORIG-COMMAND = 'DN' AND #MSG = MASK(...'W')  /* RE52 START
        MOVE (AD=P) TO #ROLE-MOD#
        MOVE 'Y' TO #SECURED-2
        MOVE 'W' TO #ORIG-ROLE-2-CD #SCR-ROLE-2-CD
        MOVE 'O' TO CNT.CONTACT-TYPE
      END-IF                                               /* RE52 END
  END-DECIDE
  RESET #MSG
END-IF
*
PERFORM FIND-CONTACT-TYPE
* IF #ORGANIZATION     /* Executed from other than CB; should show Member name
*  #MEMBER-ORG-NAME := #MEMBER-NAME
*  COMPRESS '<Member>' #MEMBER-ORG-NAME INTO #MEMBER-ORG-NAME LEAVING NO
*  MOVE LEFT #MEMBER-ORG-NAME TO #MEMBER-ORG-NAME
* END-IF
*
IF CNT.SSN = 0
  RESET #SSN-A
END-IF
*
IF CNT.SSN-PROTECT = ' '                             /* RE22 START
  MOVE 'N' TO CNT.SSN-PROTECT
END-IF
*
IF CNT.SSN-PROTECT-DATE NE 0
  MOVE CNT.SSN-PROTECT-DATE TO #YYYYMMDD
  COMPRESS #MM-A #DD-A #YYYY-A INTO #SPD LEAVING NO
END-IF                                               /* RE22 END
*
IF CNT.LAST-DATE-UPD NE 0
  MOVE CNT.LAST-DATE-UPD TO #YYYYMMDD
  COMPRESS #MM-A '-' #DD-A '-' #YYYY-A INTO #LST-UPD LEAVING NO
END-IF
*
IF CNT.DATE-OF-BIRTH NE 0
  MOVE CNT.DATE-OF-BIRTH TO #YYYYMMDD
  COMPRESS #MM-A #DD-A #YYYY-A INTO #DOB LEAVING NO
END-IF
*
IF CNT.DATE-OF-DEATH NE 0
  MOVE CNT.DATE-OF-DEATH TO #YYYYMMDD
  COMPRESS #MM-A #DD-A #YYYY-A INTO #DOD LEAVING NO
END-IF
*
IF CNT.FIRM-ESTABLISHED-DATE NE 0
  MOVE CNT.FIRM-ESTABLISHED-DATE TO #YYYYMMDD
  COMPRESS #MM-A #DD-A #YYYY-A INTO #EST-DATE LEAVING NO
END-IF
*
IF #CO-ID-2 NE 0
  FIND (1) TERM WITH CLERK-ID = CNT.LAST-USER-UPD
    IF NO RECORD FOUND                                    /* RE31 START
      FIND (1) TERM WITH TERMINAL-ID = CNT.LAST-USER-UPD
        MOVE COMMENTS TO #LST-USR
      END-FIND
      ESCAPE BOTTOM
    END-NOREC                                             /* RE31 END
    MOVE COMMENTS TO #LST-USR
  END-FIND
END-IF
*
FORMAT IP=OFF
SET KEY PF3 PF4 PF11 PF12                   /* RE1  RE14 NG1
*
**IF #CGA-ORIG-COMMAND NE 'CB'      /* RE40
IF #MEMBER OR #MEMBER-ORG           /* RE40
  MOVE (AD=NP) TO #CV-ROLE
    #ROLE-MOD#
ELSE
  MOVE (AD=IP) TO #CV-ROLE
END-IF
*
#BCC-MODIFY := FUNCTION-BIRTH-CERT-CODE(<#CGA-CLERK>)     /* RE6
#MCC-MODIFY := FUNCTION-MARRIAGE-CERT-CODE(<#CGA-CLERK>)  /* RE6
**IF NOT (#MEMBER OR #MEMBER-ORG) AND (#CGA-USER-COMPANY = 'S' OR #BCC-MODIFY)                 /* RE6 RE38 RE23
MOVE (AD=U) TO #BCC-MOD#
**ELSE                        /* RE23
*  MOVE (AD=P) TO #BCC-MOD#   /* RE23
**END-IF                      /* RE23
*
IF CNT.ID-NUMBER NE 0
*  MOVE 'CN' TO #CN-TEXT    NG4
  MOVE CNT.ID-NUMBER TO #CN
END-IF
*
IF #CO-ID-2 = 0            /* NEW CONTACT
  MOVE '(MMDDYYYY)' TO #DT-FORMAT-TEXT
  MOVE 'Marriage Date:' TO #DOM-TEXT
  MOVE 'Code:' TO #DOM-CD-TEXT
  MOVE 'Divorce Date :' to #DIV-TEXT
  MOVE (AD=U) TO #DATE-CV
ELSE
  IF #ORIG-ROLE-2-CD = 'S' OR = 'X'
    MOVE '(MMDDYYYY)' TO #DT-FORMAT-TEXT
    MOVE 'Marriage Date:' TO #DOM-TEXT
    MOVE 'Code:' TO #DOM-CD-TEXT
*    IF #ORIG-ROLE-2-CD = 'S' AND STATUS.DATE-OF-MARRIAGE NE 0  /* RE45 START
*      MOVE STATUS.DATE-OF-MARRIAGE TO #YYYYMMDD
    IF #ORIG-ROLE-2-CD = 'S' AND #HOLD-DOM NE 0
      MOVE #HOLD-DOM TO #YYYYMMDD                               /* RE45 END
      COMPRESS #MM-A #DD-A #YYYY-A INTO #DOM LEAVING NO
      MOVE (AD=D) TO #DOM-CV
    END-IF
*    IF #ORIG-ROLE-2-CD = 'X' AND FORMER-SPOUSE-DATE-OF-MARRIAGE NE 0  /* RE45
*      MOVE FORMER-SPOUSE-DATE-OF-MARRIAGE TO #YYYYMMDD
    IF #ORIG-ROLE-2-CD = 'X' AND #HOLD-FS-DOM NE 0
      MOVE #HOLD-FS-DOM TO #YYYYMMDD                                   /* RE45
      COMPRESS #MM-A #DD-A #YYYY-A INTO #DOM LEAVING NO
    END-IF
*    IF #ORIG-ROLE-2-CD = 'X' AND #HOLD-ST-ISN > 0 AND STATUS.DATE-OF-MARRIAGE NE 0  /* RE20  RE45
*      MOVE STATUS.DATE-OF-MARRIAGE TO #YYYYMMDD                                  /* RE20
*      COMPRESS #MM-A #DD-A #YYYY-A INTO #DOM LEAVING NO                   /* RE20
*    END-IF                                                                /* RE20
    IF #ORIG-ROLE-2-CD = 'S'
      MOVE #HOLD-MCC TO #MARRIAGE-CERT-CODE                            /* RE45
*        OR (#ORIG-ROLE-2-CD = 'X' AND #HOLD-ST-ISN > 0)                        /* RE20
*      MOVE MARRIAGE-CERT-CODE TO #MARRIAGE-CERT-CODE                  /* RE45
    ELSE
*      MOVE FS-MARR-CERT-CD TO #MARRIAGE-CERT-CODE                     /* RE45
      MOVE #HOLD-FS-MCC TO #MARRIAGE-CERT-CODE                         /* RE45
    END-IF
    MOVE 'Divorce Date :' to #DIV-TEXT
    IF #ORIG-ROLE-2-CD = 'S'
*     IF STATUS.DATE-OF-DIVORCE NE 0 AND STATUS-CODE-SP NE 'D'         /* RE45
*        MOVE STATUS.DATE-OF-DIVORCE TO #YYYYMMDD                      /* RE45
      IF #HOLD-DIV NE 0 AND #HOLD-STAT-CODE NE 'D'                     /* RE45
        MOVE #HOLD-DIV TO #YYYYMMDD                                    /* RE45
        COMPRESS #MM-A #DD-A #YYYY-A INTO #DIV LEAVING NO
      END-IF
    ELSE
*      IF (FORMER-SPOUSE-DATE-OF-DIVORCE NE 0 AND FORMER-SPOUSE-STATUS NE 'D' AND #ORIG-ROLE-2-CD NE ' ') OR  /* RE45 START
*          (FORMER-SPOUSE-DATE-OF-DIVORCE NE 0 AND FORMER-SPOUSE-STATUS = 'D')
*        MOVE FORMER-SPOUSE-DATE-OF-DIVORCE TO #YYYYMMDD
      IF (#HOLD-FS-DIV NE 0 AND #HOLD-FS-STAT-CODE NE 'D' AND #ORIG-ROLE-2-CD NE ' ') OR
          (#HOLD-FS-DIV NE 0 AND #HOLD-FS-STAT-CODE = 'D')
*      IF NOT (#HOLD-FS-STAT-CODE = ' ' OR = 'D')                                                              /* RE55
        MOVE #HOLD-FS-DIV TO #YYYYMMDD                                                                        /* RE45 END
        COMPRESS #MM-A #DD-A #YYYY-A INTO #DIV LEAVING NO
      END-IF
    END-IF
    MOVE (AD=U) TO #DATE-CV
  ELSE
    RESET #DT-FORMAT-TEXT
    MOVE (AD=P) TO #DATE-CV
  END-IF
END-IF
*
MOVE #CO-ID-2 TO #CID-PARM
*
IF #MODE NE 'V'
  MOVE 'Press PF3 to exit without changes.' TO #PRESS-PF3-TEXT
  MOVE 'Press Enter to save, PF3 to cancel.' TO #ENTER-PF3-TEXT-2
  IF #CO-ID-2 = 0
    SET KEY ENTR NAMED 'Save'
    SET KEY PF3 NAMED 'Exit'
    SET KEY PF4 NAMED 'Cnt'
  ELSE
    SET KEY ENTR NAMED 'Save'
    SET KEY PF3 NAMED 'Exit'
    SET KEY PF4 NAMED 'Cnt'
    SET KEY PF11 NAMED 'Del'
    SET KEY PF12 NAMED 'Reln'
  END-IF
  MOVE (AD=U) TO #CNT-CV #DOB-CV #DOD-CV #PRF-CV
  IF #CGA-ORIG-COMMAND EQ 'CB'
    MOVE (AD=U) TO  #ROLE-MOD#
  END-IF
END-IF
*
move status.number-memberships to #num-mbships                  /* vt2 \/

if status.number-memberships = 0 and status.date-of-death ne 0
and not(status.process-ind = 'C' and intro-flag ne 'A')
  move 1 to #num-mbships
end-if

if cnt.id-number = 0
move 0 to #num-mbships
end-if
 
if #num-mbships gt 0
  move (AD=P) to  #dod-cv
end-if                                                          /* vt2 /\
MOVE CNT.FIRST-NAME TO #SAVE-FIRST-NAME
MOVE CNT.MIDDLE-NAME TO #SAVE-MIDDLE-NAME
MOVE CNT.LAST-NAME TO #SAVE-LAST-NAME
MOVE CNT.SUFFIX TO #SAVE-SUFFIX
MOVE CNT.SSN TO #SAVE-SSN
MOVE CNT.PREFIX-TITLE TO #PREFIX-TITLE-PARM /* RE26 START
* IF #PREFIX-TITLE-PARM = ' '                                 /* RE34
*  #PREFIX-TITLE-PARM := F-DEFAULT-PREFIX(<CNT.CONTACT-ID>)  /* RE34
* END-IF                                                      /* RE34
IF #DOM-TEXT = ' '  OR #MODE = 'V' OR (#CGA-USER-COMPANY = 'I' AND NOT #MCC-MODIFY)   /*    RE6
  MOVE (AD=P) TO #DOM-CV
ELSE
  MOVE (AD=U) TO #DOM-CV #DATE-CV
END-IF
*
#BD-LINKS (*) := FUNCTION-BD-LINKS(<#CO-ID-2>)(*)
IF #BD-LINKS(*) NE 0
  COMPRESS 'Beneficiary of CN' #BD-LINKS(1) TO #MSG
  FOR #I 2 5
    IF #BD-LINKS(#I) = 0
      ESCAPE BOTTOM
    END-IF
    MOVE #BD-LINKS(#I) TO #BD-LINKS-A
    IF #MSG = SCAN(#BD-LINKS-A)
      IGNORE
    ELSE
      COMPRESS #MSG #BD-LINKS(#I) TO #MSG
    END-IF
  END-FOR
  COMPRESS #MSG '.' TO #MSG LEAVING NO
END-IF
RESET #RELATED-TO-OTHER-CNS
COMPRESS 'Also related to CN' TO #MSG-2
FIND CNT-REL-S WITH CONTACT-2-ID = #CO-ID-2
  IF CONTACT-1-ID NE #CO-ID-1
    FIND CNT-S WITH CONTACT-ID = CONTACT-1-ID
      COMPRESS #MSG-2 CNT-S.ID-NUMBER INTO #MSG-2
      MOVE TRUE TO #RELATED-TO-OTHER-CNS
    END-FIND
  END-IF
END-FIND
IF #RELATED-TO-OTHER-CNS
  COMPRESS #MSG-2 '.' INTO #MSG-2 LEAVING NO
  COMPRESS #MSG #MSG-2 INTO #MSG
END-IF
*
IF #CN > 0 AND #CGA-ORIG-COMMAND = 'CB'                  /* RE4
                          
  if #num-mbships eq 0                                               /* vt2 \/
    move (ad=U) to #dod-cv
  else                                                               /* vt2 /\
*  MOVE (AD=P) TO #CNT-CV #DOB-CV #DOD-CV #ORG-CV #WEBSITE-CV   /* RE40 start
    MOVE (AD=P) TO #DOD-CV
  end-if                                                              /* vt2
*  IF #CGA-USER-COMPANY = 'I'
*    MOVE (AD=P) TO #BCC-MOD#
*  END-IF
*  MOVE 'Name/Gender/SSN/DOB can"t be updated on this screen.' TO #MSG  /* RE40 end
END-IF
*
IF #MEMBER OR #MEMBER-ORG  /* RE38
    OR #NOT-CB               /* RE55
  SET KEY ENTR NAMED 'Save'
  SET KEY PF3 NAMED 'Exit'
  SET KEY PF4 NAMED 'Cnt'
  SET KEY PF12 NAMED 'Reln'
  SET KEY PF11=OFF
 
  IF #MEMBER OR #MEMBER-ORG                /* RE38
 
    if #num-mbships =0                                            /* vt2 \/ 
      move (ad=U) to #dod-cv
    else                                                          /* vt2 /\
*    MOVE (AD=P) TO  #DOB-CV #BCC-MOD# #DOD-CV      /* RE40
      MOVE (AD=P) TO  #DOD-CV                         /* RE40   vt1
      MOVE (AD=NP) TO #ROLE-MOD#
    end-if                                                        /* vt2
  ELSE
    IF #NOT-CB                                      /* RE55
      MOVE (AD=P) TO #ROLE-MOD# #CONT-TYPE-CV       /* RE55
    END-IF                                          /* RE55
    MOVE (AD=U) TO #BCC-MOD#  /* RE38
  END-IF
END-IF
*
IF #MODE = 'V'
  MOVE (AD=P) TO #CNT-CV #ROLE-MOD# #BCC-MOD# #DATE-CV #DOM-CV #DOB-CV
    #ORG-CV #WEBSITE-CV #PRF-CV
    #DOD-CV                                                 
    #CONT-TYPE-CV                        /* RE55
*  IF #CGA-ORIG-COMMAND NE 'CB'          /* RE55
*    MOVE (AD=NP) TO #ROLE-MOD#          /* RE55
*  END-IF                                /* RE55
  SET KEY ENTR NAMED 'Exit'
  SET KEY PF3 NAMED 'Exit'
  SET KEY PF4 NAMED 'Cnt'
  SET KEY PF12 NAMED 'Reln'
END-IF
*
END-SUBROUTINE
********************************************
DEFINE SUBROUTINE SAVE-MEMBER-MARR-DIV-DATES /* RE45
********************************************
MOVE STATUS.DATE-OF-MARRIAGE TO #HOLD-DOM
MOVE STATUS.FORMER-SPOUSE-DATE-OF-MARRIAGE TO #HOLD-FS-DOM
MOVE STATUS.DATE-OF-DIVORCE TO #HOLD-DIV
MOVE STATUS.FORMER-SPOUSE-DATE-OF-DIVORCE TO #HOLD-FS-DIV
MOVE STATUS.STATUS-CODE-SP TO #HOLD-STAT-CODE
MOVE STATUS.FORMER-SPOUSE-STATUS TO #HOLD-FS-STAT-CODE
MOVE STATUS.MARRIAGE-CERT-CODE TO #HOLD-MCC
MOVE STATUS.FS-MARR-CERT-CD TO #HOLD-FS-MCC
*
END-SUBROUTINE
**********************************
DEFINE SUBROUTINE MOVE-DESCRIPTION /* RE37
**********************************
PERFORM FIND-CONTACT-TYPE
*
IF CNT.CONTACT-TYPE = ' '
  IF #INDIVIDUAL OR #CO-ID-2 = 0 OR #MEMBER
    MOVE 'I' TO CNT.CONTACT-TYPE
  ELSE
    MOVE 'O' TO CNT.CONTACT-TYPE
  END-IF
END-IF
*
#CONTACT-TYPE-DESC := FUNCTION-CONT-TYPE-DESC(<CNT.CONTACT-TYPE>)
MOVE CNT.CONTACT-TYPE TO #SAVE-CONTACT-TYPE
#PREFIX-TITLE-DESC := FUNCTION-PREFIX-DESC(<#PREFIX-TITLE-PARM>)
IF NOT #MEMBER-ORG
*  #ROLE-DESC := FUNCTION-DISP-RL-DESC(<ROLE-2-CD>)          /* RE40
  IF #SCR-ROLE-2-CD = 'Y'                           /* RE55
    MOVE 'Spouse FMR-SPS' TO #ROLE-DESC                /* RE55
  ELSE
    #ROLE-DESC := FUNCTION-CODE-1-DESC(<'041',#SCR-ROLE-2-CD>)      /* RE40
  END-IF
END-IF
*
DECIDE ON FIRST VALUE OF CNT.GENDER-CD /* bz4
  VALUE 'M' #GENDER-DESC := 'Male'       /* bz4
  VALUE 'F' #GENDER-DESC := 'Female'     /* bz4
  VALUE ' ' #GENDER-DESC := ' '          /* bz4
  NONE IGNORE                            /* bz4
END-DECIDE                             /* bz4
* IF CNT.GENDER-CD = 'M'               /* bz4
*   MOVE 'MALE' TO #GENDER-DESC        /* bz4
* ELSE                                 /* bz4
*   IF CNT.GENDER-CD = 'F'             /* bz4
*     MOVE 'FEMALE' TO #GENDER-DESC    /* bz4
*   END-IF                             /* bz4
* END-IF                               /* bz4
*
IF #CO-ID-2 = 0
  RESET #SAVE-SSN
ELSE
  MOVE CNT.SSN TO #SAVE-SSN
END-IF
*
#BCC-DESC := FUNCTION-CODE-A-DESC(<'033',CNT.BIRTH-CERT-CODE>)
#DCC-DESC := FUNCTION-CODE-A-DESC(<'033',CNT.DEATH-CERT-CODE>)
#MCC-DESC := FUNCTION-CODE-A-DESC(<'033',#MARRIAGE-CERT-CODE>)
#FCC-DESC := FUNCTION-CODE-A-DESC(<'033',CNT.FIRM-CERT-CODE>)
#PROT-DESC:= FUNCTION-CODE-1-DESC(<'028',CNT.SSN-PROTECT>)
*
IF #MODE = 'V'                                          /* RE38
  MOVE 'Press PF3 to exit.' TO #PRESS-PF3-TEXT          /* RE38
  SET KEY ENTR NAMED ' '                                /* RE38
END-IF                                                  /* RE38
* ---------------------- NG4 -------------------------
IF #CN > 0
  COMPRESS 'CN' #CN INTO #CN-TEXT
  MOVE (AD=NP) TO #CREATE-CN-CV
ELSE
  #CN-TEXT := 'Generate CN:'
  IF F-GENERATE-CN (< #CGA-CLERK >)
    MOVE (AD=U) TO #CREATE-CN-CV
  ELSE
    MOVE (AD=NP) TO #CREATE-CN-CV
  END-IF
END-IF
* ---------------------- NG4 -------------------------
END-SUBROUTINE
***********************************
DEFINE SUBROUTINE FIND-CONTACT-TYPE  /* RE38
***********************************
RESET #INDIVIDUAL #ORGANIZATION
IF #SCR-ROLE-2-CD NE ' ' AND NOT(#MEMBER OR #MEMBER-ORG)    /* Not called from CG ADD
  IF FUNCTION-CONTACT-TYPE(<#SCR-ROLE-2-CD>) = 'INDIVIDUAL'
    MOVE TRUE TO #INDIVIDUAL
  END-IF
  IF FUNCTION-CONTACT-TYPE(<#SCR-ROLE-2-CD>) = 'ORGANIZATION'
    MOVE TRUE TO #ORGANIZATION
  END-IF
END-IF
**display #SCR-ROLE-2-CD #MEMBER #MEMBER-ORG #INDIVIDUAL #ORGANIZATION
*
END-SUBROUTINE
************************************
DEFINE SUBROUTINE SAVE-VALUES-FOR-TR  /* RE38
************************************
MOVE #ORIG-ROLE-2-CD TO #OLD-ROLE
MOVE #PREFIX-TITLE   TO #OLD-PREFIX-TITLE
MOVE CNT.GENDER-CD   TO #OLD-GENDER-CD
MOVE CNT.LAST-NAME   TO #OLD-LAST-NAME
MOVE CNT.FIRST-NAME  TO #OLD-FIRST-NAME
MOVE CNT.MIDDLE-NAME TO #OLD-MIDDLE-NAME
MOVE CNT.SUFFIX      TO #OLD-SUFFIX
MOVE CNT.SSN         TO #OLD-SSN
MOVE CNT.SSN-PROTECT TO #OLD-SSN-PROTECT
MOVE #DOB            TO #OLD-DOB
MOVE CNT.BIRTH-CERT-CODE TO #OLD-BCC
MOVE #DOD            TO #OLD-DOD
MOVE CNT.DEATH-CERT-CODE TO #OLD-DCC
MOVE #DIV            TO #OLD-DIV
MOVE CNT.FIRM-ORGANIZATION-NAME TO #OLD-FIRM
MOVE CNT.WEBSITE-URL TO #OLD-WEBSITE
MOVE CNT.CONTACT-REMARKS(*) TO #OLD-REMARKS(*)
IF #SCR-ROLE-2-CD = 'S'
  MOVE #DOM            TO #OLD-DOM
  MOVE #HOLD-MCC TO #OLD-MCC                /* RE54
END-IF
IF #SCR-ROLE-2-CD = 'X'
  MOVE #DOM            TO #OLD-DOM
  MOVE #HOLD-FS-MCC TO #OLD-MCC             /* RE54
END-IF
IF #ORGANIZATION OR #MEMBER-ORG
  MOVE #EST-DATE          TO #OLD-EST-DATE
  MOVE CNT.FIRM-CERT-CODE TO #OLD-ECC
END-IF
*
END-SUBROUTINE
*****************************
DEFINE SUBROUTINE SYNCHRONIZE /* RE37
*****************************
IF #SYNCHRONIZE
  PERFORM SYNC-WITH-CRM
END-IF
END-SUBROUTINE
*********************************
DEFINE SUBROUTINE VALIDATE-FIELDS
*********************************
#CONTACT-TYPE-DESC := FUNCTION-CONT-TYPE-DESC(<CNT.CONTACT-TYPE>) /* RE57 START
IF #CONTACT-TYPE-DESC = ' '
  REINPUT FULL 'Contact Type invalid.'
    MARK *CNT.CONTACT-TYPE
END-IF                                                            /* RE57 END
*
IF CNT.CONTACT-TYPE NE #SAVE-CONT-TYPE AND #SAVE-CONT-TYPE NE ' '/* RE55
  MOVE #SAVE-CONT-TYPE TO #OLD-CONTACT-TYPE
  IF #SAVE-ROLE-2-CD NE ' ' OR CNT-REL.ROLE-2-CD NE #SCR-ROLE-2-CD
    MOVE #CID TO #CO-ID-2
  END-IF
  CALLNAT 'GROLESXX' #CO-ID-1 #CO-ID-2 CNT-REL.ROLE-2-CD #SCR-ROLE-2-CD #SAVE-CONT-TYPE CNT.CONTACT-TYPE  /* RE57
    #CN-NO #RESPONSE #CHANGE-REASON            /* RE57 START
  IF #RESPONSE = 'N'
    MOVE #SAVE-CONT-TYPE TO CNT.CONTACT-TYPE
    RESET #MODIFIED
  ELSE                                          /* RE57 END
    MOVE CNT.CONTACT-TYPE TO #SAVE-CONT-TYPE
  END-IF
  IF #SAVE-CONT-TYPE = 'I'
    MOVE TRUE TO #CHANGED-ORG-TO-IND
  END-IF
  ESCAPE TOP                            /* RE55
END-IF                                  /* RE55
*
IF CNT.CONTACT-TYPE NE ' ' AND #CO-ID-2 > 0     /* RE26 START   Applies only to existing contact
  #CONTACT-TYPE-DESC := FUNCTION-CONT-TYPE-DESC(<CNT.CONTACT-TYPE>)
  IF #CONTACT-TYPE-DESC = ' '
    REINPUT FULL 'Contact Type invalid.'
      MARK *CNT.CONTACT-TYPE
  ELSE
    PERFORM FIND-CONTACT-TYPE                   /* RE55
    IF CNT.CONTACT-TYPE = 'O'
      IF NOT #ORGANIZATION AND NOT #MEMBER-ORG  /* RE36
*         MOVE 'I' TO CNT.CONTACT-TYPE                          /* RE36
        REINPUT FULL 'Role and Contact Type mismatch.'
          MARK *CNT.CONTACT-TYPE
      END-IF
    ELSE
      IF #ORGANIZATION  /* RE36
*         MOVE 'O' TO CNT.CONTACT-TYPE                          /* RE36
        REINPUT FULL 'Role and Contact Type mismatch.'
          MARK *CNT.CONTACT-TYPE
      END-IF
    END-IF
  END-IF
END-IF
*
RESET #WITH-SPOUSE-ALREADY
IF #SCR-ROLE-2-CD = ' '
  REINPUT 'Enter Role/Relationship'
    MARK *#SCR-ROLE-2-CD
END-IF
*
IF NOT (#MEMBER OR #MEMBER-ORG)    /* RE38
  IF FUNCTION-CV-CHECK(<'041',#SCR-ROLE-2-CD>) NE ' ' OR #SCR-ROLE-2-CD = 'M'               /* RE38 START
*  IF NOT (#SCR-ROLE-2-CD = 'A' OR = 'D' OR = 'E' OR = 'F' OR = 'G' OR = 'I' OR = 'K'
*      OR = 'P' OR = 'B' OR = 'R' OR = 'S' OR = 'T' OR = 'X' OR = 'O'   /* RE12
*      OR = 'H' OR = 'Z' OR = 'U' OR = 'W' OR = 'L' OR = 'V' OR = 'Y' )   /* RE21 RE25 RE36 /* RE38 END
    REINPUT 'Invalid Role/Relationship'
      MARK *#SCR-ROLE-2-CD
  END-IF
END-IF
*
IF #ORGANIZATION AND #SCR-ROLE-2-CD NE CNT-REL.ROLE-2-CD        /* RE57 START
  IF #SAVE-ROLE-2-CD NE ' ' OR CNT-REL.ROLE-2-CD NE #SCR-ROLE-2-CD
    MOVE #CID TO #CO-ID-2
  END-IF
  CALLNAT 'GROLESXX' #CO-ID-1 #CO-ID-2 CNT-REL.ROLE-2-CD #SCR-ROLE-2-CD #SAVE-CONT-TYPE CNT.CONTACT-TYPE
    #CN-NO #RESPONSE #CHANGE-REASON
  IF #CN-NO > 0                                               /* Number of CN's found linked to Org Contact
    IF #RESPONSE = 'N'
      IF #SAVE-ROLE-2-CD NE ' '
        MOVE #SAVE-ROLE-2-CD TO #SCR-ROLE-2-CD
      ELSE
        MOVE CNT-REL.ROLE-2-CD TO #SCR-ROLE-2-CD
        RESET #CO-ID-2
      END-IF
      RESET #MODIFIED
    ELSE
      MOVE #SCR-ROLE-2-CD TO CNT-REL.ROLE-2-CD
    END-IF
    ESCAPE TOP
  ELSE
    RESET #REPLACE-CONTACT
  END-IF
END-IF                                                       /* RE57 END
**display #CONF-SEL #MEMBER #MEMBER-ORG #SAVE-ROLE-2-CD #SCR-ROLE-2-CD
IF (NOT #CONF-SEL             /* RE46
    AND NOT(#MEMBER OR #MEMBER-ORG) AND #SAVE-ROLE-2-CD NE #SCR-ROLE-2-CD)
    OR (#CONF-SEL AND #SAVE-ROLE-2-CD NE #SCR-ROLE-2-CD)                     /* RE48 START
** DISPLAY #CONTACT-TYPE-DESC FUNCTION-CONTACT-TYPE(<#SCR-ROLE-2-CD>)(AL=20)
  IF *TRANSLATE(#CONTACT-TYPE-DESC,UPPER) = FUNCTION-CONTACT-TYPE(<#SCR-ROLE-2-CD>)
    IGNORE
  ELSE                                                                     /* RE48 END
    IF FUNCTION-CONTACT-TYPE(<#SCR-ROLE-2-CD>) = 'INDIVIDUAL'
      IF CNT.CONTACT-TYPE = 'O'
        FIND CNT-S WITH CONTACT-ID = #CID
          IF CNT.CONTACT-TYPE = 'O'
            REINPUT 'Role and Contact Type mismatch'
              MARK *#SCR-ROLE-2-CD
          END-IF
        END-FIND
      END-IF
      MOVE #SCR-ROLE-2-CD TO #SAVE-ROLE-2-CD
      MOVE TRUE TO #INDIVIDUAL
      MOVE 'I' TO CNT.CONTACT-TYPE
    ELSE
      MOVE #SCR-ROLE-2-CD TO #SAVE-ROLE-2-CD
      MOVE TRUE TO #ORGANIZATION
      MOVE 'O' TO CNT.CONTACT-TYPE
    END-IF
    PERFORM FIND-CONTACT-TYPE
*  IF #ORGANIZATION     /* Executed from other than CB; should show Member name
*    #MEMBER-ORG-NAME := #MEMBER-NAME
*    COMPRESS '<Member>' #MEMBER-ORG-NAME INTO #MEMBER-ORG-NAME LEAVING NO
*    MOVE LEFT #MEMBER-ORG-NAME TO #MEMBER-ORG-NAME
*  END-IF
*  IF #ORGANIZATION    /* RE38 START
*    MOVE 'O' TO CNT.CONTACT-TYPE
*  ELSE
*    MOVE 'I' TO CNT.CONTACT-TYPE
*  END-IF
    ESCAPE TOP
  END-IF
END-IF
*                                            /* RE38 END
IF #ORGANIZATION AND CNT.ID-NUMBER = 0    /* RE38 START
  FIND NUMBER CNT WITH SSN = CNT.SSN         /* RE43
  IF *NUMBER(1645) = 0                       /* RE43
    IF CNT.FIRM-ORGANIZATION-NAME = ' '  /* RE36
      REINPUT 'Organization name is required'
        MARK *CNT.FIRM-ORGANIZATION-NAME
    END-IF
  END-IF
END-IF                                                                                   /* RE36
*
IF #SCR-ROLE-2-CD = 'S' AND #ORIG-ROLE-2-CD NE 'S'
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
    IF STATUS.STATUS-CODE-SP = 'S' OR = 'B' OR = 'C' OR = 'D' OR = 'H' OR = 'M' OR = 'O'     /* RE55
      MOVE TRUE TO #WITH-SPOUSE-ALREADY
    END-IF
  END-FIND
  IF #WITH-SPOUSE-ALREADY
    REINPUT 'Spouse already exists for Member.'
      MARK *#SCR-ROLE-2-CD
  END-IF
END-IF
*
IF #SCR-ROLE-2-CD = 'X' AND #ORIG-ROLE-2-CD NE 'X'
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
    IF STATUS.FORMER-SPOUSE-STATUS = 'F'
      MOVE TRUE TO #WITH-SPOUSE-ALREADY
    END-IF
  END-FIND
  IF #WITH-SPOUSE-ALREADY
    REINPUT 'Former spouse already exists for Member.'
      MARK *#SCR-ROLE-2-CD
  END-IF
END-IF
*
IF #SCR-ROLE-2-CD = 'Y' AND #ORIG-ROLE-2-CD NE 'Y'        /* RE55 START
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
    IF FORMER-HUSBAND-CONTACT-ID > 0
      MOVE TRUE TO #WITH-SPOUSE-ALREADY
    END-IF
  END-FIND
  IF #WITH-SPOUSE-ALREADY
    REINPUT 'Former husband already exists for Member.'
      MARK *#SCR-ROLE-2-CD
  END-IF
END-IF                                                    /* RE55 END
*
IF #SSN-A NE ' ' AND #SSN-A NE MASK(NNNNNNNNN)         /* RE40
  REINPUT 'SSN must be numeric'      /* RE40
    MARK *#SSN-A                     /* RE40
END-IF                               /* RE40
**DISPLAY #OLD-SSN CNT.SSN
**DISPLAY #SAVE-SSN CNT.SSN #CO-ID-2 STATUS.PROCESS-IND INTRO-FLAG
IF (CNT.SSN NE 0 AND STATUS.PROCESS-IND = 'C' AND STATUS.INTRO-FLAG NE 'A') /* RE30
    OR (#SAVE-SSN = CNT.SSN AND #CO-ID-2 NE 0)             /* RE40
    OR #ORGANIZATION OR CNT.CONTACT-TYPE = 'O'             /* RE52
  IF (#ORGANIZATION OR CNT.CONTACT-TYPE = 'O') AND CNT.FIRM-ORGANIZATION-NAME = ' ' /* RE52
    REINPUT 'Organization name is required'              /* RE52
      MARK *CNT.FIRM-ORGANIZATION-NAME                   /* RE52
  END-IF                                                 /* RE52
  IGNORE                                                                  /* RE30
ELSE                                                                      /* RE30
  IF (CNT.SSN NE 0 AND #SAVE-SSN NE CNT.SSN AND NOT #CONF-SEL            /* RE3
      AND #SCR-ROLE-2-CD NE 'T') OR                                           /* RE19
      (CNT.SSN NE 0 AND NOT #CONF-SEL AND #ORIG-ROLE-2-CD = 'T'            /* RE19
      AND #SCR-ROLE-2-CD NE 'T')                                          /* RE19
    IF #MEMBER OR #MEMBER-ORG    /* RE38    RE40
      FIND CNT-S WITH SSN = CNT.SSN
        REINPUT 'SSN already exists in the system. Please verify.'
          MARK *CNT.SSN
      END-FIND
    ELSE                          /* RE40
      FIND CNT-S WITH CONTACT-ID = #CO-ID-1
        IF CNT.SSN = CNT-S.SSN AND NOT #ORGANIZATION  /* RE43
          REINPUT 'SSN already belongs to this Member.'
            MARK *CNT.SSN
        END-IF
      END-FIND
    END-IF                        /* RE40
    FIND CNT-REL-S WITH CONTACT-1-ID = #CO-ID-1
      RESET #ADD-EXISTING-ORG
      FIND CNT-S WITH CONTACT-ID = CONTACT-2-ID
        IF #ORGANIZATION  OR (#INDIVIDUAL AND CNT-S.CONTACT-TYPE = 'O')  /* RE43  START
          IF #INDIVIDUAL AND CNT-S.CONTACT-TYPE = 'O'
            IGNORE
          ELSE
            IF #ORGANIZATION AND ROLE-2-CD = #SCR-ROLE-2-CD AND CNT.SSN = CNT-S.SSN
              REINPUT 'SSN already belongs to an Organization with the same Role.'
                MARK *CNT.SSN
*            ELSE
*              IF #ORGANIZATION
*                MOVE TRUE TO #ADD-EXISTING-ORG
*              END-IF
            END-IF
          END-IF
*          IGNORE         /* RE43
        ELSE              /* RE43  END
          IF CNT.SSN =  CNT-S.SSN
            DECIDE ON FIRST VALUE OF ROLE-2-CD
              VALUE 'K','G','D'
                IF #MEMBER
                  MOVE 'SSN already belongs to a DEPN of this Member.' TO #MSG
                ELSE
                  MOVE 'SSN already belongs to another DEPN of this Member.' TO #MSG
                END-IF
              VALUE 'S'
                IF #SCR-ROLE-2-CD NE 'X'
                  MOVE 'SSN already belongs to the Spouse of this Member.' TO #MSG
                ELSE
                  ESCAPE BOTTOM
                END-IF
              VALUE 'X'
                IF #SCR-ROLE-2-CD NE 'S'
                  MOVE 'SSN already belongs to the Former Spouse of this Member.' TO #MSG
                ELSE
                  ESCAPE BOTTOM
                END-IF
              NONE
                MOVE 'SSN already belongs to an OTHER relation of Member.' TO #MSG
            END-DECIDE
            REINPUT #MSG
              MARK *CNT.SSN
          ELSE
            IF #SCR-ROLE-2-CD = 'S'                        /* RE47
              PERFORM CHECK-IF-NOT-SPOUSE-OF-ANOTHER       /* RE47
            END-IF                                         /* RE47
          END-IF
        END-IF
      END-FIND
    END-FIND
    MOVE #CO-ID-1 TO #CID-PARM          /* RE40
    CALLNAT 'GCSSNSXX' #CGA-ORIG-ID #CID-PARM #SCR-ROLE-2-CD CNT.SSN CNT.FIRST-NAME CNT.MIDDLE-NAME CNT.LAST-NAME CNT.SUFFIX
      CNT.FIRM-ORGANIZATION-NAME CNT.GENDER-CD #DOB CNT.BIRTH-CERT-CODE #DOD CNT.DEATH-CERT-CODE #DOM #DIV CNT.ID-NUMBER /* RE43
      #LST-UPD #LST-USR #NOT-FOUND #PF3 #SRCH      /* RE24
    IF #NOT-FOUND
      RESET #NOT-FOUND
      IGNORE
    ELSE
      MOVE TRUE TO #DUP-SSN
      IF NOT #PF3
        IF CNT.ID-NUMBER > 0
          IF #SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D'
            RESET #DT-FORMAT-TEXT #DOM-TEXT #DIV-TEXT #DOM-CD-TEXT
            MOVE (AD=P) TO #DATE-CV #DOM-CV
          END-IF
          MOVE CNT.ID-NUMBER TO #CN
*          MOVE 'CN:' TO #CN-TEXT    NG4
*          MOVE (AD=P) TO #DOD-CV                                       /* vt2
*        IF #CGA-USER-COMPANY = 'I' AND NOT #BCC-MODIFY      /* RE6
*          MOVE (AD=P) TO #BCC-MOD#
*        END-IF                                                         /* RE40 END
        END-IF
        MOVE #CID-PARM TO #CID
      END-IF
      ESCAPE ROUTINE
    END-IF
  END-IF
END-IF
*
IF CNT.LAST-NAME = ' '                            /* RE1
    AND #SCR-ROLE-2-CD = 'S' OR = 'X' OR = 'K' OR = 'G' OR = 'D' /* RE33
  SET WINDOW 'Last-Name'
  MOVE 'Y' TO #CONFIRM-LN                        /* RE17
  INPUT WINDOW='Last-Name' USING MAP 'C2236MCB'   /* with inline rule to validate #CONFIRM-LN
  SET WINDOW OFF
  IF #CONFIRM-LN = 'Y'
    MOVE #DEFAULT-LN TO CNT.LAST-NAME
  END-IF
  ESCAPE ROUTINE
END-IF
*
RESET #MSG                               /*  bz1
IF NOT (#ORGANIZATION OR #MEMBER-ORG)    /* RE26 RE36
  IF CNT.LAST-NAME = MASK(' ')                        /*  bz1
    Move "Last Name. First symbol is blank" TO #MSG   /*  bz1
    REINPUT #MSG MARK *CNT.LAST-NAME                  /*  bz1
  END-IF                                              /*  bz1
*
  IF NOT l_Trust                                      /*  bz2
    v_A25 := CNT.LAST-NAME                           /*  bz1
    PERFORM VALIDATE-NAMES                           /*  bz1
    IF #MSG <>  " "                                  /*  bz1
      COMPRESS "Last Name." #MSG INTO #MSG           /*  bz1
      REINPUT #MSG MARK *CNT.LAST-NAME               /*  bz1
    END-IF                                           /*  bz1
  END-IF                                              /*  bz2
*
  IF NOT l_Trust
    IF #MEMBER                                                  /*  bz1
      IF CNT.FIRST-NAME = MASK(' ')                             /*  bz1
        Move "First Name. First symbol is blank" TO #MSG        /*  bz1
        REINPUT #MSG MARK *CNT.FIRST-NAME                       /*  bz1
      END-IF
    END-IF                                              /*  bz1
    v_A25 := CNT.FIRST-NAME                             /*  bz1
    PERFORM VALIDATE-NAMES                              /*  bz1
    IF #MSG <>  " "                                     /*  bz1
      COMPRESS "First Name." #MSG INTO #MSG           /*  bz1
      REINPUT #MSG MARK *CNT.FIRST-NAME               /*  bz1
    END-IF                                              /*  bz1
  END-IF                                                 /*  bz2
END-IF
*
IF NOT l_Trust
  v_A25 := CNT.MIDDLE-NAME                         /*  bz1
  PERFORM VALIDATE-NAMES                           /*  bz1
  IF #MSG <>  " "                                  /*  bz1
    COMPRESS "Middle Name." #MSG INTO #MSG       /*  bz1
    REINPUT #MSG MARK *CNT.MIDDLE-NAME             /*  bz1
  END-IF                                           /*  bz1
END-IF
*
IF NOT l_Trust                                        /*  bz2
  v_A25 := CNT.SUFFIX                              /*  bz1
  PERFORM VALIDATE-NAMES                           /*  bz1
  IF #MSG <>  " "                                  /*  bz1
    COMPRESS "Suffix." #MSG INTO #MSG            /*  bz1
    REINPUT #MSG MARK *CNT.SUFFIX                  /*  bz1
  END-IF                                           /*  bz1
END-IF                                                /*  bz2
*
IF NOT (CNT.GENDER-CD = 'F' OR = 'M' OR = ' ')
  REINPUT 'Gender must be F OR M OR Blank'
    MARK *CNT.GENDER-CD
END-IF
*
IF #PREFIX-TITLE NE ' '                                  /* RE26 START
  #PREFIX-TITLE-DESC := FUNCTION-PREFIX-DESC(<#PREFIX-TITLE-PARM>)
  IF #PREFIX-TITLE-DESC = ' '
    REINPUT 'Prefix invalid. Please use look-up.'
      MARK *#PREFIX-TITLE
  END-IF
* ELSE         NG3
*  #PREFIX-TITLE := F-DEFAULT-PREFIX (< #CO-ID-2,CNT.GENDER-CD >)
*  #PREFIX-TITLE-DESC := FUNCTION-PREFIX-DESC(<#PREFIX-TITLE-PARM>)
END-IF
*
**IF FUNCTION-AUTHORIZED(<*INIT-USER>)
IF CNT.GENDER-CD = 'F' AND #PREFIX-TITLE = 'MR' or = 'Mr'
  REINPUT 'Gender and Prefix mismatch'
    MARK *#PREFIX-TITLE
ELSE
  IF CNT.GENDER-CD = 'M' AND #PREFIX-TITLE = 'MISS' OR = 'MRS' OR = 'MS' OR = 'Miss' OR = 'Mrs' OR = 'Ms'
    REINPUT 'Gender and Prefix mismatch'
      MARK *#PREFIX-TITLE
  END-IF
END-IF
**END-IF                                                   /* RE26 END
*
IF CNT.SSN NE 0
    AND CNT.SSN NE MASK (NNNNNNNNN)
  REINPUT 'SSN must be numeric'
    MARK *CNT.SSN
END-IF
*
IF NOT (CNT.SSN-PROTECT = 'N' OR = 'Y')
  REINPUT 'SSN PROTECTION must be "Y" or "N"'
    MARK *CNT.SSN-PROTECT
END-IF
*
IF NOT (CNT.BIRTH-CERT-CODE = 'N' OR = 'A' OR = 'B' OR = 'U' OR = 'V' OR = 'I' OR = ' ')
  REINPUT 'Invalid Birth Cert. Code'
    MARK *CNT.BIRTH-CERT-CODE
END-IF
*
MOVE #DOB TO #MMDDYYYY                         /* RE38
IF (#DOB NE ' ' AND #DOB-N NE MASK (MMDDYYYY)) /* OR                /*LR1
*   (#DOB NE ' ' AND #YYYY-N < 1900)
  REINPUT 'Invalid date format - must be MMDDYYYY'       /*LR1
    MARK *#DOB
END-IF
*
MOVE #DOD TO #MMDDYYYY
IF (#DOD NE ' ' AND #DOD-N NE MASK (MMDDYYYY)) /* OR                /* LR1
*   (#DOD NE ' ' AND #YYYY-N < 1900)
  REINPUT 'Invalid date format - must be MMDDYYYY'       /* LR1
    MARK *#DOD
END-IF
*
MOVE #DOM TO #MMDDYYYY
IF (#DOM NE ' ' AND #DOM-N NE MASK (MMDDYYYY)) /* OR
*  (#DOM NE ' ' AND #YYYY-N < 1900)
  REINPUT 'Invalid date format - must be MMDDYYYY'
    MARK *#DOM
END-IF
*
MOVE #DIV TO #MMDDYYYY
IF (#DIV NE ' ' AND #DIV-N NE MASK (MMDDYYYY)) /* OR
*   (#DIV NE ' ' AND #YYYY-N < 1900)
  REINPUT 'Invalid date format - must be MMDDYYYY'
    MARK *#DIV
END-IF
*
MOVE #EST-DATE TO #MMDDYYYY
IF (#EST-DATE NE ' ' AND #EST-DATE-N NE MASK (MMDDYYYY))
  REINPUT 'Invalid date format - must be MMDDYYYY'
    MARK *#EST-DATE
END-IF
*
COMPRESS #YYYY-E #MM-E #DD-E INTO #YYYYMMDD-A LEAVING NO
IF #EST-DATE NE ' ' AND #YYYYMMDD > *DATN
  REINPUT 'Future date invalid.'
    MARK *#EST-DATE
END-IF
*
IF #EST-DATE NE ' ' AND #YYYYMMDD < 19000101
  REINPUT 'Date must be not be earlier than 01011900'
    MARK *#EST-DATE
END-IF
*
#PERSONAL-INFO.DATE-OF-BIRTH   := FUNCTION-DATE(<#DOB-N>)    /* RE38 START
#PERSONAL-INFO.DATE-OF-DEATH   := FUNCTION-DATE(<#DOD-N>)
#PERSONAL-INFO.DATE-OF-MARRIAGE:= FUNCTION-DATE(<#DOM-N>)
#PERSONAL-INFO.DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)    /* RE38 END
*
MOVE 'Y' TO #VALIDATE-FLAG(1)
PERFORM CALL-VALIDATION                                                        /* RE38
*
**COMPRESS #YYYY-C #MM-C #DD-C INTO #YYYYMMDD-A LEAVING NO  /* DOB
**IF #YYYYMMDD > *DATN
**  REINPUT 'Future date invalid.'
**    MARK *#DOB
**END-IF
*                                                /* RE38
IF NOT #CONF-SEL AND CNT.ID-NUMBER > 0 AND CNT.DATE-OF-DEATH = 0 AND #DOD NE ' '  
and #num-mbships gt 0                                            /* vt2  
  REINPUT 'For this member please use DN command'
    MARK *#DOD
END-IF                                                                             
**END-IF
*
**COMPRESS #YYYY-C #MM-C #DD-C INTO #YYYYMMDD-2-A LEAVING NO  /* DOD
**IF #YYYYMMDD-2 > *DATN
*  REINPUT 'Future date invalid.'
*    MARK *#DOD
**END-IF
*
IF NOT (CNT.DEATH-CERT-CODE = 'N' OR = 'A' OR = 'B' OR = 'U' OR = 'V' OR = 'I' OR = ' ')  /* RE24
  REINPUT 'Invalid Death Cert. Code'                                                      /* RE24
    MARK *CNT.DEATH-CERT-CODE                                                             /* RE24
END-IF                                                                                    /* RE24
*
**IF #YYYYMMDD-2 > 0 AND #YYYYMMDD > #YYYYMMDD-2                              /* DOB vs DOD RE38 START
*  REINPUT 'Date of Birth must precede Date of Death.'
*    MARK *#DOB
**END-IF
MOVE 'Y' TO #VALIDATE-FLAG(2)
PERFORM CALL-VALIDATION                                                        /* RE38
*
MOVE 'Y' TO #VALIDATE-FLAG(3)
PERFORM CALL-VALIDATION                                                        /* RE38
*
MOVE 'Y' TO #VALIDATE-FLAG(4)
PERFORM CALL-VALIDATION                                                        /* RE38
*
IF #DOM NE ' ' AND (#SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D')
  REINPUT 'Date of Marriage not allowed for this role.'
    MARK *#DOM
END-IF
*
**MOVE #DOM TO #MMDDYYYY
**COMPRESS #YYYY-C #MM-C #DD-C  INTO #YYYYMMDD-A LEAVING NO
**IF #YYYYMMDD GT *DATN
*  REINPUT 'Future date invalid.'
*    MARK *#DOM
**END-IF
*
**IF #DOB NE ' ' AND #DOM NE ' '
*  MOVE #DOB TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C INTO #YYYYMMDD-2-A LEAVING NO
*  IF #YYYYMMDD-2 > #YYYYMMDD
*    REINPUT 'Date of Birth must precede Date of Marriage.'
*      MARK *#DOB
*  END-IF
**END-IF
*
IF NOT (#MARRIAGE-CERT-CODE = 'N' OR = 'A' OR = 'B' OR = 'U' OR = 'V' OR = 'I' OR = ' ')
*  MOVE 'Valid values are " ", "N", "A", "B", "U", "V", "I"' TO #BCC-MSG
  REINPUT 'Invalid Marriage Cert. Code'
    MARK *#MARRIAGE-CERT-CODE
END-IF
*
IF #DIV NE ' ' AND (#SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D')
  REINPUT 'Date of Divorce not allowed for this Role.'
    MARK *#DIV
END-IF
*
**IF #DOB NE ' ' AND #DIV NE ' '
*  MOVE #DOB TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C INTO #YYYYMMDD-2-A LEAVING NO
*  MOVE #DIV TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C INTO #YYYYMMDD-A LEAVING NO
*  IF #YYYYMMDD-2 > #YYYYMMDD
*    REINPUT 'Date of Birth must precede Date of Divorce.'
*      MARK *#DOB
*  END-IF
**END-IF
*
**IF #DOM NE ' ' AND #DIV NE ' '
*  MOVE #DOM TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C  INTO #YYYYMMDD-A LEAVING NO
*  MOVE #DIV TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C  INTO #YYYYMMDD-2-A LEAVING NO
**display #DOM #DIV #YYYYMMDD-2
**  IF #YYYYMMDD-2 < #YYYYMMDD
*    REINPUT 'Marriage must precede divorce.'
*      MARK *#DOM
*  END-IF
**END-IF
*
**IF #DOD NE ' ' AND #DOM NE ' '
*  MOVE #DOD TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C  INTO #YYYYMMDD-2-A LEAVING NO
*  IF #YYYYMMDD-2 LE #YYYYMMDD
*    REINPUT 'Marriage must precede death.'
*      MARK *#DOM
*  END-IF
**END-IF
*
IF #DIV NE ' ' AND #SCR-ROLE-2-CD NE 'X'
  REINPUT 'Role must be "X" if Date of Divorce is entered.'
    MARK *#SCR-ROLE-2-CD
END-IF
*
**IF #DOD NE ' ' AND #DIV NE ' '
*  MOVE #DOD TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C  INTO #YYYYMMDD-A LEAVING NO
*  MOVE #DIV TO #MMDDYYYY
*  COMPRESS #YYYY-C #MM-C #DD-C  INTO #YYYYMMDD-2-A LEAVING NO
*  IF #YYYYMMDD < #YYYYMMDD-2
*    REINPUT 'Divorce must precede death.'
*      MARK *#DIV
*  END-IF
**END-IF
*
END-SUBROUTINE
************************************************
DEFINE SUBROUTINE CHECK-IF-NOT-SPOUSE-OF-ANOTHER                /* RE47
************************************************
FIND CNT-U WITH SSN = CNT.SSN
  FIND CNT-REL-U WITH CONTACT-1-ID = CNT-U.CONTACT-ID
    IF ROLE-1-CD = 'S'
        AND CONTACT-2-ID NE #CO-ID-1                      /* RE56
      REINPUT 'This SSN belongs to the Spouse of another member.'
        MARK *CNT.SSN
    END-IF
  END-FIND
  FIND CNT-REL-U WITH CONTACT-2-ID = CNT-U.CONTACT-ID
    IF ROLE-1-CD = 'S'
      REINPUT 'This SSN belongs to the Spouse of another member.'
        MARK *CNT.SSN
    END-IF
  END-FIND
END-FIND
*
END-SUBROUTINE
*********************************
DEFINE SUBROUTINE CALL-VALIDATION                  /* RE38
*********************************
#SYSTEM := 'UNIX'
RESET #ERROR-CODE(1)
CALLNAT 'GPRNPINF' #PERSONAL-INFO #PERSONAL-OTHERS
IF #ERROR-CODE(1) NE ' '
  #MSG := F-ERROR-DESCRIPTION(<#ERROR-CODE(1)>)
  DECIDE ON FIRST VALUE #VAL-FIELD
    VALUE 'DOB'
      #POS := POS(#DOB)
    VALUE 'DOD'
      #POS := POS(#DOD)
    VALUE 'DOM'
      #POS := POS(#DOM)
    VALUE 'DODIV'
      #POS := POS(#DIV)
    NONE
      IGNORE
  END-DECIDE
  REINPUT #MSG MARK #POS
END-IF
RESET  #VALIDATE-FLAG(*) #VAL-FIELD
*
END-SUBROUTINE
***************************************
DEFINE SUBROUTINE UPDATE-OR-ADD-CONTACT
***************************************
MOVE TRUE TO #SYNCHRONIZE                  /* RE37 START
MOVE *DATN TO #LAST-UPD-DATE                              /* NG3
#LST-USR := FUNCTION-CLERK-NAME (< #CGA-CLERK >)          /* NG3
IF #CO-ID-2 > 0 AND #CONF-SEL             /* RE47
  MOVE TRUE TO #REPLACE-CONTACT           /* RE47
END-IF                                    /* RE47
*
IF #CO-ID-2 = 0
    OR #REPLACE-CONTACT                     /* RE47 when an existing contact is replaced by another one thru SSN/CN/CI
  PERFORM ADD-CONTACT
ELSE
  PERFORM UPDATE-CONTACT
END-IF
*
END-SUBROUTINE
*****************************
DEFINE SUBROUTINE ADD-CONTACT
*****************************
RESET #ADD-EXISTING-ORG
**FIND CNT-U WITH CONTACT-ID = #CID WHERE CONTACT-TYPE = CNT.CONTACT-TYPE   /* RE48 START
FIND CNT-U WITH CONTACT-ID = #CID                                           /* RE57
  IF NO RECORD FOUND
    MOVE TRUE TO #ADD-EXISTING-ORG
    ESCAPE BOTTOM                                                           /* RE57
  END-NOREC
  IF CNT-U.CONTACT-TYPE NE ' ' AND CNT-U.CONTACT-TYPE NE CNT.CONTACT-TYPE   /* RE57
    MOVE TRUE TO #ADD-EXISTING-ORG                                          /* RE57
    ESCAPE BOTTOM                                                           /* RE57
  END-IF
END-FIND                                                                  /* RE48 END
*
IF #ADD-EXISTING-ORG       /* RE48
    AND (NOT #CONF-SEL
    OR (#CONF-SEL AND #ORGANIZATION) OR #ADD-EXISTING-ORG)     /* RE43
  IF #ORGANIZATION /* RE36
    MOVE 'O' TO CNT-S.CONTACT-TYPE CNT.CONTACT-TYPE
  ELSE
    MOVE 'I' TO CNT-S.CONTACT-TYPE CNT.CONTACT-TYPE
  END-IF
  RESET CNT-S.ID-NUMBER
  IF CNT.FIRST-NAME = ' '                           /* RE9
*      AND CNT.FIRST-NAME NE 'TRUST' AND CNT.MIDDLE-NAME NE 'TRUST' AND CNT.LAST-NAME NE 'TRUST' /* RE29
*      AND CNT.SUFFIX NE 'TRUST' AND #SCR-ROLE-2-CD NE 'W'                                       /* RE29
      AND #SCR-ROLE-2-CD = #UNKNOWN-REL (*)                                                    /* NG2
    MOVE 'UNKNOWN'         TO CNT-S.FIRST-NAME CNT.FIRST-NAME      /* RE9
  ELSE
    MOVE CNT.FIRST-NAME    TO CNT-S.FIRST-NAME
  END-IF
  MOVE CNT.MIDDLE-NAME     TO CNT-S.MIDDLE-NAME
  IF CNT.LAST-NAME = ' ' AND
      NOT #ORGANIZATION           /* RE26 RE36
    MOVE #DEFAULT-LN       TO CNT-S.LAST-NAME
  ELSE
    MOVE CNT.LAST-NAME     TO CNT-S.LAST-NAME
  END-IF
  MOVE CNT.SUFFIX          TO CNT-S.SUFFIX
  MOVE CNT.GENDER-CD       TO CNT-S.GENDER-CD       /* --NA
  EXAMINE #PREFIX-TITLE-PARM TRANSLATE INTO UPPER CASE     /* RE49
  MOVE #PREFIX-TITLE-PARM  TO CNT-S.PREFIX-TITLE    /* RE26
  MOVE 1616                TO CNT-S.RANK-ID         /* RE55
*  IF CNT-S.PREFIX-TITLE = ' '
*    IF CNT-S.GENDER-CD = 'M'                          /* RE34 START
*      MOVE 'MR' TO CNT-S.PREFIX-TITLE
*    ELSE
*      IF CNT-S.GENDER-CD = 'F'
*        IF #SCR-ROLE-2-CD = 'S' OR = 'X' OR = 'G' OR = 'P'
**          MOVE 'MRS' TO CNT-S.PREFIX-TITLE
*        ELSE
*          MOVE 'MS' TO CNT-S.PREFIX-TITLE
*        END-IF
*      END-IF
*    END-IF
*  END-IF                                             /* RE34 END
  CNT-S.DATE-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38
  MOVE CNT.SSN             TO CNT-S.SSN           /* D
  MOVE CNT.SSN-PROTECT     TO CNT-S.SSN-PROTECT            /* RE22 START
  IF CNT.SSN-PROTECT = 'Y'
    MOVE *DATN TO CNT-S.SSN-PROTECT-DATE
  ELSE
    RESET CNT-S.SSN-PROTECT-DATE
  END-IF                                                   /* RE22 END
  CNT-S.DATE-OF-DEATH := FUNCTION-DATE(<#DOD-N>)   /* RE38
  CNT-S.FIRM-ESTABLISHED-DATE := FUNCTION-DATE(<#EST-DATE-N>)   /* RE38
  MOVE CNT.BIRTH-CERT-CODE        TO CNT-S.BIRTH-CERT-CODE
  MOVE CNT.DEATH-CERT-CODE        TO CNT-S.DEATH-CERT-CODE        /* RE24
  MOVE CNT.FIRM-CERT-CODE         TO CNT-S.FIRM-CERT-CODE
  MOVE CNT.FIRM-ORGANIZATION-NAME TO CNT-S.FIRM-ORGANIZATION-NAME /* RE35
  MOVE CNT.WEBSITE-URL            TO CNT-S.WEBSITE-URL            /* RE35
  MOVE CNT.CONTACT-REMARKS(*)     TO CNT-S.CONTACT-REMARKS(*)     /* RE35
  FIND (1) TERM WITH TERMINAL-ID = 'MASTERCO'      /* RE2
    ADD 1 TO #CONTACT-ID
    UPDATE
  END-FIND
  MOVE #CONTACT-ID         TO CNT-S.CONTACT-ID #CID #CO-ID-2      /* RE2
  MOVE 'N'                 TO CNT-S.DELETE-FLAG
  MOVE #CGA-CLERK          TO CNT-S.LAST-USER-UPD
  MOVE *DATN               TO CNT-S.LAST-DATE-UPD
  MOVE *TIMN               TO CNT-S.LAST-TIME-UPD
  STORE CNT-S
  IF CNT-S.PREFIX-TITLE = ' '                    /* NG3
    GET CNT-U *ISN (2225)
    CNT-U.PREFIX-TITLE := F-DEFAULT-PREFIX (< CNT-U.CONTACT-ID >)
    #PREFIX-TITLE := CNT-U.PREFIX-TITLE
    #PREFIX-TITLE-DESC := FUNCTION-PREFIX-DESC(<#PREFIX-TITLE-PARM>)
    UPDATE (2227)
  END-IF
ELSE
  FIND CNT-U WITH CONTACT-ID = #CID            /* RE1
    MOVE CNT-U.CONTACT-ID TO #CONTACT-ID             /* RE2
    IF CNT-U.CONTACT-TYPE = ' '                      /* RE57
      MOVE CNT.CONTACT-TYPE TO CNT-U.CONTACT-TYPE    /* RE57
      UPDATE                                         /* RE57
    END-IF                                           /* RE57
    IF DELETE-FLAG = 'Y'
      MOVE 'N' TO DELETE-FLAG
      MOVE #CGA-CLERK      TO CNT-U.LAST-USER-UPD
      MOVE *DATN           TO CNT-U.LAST-DATE-UPD
      MOVE *TIMN           TO CNT-U.LAST-TIME-UPD
      UPDATE
    END-IF
  END-FIND
  MOVE #CID TO #CO-ID-2                        /* RE57
END-IF
*
FIND (1) CNT-REL-S WITH CONTACT-1-ID = #CO-ID-1
  IF NO RECORD FOUND
    MOVE #CO-ID-1 TO CONTACT-1-ID
  END-NOREC
END-FIND
MOVE #CONTACT-ID TO CNT-REL-S.CONTACT-2-ID     /* RE2
IF #SCR-ROLE-2-CD = 'S' OR = 'X'
  MOVE #SCR-ROLE-2-CD TO CNT-REL-S.ROLE-1-CD
ELSE
  IF #SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D'
    MOVE 'P' TO CNT-REL-S.ROLE-1-CD
  ELSE
    MOVE 'M' TO CNT-REL-S.ROLE-1-CD
  END-IF
END-IF
MOVE #SCR-ROLE-2-CD TO CNT-REL-S.ROLE-2-CD #ORIG-ROLE-2-CD
MOVE #CGA-CLERK          TO CNT-REL-S.LAST-USER-UPD
MOVE *DATN               TO CNT-REL-S.LAST-DATE-UPD
MOVE *TIMN               TO CNT-REL-S.LAST-TIME-UPD
STORE CNT-REL-S
*
DECIDE ON FIRST VALUE OF #ORIG-ROLE-2-CD                    /* RE55
**IF #ORIG-ROLE-2-CD = 'K' OR = 'G' OR = 'D'                /* RE55
  VALUE 'K', 'G', 'D'                                       /* RE55
    FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID
      FOR #I 1 60
        IF DEPN-NAME(#I) = ' '
          MOVE #CONTACT-ID          TO DEPN-CONTACT-ID(#I)          /* RE2
          COMPRESS CNT.FIRST-NAME CNT.MIDDLE-NAME INTO DEPN-NAME(#I)
          IF CNT.SUFFIX NE ' '
            COMPRESS DEPN-NAME(#I) ',' INTO DEPN-NAME(#I) LEAVING NO
            COMPRESS DEPN-NAME(#I) CNT.SUFFIX INTO DEPN-NAME(#I)
          END-IF
          IF #ORIG-ROLE-2-CD = 'G'                                       /* RE
            MOVE 'G' TO DEPN-STATUS-CD(#I)
          END-IF
          DEPN-DATE-OF-BIRTH(#I) := FUNCTION-DATE(<#DOB-N>)   /* RE38
          MOVE CNT.SSN             TO DEPN-SSN(#I)           /* D
          MOVE CNT.BIRTH-CERT-CODE TO DEPN-BIRTH-CD(#I)
          ESCAPE BOTTOM
        END-IF
      END-FOR
      MOVE *DATN      TO FIRS.DP-LAST-FM-DATE
      MOVE *DATN      TO FIRS.DTS-DATN
      MOVE *TIMN      TO FIRS.DTS-TIMN
      UPDATE
    END-FIND
**ELSE                                                     /* RE55
**  IF #ORIG-ROLE-2-CD = 'S' OR = 'X'                      /* RE55
  VALUE 'S', 'X'
    FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
      IF #ORIG-ROLE-2-CD = 'S'
        MOVE CNT-REL-S.CONTACT-2-ID TO SPOUSE-CONTACT-ID
        MOVE 'S'                 TO STATUS.STATUS-CODE-SP
        PERFORM FORMAT-NAME-SP
*         MOVE CNT.GENDER-CD       TO SEX-SP       /* --NA             /* TT1
*         DATE-OF-BIRTH-SP := FUNCTION-DATE(<#DOB-N>)   /* RE38        /* TT1
        STATUS.DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
        STATUS.DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
        MOVE CNT.SSN             TO SSN-SP
        MOVE CNT.BIRTH-CERT-CODE TO BIRTH-CERT-CODE-SP
        MOVE #MARRIAGE-CERT-CODE TO STATUS.MARRIAGE-CERT-CODE
      ELSE
        MOVE CNT-REL-S.CONTACT-2-ID TO FORMER-SPOUSE-CONTACT-ID
        MOVE 'F'                 TO STATUS.FORMER-SPOUSE-STATUS
        PERFORM FORMAT-FORMER-SPOUSE-NAME
*         FORMER-SPOUSE-DT-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38        /* TT1
        FORMER-SPOUSE-DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
        FORMER-SPOUSE-DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
        MOVE CNT.SSN             TO FORMER-SPOUSE-SSN
        MOVE #MARRIAGE-CERT-CODE TO FS-MARR-CERT-CD
        MOVE CNT.BIRTH-CERT-CODE TO FS-BIRTH-CERT-CD
      END-IF
      MOVE *DATN      TO LAST-FM-DATE
      MOVE *DATN      TO DTS-DATN
      MOVE *TIMN      TO DTS-TIMN
      UPDATE
    END-FIND
  VALUE 'Y'                                                     /* RE55 START
    FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
      MOVE CNT-REL-S.CONTACT-2-ID TO FORMER-HUSBAND-CONTACT-ID
      PERFORM FORMAT-FORMER-HUSBAND-NAME
      MOVE CNT.SSN                TO FORMER-HUSBAND-SSN
      FORMER-HUSBAND-DOD := FUNCTION-DATE(<#DOD-N>)
      UPDATE
    END-FIND
  NONE
    IGNORE
END-DECIDE
**  END-IF
**END-IF                                                        /* RE55 END
*
IF #REPLACE-CONTACT                            /* RE47 check whether contact has been replaced thru SSN
*  FIND CNT-REL-S WITH CONTACT-2-ID = #CO-ID-2   /*      and remove its relationship with member
  FIND CNT-REL-S WITH CONTACT-2-ID = #REPLACED-CID  /*   RE58
    IF CONTACT-1-ID = #CO-ID-1
      DELETE (2345)
      ESCAPE BOTTOM
    END-IF
  END-FIND
  MOVE 'Record successfully updated.' TO #MSG
ELSE
  MOVE 'Record successfully added.' TO #MSG
END-IF
* MOVE (AD=P) TO #ROLE-MOD# #PRF-CV #CNT-CV #BCC-MOD# #DOM-CV     /* RE38 START  NG1
*  #DOB-CV #DOD-CV #DATE-CV #ORG-CV #WEBSITE-CV
MOVE 'U' TO #MODE                                                 /* RE38 END MOVE 'V' TO #MODE NG1
RESET #CONF-SEL #REPLACE-CONTACT
*
END-SUBROUTINE
********************************
DEFINE SUBROUTINE UPDATE-CONTACT
********************************
RESET #I
FIND CNT-U WITH CONTACT-ID = #CO-ID-2
  IF CNT.CONTACT-TYPE = ' '                     /* RE26 START
    IF #ORGANIZATION  /* RE36
      MOVE 'O' TO CNT-U.CONTACT-TYPE CNT.CONTACT-TYPE
    ELSE
      MOVE 'I' TO CNT-U.CONTACT-TYPE CNT.CONTACT-TYPE
    END-IF
  ELSE
    MOVE CNT.CONTACT-TYPE TO CNT-U.CONTACT-TYPE
  END-IF                                        /* RE26 END
  IF CNT.FIRST-NAME = ' '                           /* RE9
      AND #SCR-ROLE-2-CD = #UNKNOWN-REL (*)                                                    /* NG2
    MOVE 'UNKNOWN'         TO CNT-U.FIRST-NAME CNT.FIRST-NAME      /* RE9
  ELSE
    MOVE CNT.FIRST-NAME    TO CNT-U.FIRST-NAME
  END-IF
  MOVE CNT.MIDDLE-NAME     TO CNT-U.MIDDLE-NAME
  IF (CNT.LAST-NAME = ' '
      AND NOT #ORGANIZATION)         /* RE26 RE36
      AND CNT.CONTACT-TYPE NE 'O'
    MOVE #DEFAULT-LN       TO CNT-U.LAST-NAME
  ELSE
    MOVE CNT.LAST-NAME     TO CNT-U.LAST-NAME
  END-IF
  MOVE CNT.SUFFIX          TO CNT-U.SUFFIX
  MOVE CNT.GENDER-CD       TO CNT-U.GENDER-CD       /* --NA
  EXAMINE #PREFIX-TITLE TRANSLATE INTO UPPER CASE     /* RE49
  MOVE #PREFIX-TITLE       TO CNT-U.PREFIX-TITLE    /* RE26
*  IF CNT-U.PREFIX-TITLE = ' '                       /* RE26
*    IF CNT-U.GENDER-CD = 'M'                          /* RE34 START
*      MOVE 'MR' TO CNT-U.PREFIX-TITLE
*    ELSE
*      IF CNT-U.GENDER-CD = 'F'
*        IF #SCR-ROLE-2-CD = 'S' OR = 'X' OR = 'G' OR = 'P'
*          MOVE 'MRS' TO CNT-U.PREFIX-TITLE
*        ELSE
*          MOVE 'MS' TO CNT-U.PREFIX-TITLE
*        END-IF
*      END-IF
*    END-IF
*  END-IF                                             /* RE34 END
  CNT-U.DATE-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38
  MOVE CNT.SSN             TO CNT-U.SSN
  MOVE CNT.SSN-PROTECT     TO CNT-U.SSN-PROTECT            /* RE22 START
  IF CNT.SSN-PROTECT = 'Y'
    IF CNT.SSN-PROTECT-DATE = 0
      MOVE *DATN TO CNT-U.SSN-PROTECT-DATE
      #SPD-N := FUNCTION-DATE(<CNT-U.SSN-PROTECT-DATE >)    /* RE38
    END-IF
  ELSE
    RESET CNT-U.SSN-PROTECT-DATE #SPD              /* RE38
  END-IF                                                   /* RE22 END
  CNT-U.DATE-OF-DEATH := FUNCTION-DATE(<#DOD-N>)   /* RE38
  CNT-U.FIRM-ESTABLISHED-DATE := FUNCTION-DATE(<#EST-DATE-N>)   /* RE38
  MOVE CNT.BIRTH-CERT-CODE TO CNT-U.BIRTH-CERT-CODE
  MOVE CNT.DEATH-CERT-CODE TO CNT-U.DEATH-CERT-CODE
  MOVE CNT.FIRM-CERT-CODE  TO CNT-U.FIRM-CERT-CODE
  MOVE CNT.FIRM-ORGANIZATION-NAME TO CNT-U.FIRM-ORGANIZATION-NAME /* RE35
  MOVE CNT.WEBSITE-URL            TO CNT-U.WEBSITE-URL            /* RE35
  MOVE CNT.CONTACT-REMARKS(*)     TO CNT-U.CONTACT-REMARKS(*)     /* RE35
  MOVE #CGA-CLERK          TO CNT-U.LAST-USER-UPD
  MOVE *DATN               TO CNT-U.LAST-DATE-UPD
  MOVE *TIMN               TO CNT-U.LAST-TIME-UPD
  UPDATE (2365)
  IF CNT-U.PREFIX-TITLE = ' '              /* NG3
    CNT-U.PREFIX-TITLE := F-DEFAULT-PREFIX (< CNT-U.CONTACT-ID >)
    UPDATE (2365)
    #PREFIX-TITLE := CNT-U.PREFIX-TITLE
    #PREFIX-TITLE-DESC := FUNCTION-PREFIX-DESC(<#PREFIX-TITLE-PARM>)
  END-IF
END-FIND
*
IF #ORIG-ROLE-2-CD = 'S' OR = 'X' OR = 'Y'       /* RE55
  IF #CN > 0                            /* MEMBER
    FIND STATUS WITH ID-NUMBER = #CN    /* Update info of spouse or former spouse who is a member
      IF CNT.LAST-NAME = ' '
        NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,#DEFAULT-LN,CNT.SUFFIX>)
      ELSE
        NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
      END-IF
*       MOVE CNT.GENDER-CD       TO SEX       /* --NA                  /* TT1
*       STATUS.DATE-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38      /* TT1
      MOVE CNT.SSN             TO STATUS.SSN
      IF CNT.SSN-PROTECT = 'Y'
        MOVE 'S' TO CHIEF-OF-STAFF-IND
      ELSE
        IF CHIEF-OF-STAFF-IND = 'S'
          RESET CHIEF-OF-STAFF-IND
        END-IF
      END-IF
      STATUS.DATE-OF-DEATH := FUNCTION-DATE(<#DOD-N>)   /* RE38
      MOVE CNT.BIRTH-CERT-CODE   TO STATUS.BIRTH-CERT-CODE
      MOVE CNT.DEATH-CERT-CODE   TO STATUS.DEATH-CERT-CODE
      MOVE STATUS.DATE-OF-MARRIAGE TO #YYYYMMDD         /* RE41  Save these values
      MOVE STATUS.DATE-OF-DIVORCE TO #YYYYMMDD-2        /* RE41  to compare against
      MOVE STATUS.MARRIAGE-CERT-CODE      TO #SAVE-MCC         /* RE41  Spouse's values below
*      STATUS.DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38        RE45
*      MOVE #MARRIAGE-CERT-CODE TO MARRIAGE-CERT-CODE                      RE45
      MOVE 'A'                 TO ALOT-SW
      MOVE *DATN      TO LAST-FM-DATE
      MOVE *DATN      TO DTS-DATN
      MOVE *TIMN      TO DTS-TIMN
      UPDATE
    END-FIND
  END-IF
*
**DISPLAY #CGA-ORIG-ID #SCR-ROLE-2-CD #ORIG-ROLE-2-CD
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID   /* update info of member's spouse or former spouse
    DECIDE ON FIRST VALUE OF #SCR-ROLE-2-CD                   /* RE55
      VALUE 'S'                                                /* RE55
*    IF #SCR-ROLE-2-CD = 'S'                                   /* RE55
        IF #ORIG-ROLE-2-CD = ' ' OR = 'X' OR = 'Y'               /* RE55
          MOVE 'S'               TO STATUS.STATUS-CODE-SP
**      MOVE FORMER-SPOUSE-CONTACT-ID TO SPOUSE-CONTACT-ID     /* RE55
          MOVE #CO-ID-2 TO SPOUSE-CONTACT-ID                     /* RE55
        END-IF
        PERFORM FORMAT-NAME-SP
*         MOVE CNT.GENDER-CD       TO SEX-SP       /* --NA       /* TT1
*         STATUS.DATE-OF-BIRTH-SP := FUNCTION-DATE(<#DOB-N>)   /* RE38       /* TT1
*      IF #CN > 0                                           /* RE41 to prevent extra TR's   RE54 START
*        IF #YYYYMMDD = STATUS.DATE-OF-MARRIAGE             /* RE41 for widow with CN
*          STATUS.DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
*        END-IF
*      ELSE                                                                                 RE54 END
        STATUS.DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
*      END-IF                                                                               RE54
        IF #DOD NE ' '
          MOVE 'D'               TO STATUS.STATUS-CODE-SP
          STATUS.DATE-OF-DIVORCE := FUNCTION-DATE(<#DOD-N>)   /* RE38
        ELSE
          IF #DIV NE ' '
            IF #CN > 0
              IF #YYYYMMDD = STATUS.DATE-OF-MARRIAGE             /* RE41 for widow with CN
                STATUS.DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
              END-IF
            ELSE
              STATUS.DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
            END-IF
          ELSE
            RESET STATUS.DATE-OF-DIVORCE
            IF STATUS.STATUS-CODE-SP = 'D'
              MOVE 'S' TO STATUS.STATUS-CODE-SP
            END-IF
          END-IF
        END-IF
        MOVE CNT.SSN             TO SSN-SP
        MOVE CNT.BIRTH-CERT-CODE TO BIRTH-CERT-CODE-SP
*      IF #CN > 0                                           /* RE54 START
*        IF #SAVE-MCC = MARRIAGE-CERT-CODE                  /* RE41 to prevent extra TR's
*          MOVE #MARRIAGE-CERT-CODE TO MARRIAGE-CERT-CODE   /* RE41 for widow WITH CN
*        END-IF
*      ELSE                                                 /* RE54 END
        MOVE #MARRIAGE-CERT-CODE TO STATUS.MARRIAGE-CERT-CODE
*      END-IF                                               /* RE54
        IF #SAME-CID
          PERFORM FORMAT-FORMER-SPOUSE-NAME
*           FORMER-SPOUSE-DT-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38         /* TT1
          MOVE CNT.SSN             TO FORMER-SPOUSE-SSN
          MOVE CNT.BIRTH-CERT-CODE TO FS-BIRTH-CERT-CD
        END-IF
        IF #ORIG-ROLE-2-CD = 'X'
          RESET FORMER-SPOUSE-CONTACT-ID FORMER-SPOUSE-NAME FORMER-SPOUSE-SSN 
            STATUS.FORMER-SPOUSE-STATUS FORMER-SPOUSE-DATE-OF-MARRIAGE
            FORMER-SPOUSE-DATE-OF-DIVORCE  FS-BIRTH-CERT-CD FS-MARR-CERT-CD        /* TT1
        ELSE
          IF #ORIG-ROLE-2-CD = 'Y'                                                                            /* RE55 START
            RESET FORMER-HUSBAND-CONTACT-ID FORMER-HUSBAND-NAME FORMER-HUSBAND-SSN FORMER-HUSBAND-SERV-CONN
              FORMER-HUSBAND-SBP-OPTION FORMER-HUSBAND-SBP-AMT FORMER-HUSBAND-VA-CLAIM-NUM FORMER-HUSBAND-DOD
              FORMER-HUSBAND-RANK FORMER-HUSBAND-SOC-SEC-PIA FORMER-HUSBAND-OFFSET-PIA
          END-IF                                                                                              /* RE55 END
        END-IF
*   ELSE
      VALUE 'X'                                              /* RE55
*      IF #SCR-ROLE-2-CD = 'X'                               /* RE55
        IF NOT #FIRST-FORMER-SPOUSE
          MOVE 'F'                 TO STATUS.FORMER-SPOUSE-STATUS
          PERFORM FORMAT-FORMER-SPOUSE-NAME
          FORMER-SPOUSE-DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
          IF #DOD NE ' '
            MOVE 'D'               TO STATUS.FORMER-SPOUSE-STATUS
            FORMER-SPOUSE-DATE-OF-DIVORCE := FUNCTION-DATE(<#DOD-N>)   /* RE38
          ELSE
            IF #DIV NE ' '
              FORMER-SPOUSE-DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
            ELSE
              RESET FORMER-SPOUSE-DATE-OF-DIVORCE
              IF STATUS.STATUS-CODE-SP = 'D'
                MOVE 'S' TO STATUS.STATUS-CODE-SP
              END-IF
            END-IF
          END-IF
*           FORMER-SPOUSE-DT-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38      /* TT1
          MOVE CNT.SSN             TO FORMER-SPOUSE-SSN
          MOVE CNT.BIRTH-CERT-CODE TO FS-BIRTH-CERT-CD
          MOVE #MARRIAGE-CERT-CODE TO FS-MARR-CERT-CD
          IF #SAME-CID
            PERFORM FORMAT-NAME-SP
*             DATE-OF-BIRTH-SP := FUNCTION-DATE(<#DOB-N>)   /* RE38             /* TT1
            MOVE CNT.SSN             TO SSN-SP
            MOVE CNT.BIRTH-CERT-CODE TO BIRTH-CERT-CODE-SP
          END-IF
          IF #ORIG-ROLE-2-CD = 'S'
            MOVE SPOUSE-CONTACT-ID TO FORMER-SPOUSE-CONTACT-ID
            RESET SPOUSE-CONTACT-ID NAME-SP  SSN-SP STATUS.STATUS-CODE-SP STATUS.DATE-OF-DIVORCE /* TT1
              STATUS.DATE-OF-MARRIAGE BIRTH-CERT-CODE-SP TITLE-SP MAILING-FLAG-SP STATUS.MARRIAGE-CERT-CODE
          ELSE
            IF #ORIG-ROLE-2-CD = 'Y'                                                                            /* RE55 START
              MOVE FORMER-HUSBAND-CONTACT-ID TO FORMER-SPOUSE-CONTACT-ID
              RESET FORMER-HUSBAND-CONTACT-ID FORMER-HUSBAND-NAME FORMER-HUSBAND-SSN FORMER-HUSBAND-SERV-CONN
                FORMER-HUSBAND-SBP-OPTION FORMER-HUSBAND-SBP-AMT FORMER-HUSBAND-VA-CLAIM-NUM FORMER-HUSBAND-DOD
                FORMER-HUSBAND-RANK FORMER-HUSBAND-SOC-SEC-PIA FORMER-HUSBAND-OFFSET-PIA
            END-IF                                                                                              /* RE55 END
          END-IF
        END-IF
*      ELSE                                                     /* RE55 START
      VALUE 'Y'
        MOVE #CO-ID-2 TO FORMER-HUSBAND-CONTACT-ID
        PERFORM FORMAT-FORMER-HUSBAND-NAME
        MOVE CNT.SSN                TO FORMER-HUSBAND-SSN
        FORMER-HUSBAND-DOD := FUNCTION-DATE(<#DOD-N>)
        IF #ORIG-ROLE-2-CD = 'S'
          RESET SPOUSE-CONTACT-ID NAME-SP  SSN-SP STATUS.STATUS-CODE-SP STATUS.DATE-OF-DIVORCE /* TT1
            STATUS.DATE-OF-MARRIAGE BIRTH-CERT-CODE-SP TITLE-SP MAILING-FLAG-SP STATUS.MARRIAGE-CERT-CODE
        ELSE
          IF #ORIG-ROLE-2-CD = 'X'
            RESET FORMER-SPOUSE-CONTACT-ID FORMER-SPOUSE-NAME FORMER-SPOUSE-SSN 
              STATUS.FORMER-SPOUSE-STATUS FORMER-SPOUSE-DATE-OF-MARRIAGE
              FORMER-SPOUSE-DATE-OF-DIVORCE  FS-BIRTH-CERT-CD FS-MARR-CERT-CD                  /* TT1
          END-IF
        END-IF
      NONE                                                      /* RE55 END
        IF #ORIG-ROLE-2-CD = 'S'
          RESET SPOUSE-CONTACT-ID NAME-SP  SSN-SP STATUS.STATUS-CODE-SP STATUS.DATE-OF-DIVORCE /* TT1
            STATUS.DATE-OF-MARRIAGE BIRTH-CERT-CODE-SP TITLE-SP MAILING-FLAG-SP STATUS.MARRIAGE-CERT-CODE
        ELSE
          IF #ORIG-ROLE-2-CD = 'X'
            RESET FORMER-SPOUSE-CONTACT-ID FORMER-SPOUSE-NAME FORMER-SPOUSE-SSN 
              STATUS.FORMER-SPOUSE-STATUS FORMER-SPOUSE-DATE-OF-MARRIAGE
              FORMER-SPOUSE-DATE-OF-DIVORCE  FS-BIRTH-CERT-CD FS-MARR-CERT-CD         /* TT1
          ELSE
            IF #ORIG-ROLE-2-CD = 'Y'                                                                             /* RE55 START
              RESET FORMER-HUSBAND-CONTACT-ID FORMER-HUSBAND-NAME FORMER-HUSBAND-SSN FORMER-HUSBAND-SERV-CONN
                FORMER-HUSBAND-SBP-OPTION FORMER-HUSBAND-SBP-AMT FORMER-HUSBAND-VA-CLAIM-NUM FORMER-HUSBAND-DOD
                FORMER-HUSBAND-RANK FORMER-HUSBAND-SOC-SEC-PIA FORMER-HUSBAND-OFFSET-PIA
            END-IF                                                                                                /* RE55 END
          END-IF
        END-IF
    END-DECIDE                        /* RE55 START
**    END-IF                          /* RE55 END
    MOVE *DATN      TO LAST-FM-DATE
    MOVE *DATN      TO DTS-DATN
    MOVE *TIMN      TO DTS-TIMN
    UPDATE(2472)
  END-FIND
ELSE
  IF #CN > 0                                                                                      /* MEMBER
    FIND STATUS WITH ID-NUMBER = #CN
      IF CNT.CONTACT-TYPE = 'O'                       /* RE44
        NAME := CNT.FIRM-ORGANIZATION-NAME            /* RE44
      ELSE
        IF CNT.LAST-NAME = ' '
          NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,#DEFAULT-LN,CNT.SUFFIX>)
        ELSE
          NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
        END-IF
      END-IF
*       MOVE CNT.GENDER-CD       TO SEX       /* --NA                           /* TT1
*       STATUS.DATE-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38               /* TT1
      MOVE CNT.SSN             TO STATUS.SSN
      STATUS.DATE-OF-DEATH := FUNCTION-DATE(<#DOD-N>)   /* RE38
*      MOVE #MARRIAGE-CERT-CODE TO MARRIAGE-CERT-CODE
      MOVE CNT.BIRTH-CERT-CODE TO STATUS.BIRTH-CERT-CODE
      MOVE CNT.DEATH-CERT-CODE TO STATUS.DEATH-CERT-CODE        /* RE24
      IF CNT.SSN-PROTECT = 'Y'
        MOVE 'S' TO CHIEF-OF-STAFF-IND
      ELSE
        IF CHIEF-OF-STAFF-IND = 'S'
          RESET CHIEF-OF-STAFF-IND
        END-IF
      END-IF
      MOVE 'A'        TO ALOT-SW
      MOVE *DATN      TO LAST-FM-DATE
      MOVE *DATN      TO DTS-DATN
      MOVE *TIMN      TO DTS-TIMN
      UPDATE (2621)
    END-FIND
  END-IF
*
  IF #SCR-ROLE-2-CD = 'S' OR = 'X'
    FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
      IF #SCR-ROLE-2-CD = 'S'
        MOVE 'S'               TO STATUS.STATUS-CODE-SP
        MOVE #CO-ID-2          TO SPOUSE-CONTACT-ID      /* RE32
        PERFORM FORMAT-NAME-SP
*         MOVE CNT.GENDER-CD       TO SEX-SP       /* --NA             /* TT1
*         STATUS.DATE-OF-BIRTH-SP := FUNCTION-DATE(<#DOB-N>)   /* RE38 /* TT1
        STATUS.DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
        IF #DOD NE ' '
          MOVE 'D'               TO STATUS.STATUS-CODE-SP
          STATUS.DATE-OF-DIVORCE := FUNCTION-DATE(<#DOD-N>)   /* RE38
        ELSE
          IF #DIV NE ' '
            STATUS.DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
          ELSE
            RESET STATUS.DATE-OF-DIVORCE
            IF STATUS.STATUS-CODE-SP = 'D'
              MOVE 'S' TO STATUS.STATUS-CODE-SP
            END-IF
          END-IF
        END-IF
        MOVE CNT.SSN             TO SSN-SP
        MOVE CNT.BIRTH-CERT-CODE   TO BIRTH-CERT-CODE-SP
      ELSE
        MOVE 'F'                 TO STATUS.FORMER-SPOUSE-STATUS
        MOVE #CO-ID-2            TO FORMER-SPOUSE-CONTACT-ID  /* RE32
        PERFORM FORMAT-FORMER-SPOUSE-NAME
        STATUS.FORMER-SPOUSE-DATE-OF-MARRIAGE := FUNCTION-DATE(<#DOM-N>)   /* RE38
        IF #DOD NE ' '
          MOVE 'D'               TO STATUS.STATUS-CODE-SP
          STATUS.FORMER-SPOUSE-DATE-OF-DIVORCE := FUNCTION-DATE(<#DOD-N>)   /* RE38
        ELSE
          IF #DIV NE ' '
            STATUS.FORMER-SPOUSE-DATE-OF-DIVORCE := FUNCTION-DATE(<#DIV-N>)   /* RE38
          ELSE
            RESET FORMER-SPOUSE-DATE-OF-DIVORCE
            IF STATUS.STATUS-CODE-SP = 'D'
              MOVE 'S' TO STATUS.STATUS-CODE-SP
            END-IF
          END-IF
        END-IF
*         STATUS.FORMER-SPOUSE-DT-OF-BIRTH := FUNCTION-DATE(<#DOB-N>)   /* RE38       /* TT1
        MOVE CNT.SSN             TO FORMER-SPOUSE-SSN
        MOVE CNT.BIRTH-CERT-CODE TO FS-BIRTH-CERT-CD
        MOVE #MARRIAGE-CERT-CODE TO FS-MARR-CERT-CD
      END-IF
      MOVE *DATN      TO LAST-FM-DATE
      MOVE *DATN      TO DTS-DATN
      MOVE *TIMN      TO DTS-TIMN
      UPDATE (2654)
    END-FIND
  END-IF
*
  IF #SCR-ROLE-2-CD = 'Y'                                          /* RE55 START
    FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
      PERFORM FORMAT-FORMER-HUSBAND-NAME
      MOVE #CID           TO FORMER-HUSBAND-CONTACT-ID
      MOVE CNT.SSN        TO FORMER-HUSBAND-SSN
      FORMER-HUSBAND-DOD  := FUNCTION-DATE(<#DOD-N>)
      UPDATE
    END-FIND
  END-IF                                                           /* RE55 END
*
  IF #ORIG-ROLE-2-CD = 'K' OR = 'G' OR = 'D'                                                        /* DEPENDENT
    FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID
      FOR #I 1 60
        IF DEPN-CONTACT-ID(#I) = #CO-ID-2
          IF NOT (#SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D') /* DEPENDENT CHANGED TO OTHER
            MOVE DEPN-CONTACT-ID(#I+1:60)      TO DEPN-CONTACT-ID(#I:59)
            MOVE DEPN-NAME(#I+1:60)            TO DEPN-NAME(#I:59)
            MOVE DEPN-DATE-OF-BIRTH(#I+1:60)   TO DEPN-DATE-OF-BIRTH(#I:59)
            MOVE DEPN-SSN(#I+1:60)             TO DEPN-SSN(#I:59)
            MOVE DEPN-BIRTH-CD(#I+1:60)        TO DEPN-BIRTH-CD(#I:59)
            MOVE DEPN-STATUS-CD(#I+1:60)       TO DEPN-STATUS-CD(#I:59)
            MOVE DEPN-REMARKS(#I+1:60)         TO DEPN-REMARKS(#I:59)
            MOVE DEPN-COLL-FUND(#I+1:60)       TO DEPN-COLL-FUND(#I:59)
            MOVE DEPN-COLL-TYPE(#I+1:60)       TO DEPN-COLL-TYPE(#I:59)
            MOVE DEPN-COLL-FROM-YYYY(#I+1:60)  TO DEPN-COLL-FROM-YYYY(#I:59)
            MOVE DEPN-COLL-THRU-YYYY(#I+1:60)  TO DEPN-COLL-THRU-YYYY(#I:59)
            MOVE DEPN-COLL-ANN-COST(#I+1:60)   TO DEPN-COLL-ANN-COST(#I:59)
          ELSE                                                   /* DEPENDENT
            COMPRESS CNT.FIRST-NAME CNT.MIDDLE-NAME INTO DEPN-NAME(#I)
            IF CNT.SUFFIX NE ' '
              COMPRESS DEPN-NAME(#I) ',' INTO DEPN-NAME(#I) LEAVING NO
              COMPRESS DEPN-NAME(#I) CNT.SUFFIX INTO DEPN-NAME(#I)
            END-IF
            IF #ORIG-ROLE-2-CD = 'G' AND (#ORIG-ROLE-2-CD NE #SCR-ROLE-2-CD)     /* RE
              RESET DEPN-STATUS-CD(#I)
            END-IF
            IF #ORIG-ROLE-2-CD = 'K' OR = 'D' AND #SCR-ROLE-2-CD = 'G'           /* RE
              MOVE 'G' TO DEPN-STATUS-CD(#I)
            END-IF
            IF #DOD NE ' '                                                 /* RE15
              MOVE 'D'               TO DEPN-STATUS-CD(#I)                 /* RE15
            ELSE
              IF DEPN-STATUS-CD(#I) = 'D'                                  /* RE54
                RESET  DEPN-STATUS-CD(#I)                                  /* RE54
              END-IF                                                       /* RE54
            END-IF                                                         /* RE15
            DEPN-DATE-OF-BIRTH(#I) := FUNCTION-DATE(<#DOB-N>)   /* RE38
            MOVE CNT.SSN             TO DEPN-SSN(#I)           /* D
            MOVE CNT.BIRTH-CERT-CODE TO DEPN-BIRTH-CD(#I)
          END-IF
          ESCAPE BOTTOM
        END-IF
      END-FOR
      MOVE *DATN      TO FIRS.DP-LAST-FM-DATE
      MOVE *DATN      TO FIRS.DTS-DATN
      MOVE *TIMN      TO FIRS.DTS-TIMN
      UPDATE
    END-FIND
  END-IF
END-IF                                                         /* RE55
*
IF (#ORIG-ROLE-2-CD = 'A' OR = 'B' OR = 'E' OR = 'F' OR = 'I' OR = 'P' OR = 'R' OR = 'T' OR = 'O' /* RE12 Other
    OR = 'H' OR = 'Z' OR = 'U' OR = 'W' OR = 'L' OR = 'V' OR = 'J' OR = 'C' OR = 'Y'                       /* RE21 RE25 RE36 RE41 RE55
    OR = 'S' OR = 'X')                                                                            /* RE55 Spouse/Former Spouse
    AND (#SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D')      /* CHANGED TO DEPENDENT
  FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID
    FOR #I 1 60
      IF DEPN-CONTACT-ID(#I) = 0
        MOVE #CO-ID-2            TO DEPN-CONTACT-ID(#I)
        COMPRESS CNT.FIRST-NAME CNT.MIDDLE-NAME INTO DEPN-NAME(#I)
        IF CNT.SUFFIX NE ' '
          COMPRESS DEPN-NAME(#I) ',' INTO DEPN-NAME(#I) LEAVING NO
          COMPRESS DEPN-NAME(#I) CNT.SUFFIX INTO DEPN-NAME(#I)
        END-IF
        IF #SCR-ROLE-2-CD = 'G'                                /* RE55
          MOVE 'G'               TO DEPN-STATUS-CD(#I)         /* RE55
        END-IF                                                 /* RE55
        IF #DOD NE ' '                                                 /* RE15
          MOVE 'D'               TO DEPN-STATUS-CD(#I)                 /* RE15
        END-IF                                                         /* RE15
        DEPN-DATE-OF-BIRTH(#I) := FUNCTION-DATE(<#DOB-N>)   /* RE38
        MOVE CNT.SSN             TO DEPN-SSN(#I)           /* D
        MOVE CNT.BIRTH-CERT-CODE TO DEPN-BIRTH-CD(#I)
        ESCAPE BOTTOM
      END-IF
    END-FOR
    MOVE *DATN      TO FIRS.DP-LAST-FM-DATE
    MOVE *DATN      TO FIRS.DTS-DATN
    MOVE *TIMN      TO FIRS.DTS-TIMN
    UPDATE
  END-FIND
  IF #ORIG-ROLE-2-CD = 'Y'
    PERFORM RESET-FORMER-HUSBAND
  END-IF
END-IF
**END-IF                                                     /* RE55
*
IF #ORIG-ROLE-2-CD NE #SCR-ROLE-2-CD
  FIND CNT-REL-U WITH CONTACT-2-ID = #CO-ID-2
    IF CONTACT-1-ID = #CO-ID-1
      MOVE #SCR-ROLE-2-CD TO CNT-REL-U.ROLE-2-CD
      DECIDE ON FIRST VALUE OF #SCR-ROLE-2-CD
        VALUE 'S'
          MOVE 'S' TO CNT-REL-U.ROLE-1-CD
        VALUE 'X'
          MOVE 'X' TO CNT-REL-U.ROLE-1-CD
        VALUE 'K','G','D'
          MOVE 'P' TO CNT-REL-U.ROLE-1-CD
        NONE
          MOVE 'M' TO CNT-REL-U.ROLE-1-CD
      END-DECIDE
      MOVE #CGA-CLERK     TO CNT-REL-U.LAST-USER-UPD
      MOVE *DATN          TO CNT-REL-U.LAST-DATE-UPD
      MOVE *TIMN          TO CNT-REL-U.LAST-TIME-UPD
      UPDATE
      ESCAPE BOTTOM
    END-IF
  END-FIND
END-IF
MOVE 'Record successfully updated.' TO #MSG
*
END-SUBROUTINE
********************************
DEFINE SUBROUTINE FORMAT-NAME-SP
********************************
IF CNT.LAST-NAME = ' '
  STATUS.NAME-SP := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,#DEFAULT-LN,CNT.SUFFIX>)
ELSE
  STATUS.NAME-SP := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
END-IF
*
END-SUBROUTINE
*******************************************
DEFINE SUBROUTINE FORMAT-FORMER-SPOUSE-NAME
*******************************************
IF CNT.LAST-NAME = ' '
  FORMER-SPOUSE-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,#DEFAULT-LN,CNT.SUFFIX>)
ELSE
  FORMER-SPOUSE-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
END-IF
*
END-SUBROUTINE
********************************************
DEFINE SUBROUTINE FORMAT-FORMER-HUSBAND-NAME      /* RE55
********************************************
IF CNT.LAST-NAME = ' '
  FORMER-HUSBAND-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,#DEFAULT-LN,CNT.SUFFIX>)
ELSE
  FORMER-HUSBAND-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
END-IF
*
END-SUBROUTINE
**************************************
DEFINE SUBROUTINE RESET-FORMER-HUSBAND      /* RE55
**************************************
FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
  RESET FORMER-HUSBAND-CONTACT-ID FORMER-HUSBAND-NAME FORMER-HUSBAND-SSN FORMER-HUSBAND-SERV-CONN
    FORMER-HUSBAND-SBP-OPTION FORMER-HUSBAND-SBP-AMT FORMER-HUSBAND-VA-CLAIM-NUM FORMER-HUSBAND-DOD
    FORMER-HUSBAND-RANK FORMER-HUSBAND-SOC-SEC-PIA FORMER-HUSBAND-OFFSET-PIA
  UPDATE
END-FIND
*
END-SUBROUTINE
*******************************
DEFINE SUBROUTINE DELETE-RECORD
*******************************
RESET #CONFIRM-DELETE #DONT-DELETE
IF #SAME-CID
  MOVE TRUE TO #DONT-DELETE
END-IF
#DEL-NAME := FUNCTION-DISP-CT-NAME(<CNT.FIRST-NAME,CNT.MIDDLE-NAME,CNT.LAST-NAME,CNT.SUFFIX>)
MOVE CNT.SSN TO #DEL-SSN
SET WINDOW 'Confirm-Delete'
REPEAT
  INPUT WINDOW='Confirm-Delete' USING MAP 'C2232MCB'
  IF *PF-KEY = #EXIT-KEY (*) OR #CONFIRM-DELETE = 'N'
    ESCAPE BOTTOM
  END-IF
  IF #CONFIRM-DELETE = 'Y'
    RESET #X-DELETED
    IF #MSG-ISN-N > 0                  /* RE27
      GET CNT-REL-S #MSG-ISN-N               /* RE27
      DELETE (2888)                    /* RE27
    ELSE
      FIND CNT-REL-S WITH CONTACT-2-ID = #CO-ID-2       /* Checks for other existing relationships
        IF CONTACT-1-ID NE #CO-ID-1
          MOVE TRUE TO #DONT-DELETE                     /* Don't tag for deletion
        ELSE
          IF (#SCR-ROLE-2-CD = ROLE-2-CD AND NOT #X-DELETED) OR
              (#SCR-ROLE-2-CD NE ROLE-2-CD AND #CGA-CLERK = 'KEC')  /* RE8  Temp only to fix issue of same person but different roles (e.g., Spouse and Dependent)
            DELETE
            IF ROLE-2-CD = 'X'
              MOVE TRUE TO #X-DELETED
            END-IF
          END-IF
        END-IF
      END-FIND
*
      IF NOT #DONT-DELETE
        FIND CNT-U WITH CONTACT-ID = #CO-ID-2
          MOVE 'Y' TO DELETE-FLAG            /* RE11
          MOVE #CGA-CLERK          TO CNT-U.LAST-USER-UPD
          MOVE *DATN               TO CNT-U.LAST-DATE-UPD
          MOVE *TIMN               TO CNT-U.LAST-TIME-UPD
          UPDATE                             /* RE11
        END-FIND
        IF CNT-U.ID-NUMBER = 0
          PERFORM DELETE-ADDR-RELATIONSHIPS
        END-IF
      END-IF
    END-IF
*
    MOVE TRUE TO #SYNCHRONIZE
    MOVE 'Record successfully deleted.' TO #MSG
    ESCAPE BOTTOM
  END-IF
END-REPEAT
SET WINDOW OFF
*
END-SUBROUTINE
*
************************************
DEFINE SUBROUTINE DELETE-STATUS-FIRS
************************************
IF #ORIG-ROLE-2-CD = 'G' OR = 'K' OR = 'D'         /* Remove Dependent info from Member's record in A-FIRS
  FIND FIRS WITH ID-NUMBER = #CGA-ORIG-ID
    FOR #I 1 60
      IF DEPN-CONTACT-ID(#I) = #CO-ID-2
        MOVE BY NAME DEPENDENT-TABLE(#I+1:60) TO DEPENDENT-TABLE(#I:59)
        MOVE BY NAME DEPN-COLL-FUND-TBL(#I+1:60) TO DEPN-COLL-FUND-TBL(#I:59)
        MOVE BY NAME DEPN-COLL-TYPE-TBL(#I+1:60) TO DEPN-COLL-TYPE-TBL(#I:59)
        MOVE BY NAME DEPN-COLL-INFO-TBL(#I+1:60) TO DEPN-COLL-INFO-TBL(#I:59)
        RESET DEPENDENT-TABLE(60) DEPN-COLL-FUND-TBL(60) DEPN-COLL-TYPE-TBL(60)
          DEPN-COLL-INFO-TBL(60)
        ESCAPE BOTTOM
      END-IF
    END-FOR
    MOVE *DATN      TO FIRS.DP-LAST-FM-DATE
    MOVE *DATN      TO FIRS.DTS-DATN
    MOVE *TIMN      TO FIRS.DTS-TIMN
    UPDATE
  END-FIND
END-IF              /* RE8
**ELSE              /* RE8
IF #ORIG-ROLE-2-CD = 'S' OR = 'X'               /* Remove Spouse/Former Spouse info from Member's record in A-STATUS
  FIND STATUS WITH ID-NUMBER = #CGA-ORIG-ID
    IF #ORIG-ROLE-2-CD = 'S' OR (#ORIG-ROLE-2-CD = 'X' AND STATUS.STATUS-CODE-SP = 'F')
      RESET STATUS.SPOUSE-CONTACT-ID STATUS.STATUS-CODE-SP  STATUS.DATE-OF-DIVORCE STATUS.SSN-SP     /* TT1
        STATUS.NAME-SP  STATUS.DATE-OF-MARRIAGE STATUS.BIRTH-CERT-CODE-SP STATUS.MARRIAGE-CERT-CODE STATUS.TITLE-SP
        STATUS.MAILING-FLAG-SP
    ELSE
      RESET FORMER-SPOUSE-CONTACT-ID FORMER-SPOUSE-NAME FORMER-SPOUSE-SSN STATUS.FORMER-SPOUSE-STATUS FORMER-SPOUSE-DATE-OF-MARRIAGE
        FORMER-SPOUSE-DATE-OF-DIVORCE  FS-BIRTH-CERT-CD FS-MARR-CERT-CD   /* TT1
    END-IF
    MOVE *DATN      TO STATUS.LAST-FM-DATE
    MOVE *DATN      TO STATUS.DTS-DATN
    MOVE *TIMN      TO STATUS.DTS-TIMN
    UPDATE
  END-FIND
END-IF
*
IF #ORIG-ROLE-2-CD = 'Y'                      /* Remove Former Husband info from Member's record in A-STATUS
  PERFORM RESET-FORMER-HUSBAND
END-IF
**END-IF           /* RE8
*
END-SUBROUTINE
*
*********************************
DEFINE SUBROUTINE WRITE-TRANS-REG
*********************************
IF #CO-ID-2 = 0             /* Add Contact
  MOVE #SCR-ROLE-2-CD TO #ORIG-ROLE-2-CD
ELSE
  IF NOT #CONF-SEL AND NOT (#ORGANIZATION OR #MEMBER-ORG)  /* RE35 START  Change reason only for existing contact /* RE47
    IF CNT.FIRST-NAME  NE #SAVE-FIRST-NAME OR              /*             and not Funeral and Trusts
        CNT.LAST-NAME   NE #SAVE-LAST-NAME OR
        CNT.MIDDLE-NAME NE #SAVE-MIDDLE-NAME OR
        CNT.SUFFIX      NE #SAVE-SUFFIX
      CALLNAT 'GONMN001' #NAME-CHANGE-CODE #NAME-CHANGE-DESC
    END-IF
  END-IF
*  ELSE                                       /* RE35 END
*    IF #MEMBER OR #MEMBER-ORG
*      MOVE '#' TO #OLD-ROLE #SCR-ROLE-2-CD    /* RE39  TO ENSURE 'ROLE' DOESN'T APPEAR IN TR FOR NON-CB
*    END-IF
*  END-IF
END-IF
IF #MEMBER OR #MEMBER-ORG               /* RE40 Only for CB
  MOVE 'M' TO #OLD-ROLE      /* RE40
END-IF                       /* RE40
MOVE *TIMN TO #HOLD-TIME
COMPRESS #YYYY-B #MM-B #DD-B INTO #YYYYMMDD-A LEAVING NO
MOVE #YYYYMMDD           TO #DOB-2
COMPRESS #YYYY-M #MM-M #DD-M INTO #YYYYMMDD-A LEAVING NO
MOVE #YYYYMMDD           TO #DOM-2
COMPRESS #YYYY-V #MM-V #DD-V INTO #YYYYMMDD-A LEAVING NO
MOVE #YYYYMMDD           TO #DIV-2
COMPRESS #YYYY-D #MM-D #DD-D INTO #YYYYMMDD-A LEAVING NO
MOVE #YYYYMMDD           TO #DOD-2
IF #CONFIRM-DELETE = 'Y'
  IF #SCR-ROLE-2-CD = 'S' OR = 'X' AND #HOLD-ST-ISN > 0    /* RE11 Start
    MOVE #HOLD-ST-ISN TO #ST-ISN
  ELSE
    IF #SCR-ROLE-2-CD = 'K' OR = 'G' OR = 'D' AND #HOLD-FIRS-ISN > 0
      MOVE #HOLD-FIRS-ISN TO #FIRS-ISN
    END-IF
  END-IF                                                   /* RE11 End
  RESET CNT.FIRST-NAME CNT.MIDDLE-NAME CNT.LAST-NAME CNT.SUFFIX
    #DOB-2 #DOM-2 #DIV-2 CNT.SSN
END-IF
*
MOVE #CGA-ORIG-ID TO #PARM-CN             /* RE57 START
MOVE #MEMBER-NAME-25 TO #PARM-NAME
MOVE #SCR-ROLE-2-CD TO #PARM-ROLE-CD
PERFORM CALL-TR-ROUTINE                   /* RE57 END
*
IF #RESPONSE = 'Y'                                                    /* RE57 START
  FIND CNT-REL-U WITH CONTACT-2-ID = #CO-ID-2
    ACCEPT IF CNT-REL-U.CONTACT-1-ID NE #CO-ID-1
    FIND CNT-S WITH CONTACT-ID = CNT-REL-U.CONTACT-1-ID
    END-FIND
    MOVE CNT-S.ID-NUMBER TO #PARM-CN
    MOVE '!SCREEN' TO #ADMIN-SCREEN                     /* bz-Name-C
    CALLNAT 'GPRS0CNT' CNT-REL-U.CONTACT-1-ID #ADMIN-SCREEN
    MOVE #ADMIN-SCREEN TO #PARM-NAME
    MOVE #SCR-ROLE-2-CD TO #PARM-ROLE-CD
    PERFORM CALL-TR-ROUTINE
    MOVE #SCR-ROLE-2-CD TO CNT-REL-U.ROLE-2-CD
    MOVE #CGA-CLERK     TO CNT-REL-U.LAST-USER-UPD
    MOVE *DATN          TO CNT-REL-U.LAST-DATE-UPD
    MOVE *TIMN          TO CNT-REL-U.LAST-TIME-UPD
    UPDATE (3025)
  END-FIND
END-IF                                                                /* RE57 END
**IF #CN > 0
**  MOVE 'M' TO #OLD-ROLE
**END-IF
**DISPLAY #CN #CGA-ORIG-ID #CGA-ORIG-COMMAND
**PRINT '=' #OLD-ROLE '='#OLD-MCC '='#MARRIAGE-CERT-CODE
IF #OLD-ROLE = #SCR-ROLE-2-CD      /* RE54 START
  MOVE 'M' TO #OLD-ROLE
END-IF
FIND STATUS-2 WITH ID-NUMBER = #CN
END-FIND                           /* RE54 END
*
IF #CN > 0 AND #CN <>  #CGA-ORIG-ID AND (#CGA-ORIG-COMMAND = 'CB')  /* Second TR call is for those with CN
  MOVE #CN TO #PARM-CN                                              /* so that a TR record is also created    RE57
  MOVE STATUS-2.NAME TO #PARM-NAME
  IF #RESPONSE = 'Y'                                /* RE57
    MOVE #SCR-ROLE-2-CD TO #PARM-ROLE-CD            /* RE57
  ELSE                                              /* RE57
    MOVE 'M' TO #PARM-ROLE-CD
  END-IF                                            /* RE57
  PERFORM CALL-TR-ROUTINE                                                                                  /* RE57
END-IF
*
MOVE #SCR-ROLE-2-CD TO #OLD-ROLE   /* RE54
IF #MEMBER OR #MEMBER-ORG
  MOVE 'M' TO #SCR-ROLE-2-CD
END-IF
*
IF  CNT.DATE-OF-DEATH = 0 AND #DOD-N > 0 AND #SCR-ROLE-2-CD = 'S'     /* RE7 Start
  RESET MBRSHIP-MTD-DET-V
  COMPUTE MBRSHIP-MTD-DET-V.ENTRY-DATE = 99999999 - *DATN
  MOVE #ST-ISN           TO MBRSHIP-MTD-DET-V.REC-ISN
  MOVE 'W'               TO MBRSHIP-MTD-DET-V.CODE
  MOVE #CGA-ORIG-ID      TO MBRSHIP-MTD-DET-V.ID-NUMBER
*
  IF #WIDOW-FLAG = 'Y'
    IF STATUS.PROCESS-IND = 'G'                                      /* vt1  \/
      MOVE 99999999 TO MBRSHIP-MTD-DET-V.ISSUE-DATE
    ELSE
      MOVE 60606060 TO MBRSHIP-MTD-DET-V.ISSUE-DATE
    END-IF                                                           /* vt1  /\
  ELSE
    MOVE 88888888 TO MBRSHIP-MTD-DET-V.ISSUE-DATE
  END-IF
*
  MOVE 0          TO MBRSHIP-MTD-DET-V.NUM-MBRSHIPS
  STORE MBRSHIP-MTD-DET-V
END-IF                                                               /* RE7 End
*
IF #CONT-ISN > 0               /* RE11 Start
  GET CNT-U #CONT-ISN
  IF CNT-U.ID-NUMBER > 0
    MOVE 'N' TO CNT-U.DELETE-FLAG
    UPDATE (3091)
  ELSE
    IF CNT-U.DELETE-FLAG = 'Y'
      DELETE (3091)
    END-IF
  END-IF
END-IF                         /* RE11 End
*
END-SUBROUTINE
*********************************
DEFINE SUBROUTINE CALL-TR-ROUTINE  /* RE57
*********************************
MOVE CNT.CONTACT-TYPE TO #PARM-CONTACT-TYPE
CALLNAT 'C2230SCB'
  #OLD-VALUES
  #PARM-CN
  #CGA-ORIG-COMMAND   /* RE41
*  STATUS.NAME
  #PARM-NAME     /* RE50
  STATUS.LAST-FM-DATE
  #CGA-CLERK
  #HOLD-TIME
  #PARM-ROLE-CD
  CNT.FIRST-NAME
  CNT.MIDDLE-NAME
  CNT.LAST-NAME
  CNT.SUFFIX
*  #DOB-2     /* RE39 START
*  #DOM-2
*  #DIV-2
  #DOB
  #DOM
  #DIV        /* RE39 END
  CNT.SSN
  CNT.GENDER-CD
  CNT.BIRTH-CERT-CODE
  CNT.DEATH-CERT-CODE  /* RE24
  #MARRIAGE-CERT-CODE  /* RE39
  #DOD        /* RE39
  CNT.FIRM-ORGANIZATION-NAME /* RE35
  CNT.SSN-PROTECT
  #PREFIX-TITLE
  #NAME-CHANGE-DESC  /* RE35
  #STATUS-CODE
  CNT.WEBSITE-URL    /* RE35
  #EST-DATE          /* RE39
  CNT.FIRM-CERT-CODE /* RE39
  CNT.CONTACT-REMARKS(*) /* RE39
  #PARM-CONTACT-TYPE   /* RE57
  #PARM-MESSAGE      /* RE57
*
END-SUBROUTINE
*******************************************
DEFINE SUBROUTINE DELETE-ADDR-RELATIONSHIPS
*******************************************
FIND ADDR-REL-V WITH CONTACT-ID = #CO-ID-2
  IF FUNCTION-FIND-NUMBER(<ADDRESS-POOL-ID>)  /* Delete ADDRESS POOL record if address is not shared
    FIND ADDR-POOL-V WITH ADDRESS-POOL-ID = ADDR-REL-V.ADDRESS-POOL-ID
      DELETE
    END-FIND
  END-IF
  DELETE
END-FIND
*
FIND CNT-EMAIL-V WITH CONTACT-ID = #CO-ID-2
  DELETE
END-FIND
*
FIND CNT-PHONE-V WITH CONTACT-ID = #CO-ID-2
  DELETE
END-FIND
*
END-SUBROUTINE
********************************
DEFINE SUBROUTINE VALIDATE-NAMES                   /*  bz1
********************************                                                               /*  bz1
EXAMINE FULL v_A25 FOR FULL " " REPLACE "Z"        /*  bz1
EXAMINE v_A25 FOR '-' REPLACE 'Z'                  /*  bz1
EXAMINE v_A25 FOR "'" REPLACE 'Z'                  /*  bz1
EXAMINE v_A25 FOR '"' REPLACE 'Z'                  /*  bz1
EXAMINE v_A25 FOR '/' REPLACE 'Z'                  /*  bz1
IF  v_A25 NE MASK(UUUUUUUUUUUUUUUUUUUUUUUUU)       /*  bz1
  #MSG := "Incorrect symbol"                     /*  bz1
  ESCAPE ROUTINE                                 /*  bz1
END-IF
*                                            /*  bz1
END-SUBROUTINE                                     /*  bz1
*********************************
DEFINE SUBROUTINE PROCESS-FUNERAL
*********************************
CALLNAT 'DNXUN07A' #CO-ID-1 #CO-ID-2 #CGA-USER-COMPANY #CGA-CLERK #MSG
*
END-SUBROUTINE
*******************************
DEFINE SUBROUTINE SYNC-WITH-CRM
*******************************
#REQUEST := 'FAMILY'
CALLNAT 'MBRCRC' #CO-ID-2    /* CRM SYNC PROCESS
  #REQUEST
*
END-SUBROUTINE
*
END
