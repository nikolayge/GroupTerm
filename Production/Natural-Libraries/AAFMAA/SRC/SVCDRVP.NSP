* >Natural Source Header 000000
* :Mode S
* :CP ISO_8859-1:1987
* :LineIncrement 10
* <Natural Source Header
*
DEFINE DATA
LOCAL
1 #CONTACT-ID    (N8)
1 #PLAN          (A3)
1 #MODE          (A1)
1 #AGE           (N3)
1 #AT-NUMBER     (N6)
1 #SERVICE-ID    (A12)
1 #REQUEST-ID    (A1)  /* Rate or Service
1 #REQUEST       (A) DYNAMIC
1 #RESPONSE-DATA (A) DYNAMIC
1 #FUNCTION-NAME (A) DYNAMIC
1 #RESPONSE-TEXT (A700) 1 REDEFINE #RESPONSE-TEXT
  2 #LINES  (A70/10)
*
1 #SERVICE-RATES    (A24) CONST <'Service Rates'>
1 #SERVICE-REQUEST  (A24) CONST <'Service Request'>
*
END-DEFINE
*
SET KEY PF3
*
INPUT USING MAP 'SVCDRVM'
REPEAT UNTIL *PF-KEY = 'PF3'
  PERFORM GENERATE-REQUEST
  CALLNAT 'MBRSRV' #FUNCTION-NAME #REQUEST #RESPONSE-DATA
  #RESPONSE-TEXT := #RESPONSE-DATA
  INPUT USING MAP 'SVCDRVM'
END-REPEAT
*
DEFINE GENERATE-REQUEST
/*     ================
IF #REQUEST-ID = 'R'
  COMPRESS NUMERIC 
    '<ServiceRates'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<Age'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    #AGE
    '</Age>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<Service'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<Plan'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    #PLAN
    '</Plan>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '</Service>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '</ServiceRates>' INTO #REQUEST LEAVING NO
  #FUNCTION-NAME := #SERVICE-RATES
ELSE
  RESET #REQUEST
  COMPRESS NUMERIC 
    '<ServiceRequest'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<ContactID'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    #CONTACT-ID
    '</ContactID>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<Service'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<Plan'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    #PLAN
    '</Plan>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '<Mode'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    #MODE
    '</Mode>' INTO #REQUEST LEAVING NO    
  COMPRESS NUMERIC #REQUEST  
    '<TrackingID'
    '>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    #AT-NUMBER
    '</TrackingID>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '</Service>' INTO #REQUEST LEAVING NO
  COMPRESS NUMERIC #REQUEST
    '</ServiceRequest>' INTO #REQUEST LEAVING NO
  #FUNCTION-NAME := #SERVICE-REQUEST
END-IF
END-SUBROUTINE
*
END
